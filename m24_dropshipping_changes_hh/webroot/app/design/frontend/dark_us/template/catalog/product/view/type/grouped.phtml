<?php
/*
  * W tabeli tylko produkty z maganzynem
  * app\code\core\Mage\Catalog\Model\Product\Type\Grouped.php -
  * public function getAssociatedProducts($product = null)
  * Mage::getSingleton('cataloginventory/stock')->addInStockFilterToCollection($collection);
  */
?>

<?php
$disableCerts = false;
$logged = false;
if (Mage::getSingleton('customer/session')->getCustomer()->getConfirmed()) {
    $logged = true;
    $customerID = Mage::getSingleton('customer/session')->getCustomer()->getId();
    $customerData = Mage::getSingleton('customer/session')->getCustomer();
    $customer_id = $customerData->getId();

}
//$timehelper = Mage::helper('sap/products');
$testArray=['show_thresh_info'=>'sth',
    'show_c2label'=>'sc2l',
    'discount_amount_custom1'=>'dac1',
    'cena_dodatkowa'=>'cd',
    'additional_price_threshold'=>'apt',
    'discount_amount_custom2'=>'da'];

$c2Array=[];

if(file_exists(Mage::getBaseDir('base')."/c2perclient/".Mage::getSingleton('customer/session')->getId()))
    $c2Array=json_decode(file_get_contents(Mage::getBaseDir('base')."/c2perclient/".Mage::getSingleton('customer/session')->getId()),true);//$timehelper = Mage::helper('sap/products');



?>

<?php $this->setPreconfiguredValue(); ?>
<?php $_product = $this->getProduct(); ?>
<?php $orderCount = count(Mage::getModel('sales/order')->getCollection()->addFieldToFilter('customer_id',Mage::getSingleton('customer/session')->getId())); 
?>
<?php $_associatedProducts = $this->getAssociatedProducts(); ?>

<?php $_hasAssociatedProducts = count($_associatedProducts) > 0; ?>


<?php
$setid = 1;
foreach ($_associatedProducts as $simple) {
    $setid = $simple->getAttributeSetId();
    break;
}
?>
<?php
// $setid = $_product->getAttributeSetId();

if ($_product->getData('jednostka_miary') == 27) {
    $sztukilabel = "~ Sztuk <br/>W 1 kg";
    $mobilesztukilabel = "~ Sztuk w 1 kg";
} else {
    $sztukilabel = "~ Sztuk <br/>W opakowaniu";
    $mobilesztukilabel = "~ Sztuk w opakowaniu";
}


$customer = Mage::getSingleton('customer/session')->getCustomer();
$groupid = $customer->getGroupId();
$rabat = 0;
if ($groupid == 2) {
    $rabat = 40;
} elseif ($groupid == 3) {
    $rabat = 20;
} elseif ($groupid == 4) {
    $rabat = 30;
} elseif ($groupid == 6) {
    $rabat = 32;
} elseif ($groupid == 7) {
    $rabat = 34;
} elseif ($groupid == 8) {
    $rabat = 36;
} elseif ($groupid == 9) {
    $rabat = 38;
}

$allowwishlist = $this->helper('wishlist')->isAllow();

if ($allowwishlist):
    $athleteHelper = $this->helper('athlete');
    $wishList = Mage::getModel('wishlist/wishlist')->loadByCustomer($customer);
    $wishListItemCollectionIds = $wishList->getItemCollection();
    $ids = array();
    foreach ($wishListItemCollectionIds as $wishListItem) {
        $ids[] = $wishListItem->getProduct()->getId();
    }
endif;

$wyroznienia_items = array();
if ($logged === true):
    $wyroznienia_items = $this->helper('simple24')->getWyroznieniaItems();
    $ShowOnlyAvailables = $_COOKIE["SOA_products"];
    if (boolval($ShowOnlyAvailables) === true) {
        #checkbox should be checked
        $cookieValue = json_decode($ShowOnlyAvailables, true);
        if ((isset($cookieValue[$_product->getSku()])) && (boolval($cookieValue[$_product->getSku()]) === true)) {
            $SOA_check = 'checked';
        } else {
            $SOA_check = '';
        }
    } else {
        $SOA_check = '';
    }
    $soa_checkbox = '';
    $soa_checkbox .= '<br/><span class="show_availables">';
    $soa_checkbox .= '<input type="checkbox" name="show_availables" id="show_availables" ' . $SOA_check . ' onchange="showOAItems()"/>';
    $soa_checkbox .= '<label for="show_availables">Tak</label>';
    $soa_checkbox .= '<span id="show_availables_tooltip">Pokaż tylko dostępne produkty</span>';
    $soa_checkbox .= '</span>';
else:
    $soa_checkbox .= '';
endif;
?>


<?php echo $this->getChildHtml('product_type_data_extra') ?>

<?php if ($setid == 9) { //Sruby i wkrety
    $headers = '<th data-setid="' . $setid . '" aaaaaaaaaaa class="sortfirst_rozmiar"><span>Rozmiar</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        <th><span>' . $sztukilabel . '</span></th>
        ';
} else if ($setid == 16) { //Brzeszczoty
    $headers = '<th data-setid="' . $setid . '"  class="sorttable_nosort"><span>Uzębienie [mm] / Symbol / Oznaczenie</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        ';
} else if ($setid == 19) { //Elektrody i druty
    $headers = '<th data-setid="' . $setid . '"  class="sortfirst_rozmiar"><span>d (mm) x L (mm)</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        <th><span>' . $sztukilabel . '</span></th>
        ';
} else if ($setid == 12) {//Gwozdzie
    $headers = '<th data-setid="' . $setid . '"  class="sortfirst_rozmiar"><span>d (mm) x L (mm)</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        <th><span>' . $sztukilabel . '</span></th>
        ';
} else if ($setid == 18) { //Kotwy i łączniki
    $headers = '<th data-setid="' . $setid . '" class="sortfirst_rozmiar"><span>Rozmiar D x Rozmiar L x Rozmiar d (mm)</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        ';
} else if ($setid == 10) { //Nakretki i podkladki
    $headers = '<th data-setid="' . $setid . '" class="sortfirst_rozmiar"><span>Rozmiar D x Rozmiar d (mm)</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        <th><span>' . $sztukilabel . '</span></th>
        ';
} else if ($setid == 15) { //Narzedzia reczne
    $headers = '<th data-setid="' . $setid . '" class="sortfirst_rozmiar"><span>Rozmiar D x Rozmiar d (mm)</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        ';
} else if ($setid == 17) { //Odzież
    $headers = '<th data-setid="' . $setid . '" class="sortfirst_rozmiar"><span>Rozmiar</span></th>
        <th><span>Kolor</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan<br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        ';
} else if ($setid == 13) { //Tarcze i arkusze
    $headers = '<th data-setid="' . $setid . '" class="sortfirst_rozmiar"><span>Rozmiar</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        ';
} else if ($setid == 14) { //Wiertla
    $headers = '<th data-setid="' . $setid . '"  class="sortfirst_rozmiar"><span>Średnica x Rozmiar L x Rozmiar L2</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        ';
} else if ($setid == 20) { //Chemia
    $headers = '<th data-setid="' . $setid . '"  class="sorttable_nosort"><span>Rodzaj</span></th>
        <th><span>Parametr</span></th>
        <th><span>Pojemność (ml)</span></th>
        <th><span>Kolor</span></th>
        <th><span>Nr artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        ';

} else {
    $headers = '<th data-setid="' . $setid . '"  class="sortfirst_rozmiar"><span>Parametr</span></th>
        <th class="sorttable_nosort"><span>Kolor</span></th>
        <th><span>Nr <br/>Artykułu</span></th>
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        <th class="sorttable_nosort" style="display:none;"><span>JM</span></th>
        <th><span>' . $sztukilabel . '</span></th>';

}; ?>
<?php
$headers = '';
#$headers = '<th class="product_name_td sorttable_nosort skip-filter "><span>Nazwa Artykułu</span></th>'; ?>


<?php
$ralToHex = array(
    '3005' => '#4F121A',
    '3009' => '#5E2121',
    '3011' => '#781417',
    '5003' => '#001745',
    '6005' => '#0A381F',
    '6020' => '#263829',
    '7016' => '#262E38',
    '7024' => '#303845',
    '7035' => '#D4D9DB',
    '8004' => '#85382B',
    '8017' => '#2E1C1C',
    '8019' => '#2B2629',
    '9002' => '#F0EDE6',
    '9005' => '#03050A',
    '9006' => '#A6ABB5',
    '9007' => '#7D7A78',
    '9010' => '#FAFFFF',
    '9011' => '#1C1C1C',
    "9016" => '#F6F6F6',
    "1002" => "#D2B773",
    "1004" => "#E2B007",
    "1034" => "#EDAB56",
    "6002" => "#276235",
    "8001" => "#9C6B30",
    "8003" => "#80542F",
    "8007" => "#6F4A2F",
    "8011" => "#5A3A29",
    "8014" => "#49392D",
    "8023" => "#A65E2F",
    "8024" => "#79553C",
    "8022" => "#211F20",
);

$colors3240 = array("brown" => "#6d554b",
    "brown" => "#7c6d5e",
    "brown" => "#947847",
    "brown" => "#5b594e",
    "brown" => "#6c6959",
);
$json = $_product->getKolumny();

// if (substr($_product->getSku(), 0, 2) == '15')
//     $json = str_replace("pimcore_rozmiar_d_male", "pimcore_rozmiar_dmale", $json);
$defined = json_decode('{' . rtrim($json, ",") . '}', true);
if ($_product->getSku() == '53.52') {
    $defined = array_merge(array("gwint" => "gwint"), $defined);
    // var_dump($defined);

}

// if(substr($_product,0,2)!='15')
//     unset($defined['pimcore_rozmiar_d_male']);
// if(substr($_product->getSku(),0,2)=='15')
//     unset($defined['pimcore_rozmiar_dmale']);
// echo substr($_product->getSku(),0,2);
// if(isset($defined['pimcore_rozmiar_d_male']) && isset($defined['pimcore_rozmiar_dmale']) && substr($_product->getSku(),0,2)!='15'){
//     if(substr($_product->getSku(),0,2)!='15')
//         unset($defined['pimcore_rozmiar_d_male']);
//     if(substr($_product->getSku(),0,2)=='15')
//         unset($defined['pimcore_rozmiar_dmale']);
// }

// var_dump($defined);
$setid = $_product->getAttributeSetId();
$itemTys = false;
$itemnottys = false;
$jms = array();
if ($_hasAssociatedProducts):
    $displayPicesPerPackage = false;
endif;
$subSizes = false;
if (empty($defined)) {
    $subSizes = true;
    $defined = array('rodzaj' => 'rodzaj', 'parametr' => 'parametr', 'color' => 'color', "pojemnosc_ml" => 'pojemnosc_ml', "kolor" => "kolor", "rozmiar_parametr" => "rozmiar_parametr", "rozmiar_d" => "rozmiar_d", "rozmiar_l" => "rozmiar_l", "rozmiar_l2" => "rozmiar_l2", "rodzaj_wglebienia" => "rodzaj_wglebienia", "rodzaj_gwintu" => "rodzaj_gwintu", "rodzaj_pokrycia" => "rodzaj_pokrycia", "rozmiar_srednica" => "rozmiar_srednica", "rozmiar_drugi" => "rozmiar_drugi", "rozmiar_srednica2" => "rozmiar_srednica2", "rozmiar_granulacja" => "rozmiar_granulacja");
}
$defined['jednostka_miary'] = 'Jednostka miary';
$defined['gazetka'] = "Produkty z gazetki";
$defined['ext_znaki'] = "Certyfikaty";
$filtersAttributes = array_keys($defined);
$uniqueAttributes = array();
$specialRalsArray = array();
$specialRalsArrayStore1 = array();
$selectedRozmiars = array();
$selectedRozmiarsMixed = array();
$grupa = array();
$grupaRozmiary = array();
$grRozmCode = array();
$countRozm = 0;
$itemJM = array();
$extraSizes = array();
$pimcoreDisables = array('pimcore_id', 'pimcore_group', 'pimcore_subgroup', 'pimcore_materialindex', "pimcore_published", "pimcore_shortmaterialtext", "pimcore_nazwa", "pimcore_symbol");
$testD = array();
$testM = array();
$testA = array();
$curr = 0;
$defined2 = $defined;
foreach ($pimcoreDisables as $pim_code) {
    unset($defined2[$pim_code]);
}
foreach ($pimcoreDisables as $pim_code) {
    unset($defined[$pim_code]);
}

if (isset($_GET['show_attributes']) == true && empty($_GET['show_attributes']) == false) {
    echo "<br><pre>";
    print_r($defined2);
    echo "</pre>";
}
foreach ($defined as $code => $label) {
    if (in_array($code, $pimcoreDisables)) continue;

    $curr++;
    $testD[$code] = $label;
    if ($curr <= 6) {
        $testM[$code] = $label;
    } else {
        $testA[$code] = $label;
    }
}
if ($_GET['hubitest'] === 'tak') {

// echo "<pre>STRIPPED FROM DISABLEDS:";
// print_r($testD);
// echo "MAIN HEADERS:";
// print_r($testM);
// echo "ADDITIONAL:";
// print_r($testA);
// echo "</pre>";
}
$hasKG = false;
foreach ($_associatedProducts as $_item):
    $_item->setSku(str_replace("+","-",$_item->getSku()));
    if ($_item->getStatus() == 2) {
        continue;
    }
    $itemPiecePerPackage = $_item->getData('orientacyjnie_sztuk_w_opak') ? strlen($_item->getData('orientacyjnie_sztuk_w_opak')) : 0;

    if (($displayPicesPerPackage === false) && ($itemPiecePerPackage > 0)) {
        $displayPicesPerPackage = true;
    }
    if ($_item->getData('sztuki_tys') === '184') {
        $itemTys = true;
    } else {
        $itemnottys = true;

    }
    switch (substr($_item->getSku(), -1)) {
        case 'T':
            $jm = 28;
            $cenajednostkowa = $cena / 1000;
            $cenaminimalnaZaSztuke = $cenaminimalna / 1000;
            $cenawpanelu = $cenajednostkowa * $wielkoscopakowania;
            $cenaminimalna = $cenaminimalnaZaSztuke * $wielkoscopakowania;
            $ilosc = ($ilosc * 1000) / $wielkoscopakowania;
            $cenajednostkowa = $cena;
            $jms['TYS'] = 'TYS';

            break;
        case 'S':
            $jm = 28;
            $ilosc = $ilosc / $wielkoscopakowania;
            $cenawpanelu = $cena * $wielkoscopakowania;
            $cenajednostkowa = $cena;
            $jms['SZT'] = 'SZT';
            break;
        case 'O':
            $jm = 293;
            $cenawpanelu = $cena * $wielkoscopakowania;
            $cenajednostkowa = $cena;
            $jms['OPK'] = 'OPK';

            break;
        case 'K':
            $jm = 27;
            $cenawpanelu = $cena * $wielkoscopakowania;
            $cenajednostkowa = $cena;
            $ilosc = $ilosc / $wielkoscopakowania;
            $jms['KG'] = 'KG';
            // if(isset($_GET['sztuki_w_opak']))
            $hasKG = true;

            break;
        case 'KPL':
            $jm = 113;
            $ilosc = $ilosc / $wielkoscopakowania;
            $cenawpanelu = $cena * $wielkoscopakowania;
            $cenaminimalna = $cenaminimalna * $wielkoscopakowania;
            $cenajednostkowa = $cena / $wielkoscopakowania;
            $jms['KPL'] = 'KPL';
            break;
        case 'M':
            $jm = 26;
            $cenajednostkowa = $cena;
            $cenawpanelu = $cena * $wielkoscopakowania;
            $ilosc = $ilosc / $wielkoscopakowania;
            $jms['MB'] = 'MB';
            break;

        default:
            $jm = 28;
            $cenawpanelu = $cena;
            $cenajednostkowa = $cena;
            $jms['SZT'] = 'SZT';
    }

    $itemRozmiary = array();
    $grupaRozmiaryCodes = array();
    $maxGrupaRozmiars = 2;
    if ($subSizes) {
        $maxGrupaRozmiars = 6;
    }
    $countedGrupaRozmiars = 0;
    $rozmCount = 0;
    if ($rozmCount < 2):
        foreach ($defined as $code => $label) {
            if (strpos($code, 'rozmiar') !== false) {
                $value = $_item->getData($code);
                if ($value && count($selectedRozmiars) < 2) {
                    $rozmCount++;
                    if ($rozmCount <= 2) {
                        $selectedRozmiars[] = $code;
                        $selectedRozmiarsMixed[$code] = array();
                    }
                }
            }
        }
    endif;
    if (isset($_GET['network1'])) {
        // var_dump($filtersAttributes);
    }
    foreach ($filtersAttributes as $filtersAttributeCode) {
        $value = $_item->getData($filtersAttributeCode);
        if (isset($_GET['network1']) && $filtersAttributeCode == 'pimcore_rozmiar_d_male') {
            var_dump($filtersAttributeCode);
            var_dump($_item->getSku());
            $value = $_item->getData('rozmiar_d');
            var_dump($value);
        }
        if ($value) {
            $specialRalsArray[$filtersAttributeCode][$value] = $_item->getStoreAtrTextOrValue($filtersAttributeCode, 0);
            $specialRalsArrayStore1[$filtersAttributeCode][$value] = $_item->getStoreAtrTextOrValue($filtersAttributeCode, 1);
            $uniqueAttributes[$filtersAttributeCode][$value] = $_item->getAttributeTextOrValue($filtersAttributeCode);
        }

        if (strpos($filtersAttributeCode, 'rozmiar') !== false) {
            $actualRozmiar = $value;
            $correctedRozmiar = (float)filter_var($value, FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
            $itemRozmiary[] = $correctedRozmiar;
            $countedGrupaRozmiars++;
            if ($countedGrupaRozmiars > $maxGrupaRozmiars) {

            } else {
                $grupaRozmiaryCodes[$filtersAttributeCode] = $filtersAttributeCode;
            }
            if ($value) {
                if (isset($selectedRozmiarsMixed[$filtersAttributeCode])) {
                    $thisKeys = array_keys($selectedRozmiars, $filtersAttributeCode);
                    $thisKey = $thisKeys[0];
                    if ($thisKey === 0) {
                        $getFrom = $selectedRozmiars[1];
                    } else {
                        $getFrom = $selectedRozmiars[0];
                    }
                    if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value])) {
                        $selectedRozmiarsMixed[$filtersAttributeCode][$value] = array();
                    }
                    if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$getFrom])) {
                        $selectedRozmiarsMixed[$filtersAttributeCode][$value][$getFrom] = array();
                    }
                    $selectedRozmiarsMixed[$filtersAttributeCode][$value][$getFrom][$_item->getAttributeTextOrValue($getFrom)] = $_item->getAttributeTextOrValue($getFrom);
                }
                foreach ($selectedRozmiars as $rozmcode) {
                    if ($rozmcode !== $filtersAttributeCode) {
                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode])) $selectedRozmiarsMixed[$filtersAttributeCode] = array();

                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value])) $selectedRozmiarsMixed[$filtersAttributeCode][$value] = array();

                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode])) $selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode] = array();

                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode][$_item->getAttributeTextOrValue($rozmcode)])) {
                            $selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode][$_item->getAttributeTextOrValue($rozmcode)] = $_item->getAttributeTextOrValue($rozmcode);
                        }
                    }
                }
                foreach ($selectedRozmiarsMixed as $othercode => $otherval) {
                    if ($othercode !== $filtersAttributeCode) {
                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode])) {
                            $selectedRozmiarsMixed[$filtersAttributeCode] = array();
                        }
                        $insertVal = $_item->getData($othercode);
                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value])) $selectedRozmiarsMixed[$filtersAttributeCode][$value] = array();

                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode])) $selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode] = array();

                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode][$insertVal])) $selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode][$insertVal] = $insertVal;
                    }
                }
            }

        } else {
            if ($value && (!in_array($filtersAttributeCode, $pimcoreDisables))) {
                foreach ($selectedRozmiars as $rozmcode) {
                    if (!isset($selectedRozmiarsMixed[$filtersAttributeCode])) $selectedRozmiarsMixed[$filtersAttributeCode] = array();

                    if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value])) $selectedRozmiarsMixed[$filtersAttributeCode][$value] = array();

                    if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode])) $selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode] = array();

                    if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode][$_item->getAttributeTextOrValue($rozmcode)])) {
                        $selectedRozmiarsMixed[$filtersAttributeCode][$value][$rozmcode][$_item->getAttributeTextOrValue($rozmcode)] = $_item->getAttributeTextOrValue($rozmcode);
                    }
                }
                foreach ($selectedRozmiarsMixed as $othercode => $otherval) {
                    if ($othercode !== $filtersAttributeCode) {
                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode])) {
                            $selectedRozmiarsMixed[$filtersAttributeCode] = array();
                        }
                        $insertVal = $_item->getData($othercode);
                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value])) $selectedRozmiarsMixed[$filtersAttributeCode][$value] = array();

                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode])) $selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode] = array();

                        if (!isset($selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode][$insertVal])) $selectedRozmiarsMixed[$filtersAttributeCode][$value][$othercode][$insertVal] = $insertVal;
                    }
                }
            }
        }
    }
    if (count($itemRozmiary) > 0) {
        $size_0 = $itemRozmiary[0];

        if ($size_0 < 1) {
            $size_0 = 99999;
        }
        if ($itemRozmiary[1] < 10) {
            $size_1 = floatval('0.000' . $itemRozmiary[1]);
        } elseif ($itemRozmiary[1] < 100) {
            $size_1 = floatval('0.00' . $itemRozmiary[1]);
        } elseif ($itemRozmiary[1] < 1000) {
            $size_1 = floatval('0.0' . $itemRozmiary[1]);
        } else {
            $size_1 = floatval('0.' . $itemRozmiary[1]);
        }
        $sortKey = $size_0 + $size_1;
    } else {
        $sortKey = 99999;
    }
    $grupaRozmiary[$_item->getSku()] = $sortKey;

endforeach; ?>


<?php
$maxTHRozmiars = 2;
if ($subSizes) {
    $maxTHRozmiars = 6;
}
$countedTHRozmiars = 0;
$rozmiaryHeaders = '';
$mainHEADERS = '';
$mainHEADERSTD = array();
$currentHeader = 0;
$currentRozmiar = 0;
$maxOverallHeader = 6;
$maxRozmiar = 6;
$additionalHEADERS = array();
$rodzajPoryciaHeaders = '';
$klasaHeaders = '';
$attributesHeaders = array();
$attributesNotHeaders = array();
$rodzajPorycia = array();
$klasaAttr = array();
$iconographsArray = array();
$iconsgraphsItemsData = array();
$rozmiaryCodes = array();
$pimcoreDisables = array('pimcore_id', 'pimcore_group', 'pimcore_subgroup', 'pimcore_materialindex');
$testJM = array();
if (isset($_GET['network1'])) {
    // var_dump($uniqueAttributes);
}
foreach ($defined as $code => $labelHeader):
    if (isset($_GET['network1'])) {
        // var_dump($code);
    }
    if (in_array($code, $pimcoreDisables)) {
        continue;
    }
    if (isset($uniqueAttributes[$code])):
        if (isset($_GET['network1'])) {
            var_dump($code);
        }
        $attributeInfo = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
        $values = array_unique($uniqueAttributes[$code]);
        $panel_values = array_unique($specialRalsArray[$code]);
        if (count($values) == 0) {
            continue;
        }

        if (strpos($code, 'rozmiar') !== false) {
            $currentRozmiar++;
            $rozmiaryVal = array_unique($uniqueAttributes[$code]);
            $rozmiaryFloats = array();
            foreach ($rozmiaryVal as $val) {
                $rozmiaryFloats[] = (float)filter_var($val, FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
            }

            array_multisort($rozmiaryFloats, SORT_ASC, $values);
        }
        if (strpos($code, 'jednostka_miary') !== false) {

            $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
            $iconographsArray[$code] = array(
                'code' => $code,
                'label' => $labelHeader,
                'values' => array()
            );
            foreach ($values as $value => $label):
                $newLabel = trim($label);
                $iconographsArray[$code]['values'][$value] = array('label' => $label, 'status' => 'simple', 'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeModel->getId()), 'other' => $selectedRozmiarsMixed[$code][$value]);
            endforeach;
        }

        if (strpos($code, 'gwint') !== false) {

            $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
            $iconographsArray[$code] = array(
                'code' => $code,
                'label' => $labelHeader,
                'values' => array()
            );

            foreach ($values as $value => $label):
                $disableCerts[$label] = $label;
                $newLabel = trim($label);
                $iconographsArray[$code]['values'][$value] = array('label' => $label, 'status' => 'simple', 'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeModel->getId()), 'other' => $selectedRozmiarsMixed[$code][$value]);
            endforeach;
        }
        if (strpos($code, 'ext_znaki') !== false) {

            $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
            $iconographsArray[$code] = array(
                'code' => $code,
                'label' => $labelHeader,
                'values' => array()
            );

            foreach ($values as $value => $label):
                $disableCerts[$label] = $label;
                $newLabel = trim($label);
                $iconographsArray[$code]['values'][$value] = array('label' => $label, 'status' => 'simple', 'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeModel->getId()), 'other' => $selectedRozmiarsMixed[$code][$value]);
            endforeach;
        }
        if (strpos($code, 'gazetka') !== false) {

            $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
            $iconographsArray[$code] = array(
                'code' => $code,
                'label' => $labelHeader,
                'values' => array()
            );

            foreach ($values as $value => $label):
                if ($value === 1) {
                    $label = 'Tak';
                } else {
                    $label = 'Nie';
                }
                $iconographsArray[$code]['values'][$value] = array(
                    'label' => $label,
                    'status' => 'simple',
                    'image' => '',
                    'other' => $selectedRozmiarsMixed[$code][$value]
                );
            endforeach;
        }
        if (isset($_GET['network1'])) {
            // var_dump($iconographsArray);
        }
        if (strpos($code, 'rozmiar') !== false):
            $countedTHRozmiars++;
            if ($_GET['hubitest'] !== 'tak'):

                $attributesHeaders[$code] = $labelHeader;
                $labelHeader = $attributeInfo->getFrontendLabel();
                $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                $labelHeader = $attributeModel->getStoreLabel(1);
                $selectDisabled = '';

                $singleTH = '<th data-s="12" class="' . $code . '">' . $labelHeader . '<div></div><select name="filter[' . $code . ']" class="filterSelect singleth" id="' . $code . '" ' . $selectDisabled . '>';
                $singleTH .= '<option value="">Wybierz ...</option>';
                $iconographsArray[$code] = array(
                    'code' => $code,
                    'label' => $labelHeader,
                    'values' => array()
                );
                foreach ($values as $value => $label):
                    $newLabel = trim($label);
                    if (isset($_GET[$code]) && $newLabel == $_GET[$code]) {
                        $isSelected = ' selected="selected"';
                    } else {
                        $isSelected = '';
                    }
                    if (strlen($newLabel) > 0) {
                        $iconographsArray[$code]['values'][$newLabel] = array('label' => $newLabel, 'ol_label'=>$label, 'ol_val'=>$value, 'status' => 'simple', 'image' => $newLabel, 'other' => $selectedRozmiarsMixed[$code][$label]);
                    }
                    $iconsgraphsItemsData[$code][$newLabel] = $newLabel;
                    $extraSizes[$_item->getSku()] = $newLabel;
                    $singleTH .= '<option value="' . $newLabel . '" ' . $isSelected . '>' . $newLabel . '</option>';
                endforeach;
                $singleTH .= '</select></th>';
                $rozmiaryHeaders .= $singleTH;
                if (($currentHeader <= $maxOverallHeader) && ($currentRozmiar <= $maxRozmiar)) {
                    $currentHeader++;
                    $mainHEADERS .= $singleTH;
                    $mainHEADERSTD[$code] = $code;
                } else {
                    $additionalHEADERS[$code] = $code;
                }

            else:
                if ($countedTHRozmiars > $maxTHRozmiars) {
                    $attributesNotHeaders[$code] = $attributeInfo->getFrontendLabel();
                } else {
                    $attributesHeaders[$code] = $labelHeader;
                    $labelHeader = $attributeInfo->getFrontendLabel();
                    $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                    $labelHeader = $attributeModel->getStoreLabel(1);
                    $selectDisabled = '';

                    $singleTH = '<th data-s="13" class="' . $code . '">' . $labelHeader . '<div></div><select name="filter[' . $code . ']" class="filterSelect singleth" id="' . $code . '" ' . $selectDisabled . '>';
                    $singleTH .= '<option value="">Wybierz ...</option>';
                    $iconographsArray[$code] = array(
                        'code' => $code,
                        'label' => $labelHeader,
                        'values' => array()
                    );
                    foreach ($values as $value => $label):
                        $newLabel = trim($label);
                        if (isset($_GET[$code]) && $newLabel == $_GET[$code]) {
                            $isSelected = ' selected="selected"';
                        } else {
                            $isSelected = '';
                        }
                        if (strlen($newLabel) > 0) {
                            $iconographsArray[$code]['values'][$newLabel] = array('label' => $newLabel, 'ol_label'=>$label, 'ol_val'=>$value, 'status' => 'simple', 'image' => $newLabel, 'other' => $selectedRozmiarsMixed[$code][$label]);
                        }
                        $iconsgraphsItemsData[$code][$newLabel] = $newLabel;
                        $extraSizes[$_item->getSku()] = $newLabel;
                        $singleTH .= '<option value="' . $newLabel . '" ' . $isSelected . '>' . $newLabel . '</option>';
                    endforeach;
                    $singleTH .= '</select></th>';
                    $rozmiaryHeaders .= $singleTH;
                    if ($currentHeader <= $maxOverallHeader) {
                        $currentHeader++;
                        $mainHEADERS .= $singleTH;
                        $mainHEADERSTD[$code] = $code;
                    } else {
                        $additionalHEADERS[$code] = $code;
                    }
                }
            endif;

        else:
            if ((strpos($code, 'gwint') !== false || strpos($code, 'rodzaj') !== false || $code == 'kolor' || strpos($code, 'parametr') !== false || strpos($code, 'pojemnosc') !== false || strpos($code, 'rozmiar') !== false || strpos($code, 'gwintu') !== false) && $code != 'pimcore_rodzaj_pokrycia') {
                $rodzajPorycia[$code] = $attributeInfo->getFrontendLabel();
                $labelHeader = $attributeInfo->getFrontendLabel();
                $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                $labelHeader = $attributeModel->getStoreLabel(1);
                $selectDisabled = '';

                $singleTH = '<th data-s="14" class="' . $code . '">' . $labelHeader . '<div></div><select name="filter[' . $code . ']" class="filterSelect sorttable_nosort rodzaj_notfalse singleth" id="' . $code . '" ' . $selectDisabled . '>';
                $singleTH .= '<option value="">Wybierz ...</option>';
                $iconographsArray[$code] = array(
                    'code' => $code,
                    'label' => $labelHeader,
                    'values' => array()
                );
                asort($values, SORT_LOCALE_STRING);
                foreach ($values as $value => $label):
                    $newLabel = trim($label);
                    if (isset($_GET[$code]) && $value == $_GET[$code]) {
                        $isSelected = ' selected="selected"';
                    } else {
                        $isSelected = '';
                    }
                    if (strlen($value) > 0) {
                        $iconographsArray[$code]['values'][$value] = array('label' => $label, 'status' => 'simple', 'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeModel->getId()), 'other' => $selectedRozmiarsMixed[$code][$value]);
                    }
                    $singleTH .= '<option value="' . $value . '" ' . $isSelected . '>' . $label . '</option>';
                endforeach;
                $singleTH .= '</select></th>';
                $rozmiaryHeaders .= $singleTH;
                if ($currentHeader <= $maxOverallHeader) {
                    $currentHeader++;
                    $mainHEADERS .= $singleTH;
                    $mainHEADERSTD[$code] = $code;
                } else {
                    $additionalHEADERS[$code] = $code;
                }
            } elseif (strpos($code, 'pimcore_ral') !== false) {

                $klasaAttr[$code] = $attributeInfo->getFrontendLabel();
                $labelHeader = $attributeInfo->getFrontendLabel();
                $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                $labelHeader = $attributeModel->getStoreLabel(1);
                $selectDisabled = '';
                $singleTH = '<th data-s="15" class="' . $code . '">' . str_replace(" ", "<br>", $labelHeader) . '<div></div><select name="filter[' . $code . ']" class="filterSelect sorttable_nosort pimcore_notfalse singleth" id="' . $code . '" ' . $selectDisabled . '>';
                $singleTH .= '<option value="">Wybierz ...</option>';
                $iconographsArray[$code] = array(
                    'code' => $code,
                    'label' => $labelHeader,
                    'values' => array()
                );
                foreach ($values as $value => $label):
                    $newLabel = trim($label);
                    if (isset($_GET[$code]) && $value == $_GET[$code]) {
                        $isSelected = ' selected="selected"';
                    } else {
                        $isSelected = '';
                    }
                    if (strlen($value) > 0) {
                        $iconographsArray[$code]['values'][$value] = array(
                            'label' => $panel_values[$value] . ' - ' . $label,
                            'status' => 'simple',
                            'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeModel->getId()),
                            'other' => $selectedRozmiarsMixed[$code][$value],
                            'panel_val' => $panel_values[$value]
                        );
                    }
                    $singleTH .= '<option value="' . $value . '" ' . $isSelected . '>' . $panel_values[$value] . ' - ' . $label . '</option>';
                endforeach;
                $singleTH .= '</select></th>';
                $klasaHeaders .= $singleTH;
                if ($currentHeader <= $maxOverallHeader) {
                    $currentHeader++;
                    $mainHEADERS .= $singleTH;
                    $mainHEADERSTD[$code] = $code;
                } else {
                    $additionalHEADERS[$code] = $code;
                }
            } elseif (strpos($code, 'pimcore_typ2') !== false) {

                $klasaAttr[$code] = $attributeInfo->getFrontendLabel();
                $labelHeader = $attributeInfo->getFrontendLabel();
                $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                $labelHeader = $attributeModel->getStoreLabel(1);
                $selectDisabled = '';
                $singleTH = '<th data-s="15" class="' . $code . '">' . str_replace(" ", "<br>", $labelHeader) . '<div></div><select name="filter[' . $code . ']" class="filterSelect sorttable_nosort pimcore_notfalse singleth" id="' . $code . '" ' . $selectDisabled . '>';
                $singleTH .= '<option value="">Wybierz ...</option>';
                $iconographsArray[$code] = array(
                    'code' => $code,
                    'label' => $labelHeader,
                    'values' => array()
                );
                foreach ($values as $value => $label):
                    $newLabel = trim($label);
                    if (isset($_GET[$code]) && $value == $_GET[$code]) {
                        $isSelected = ' selected="selected"';
                    } else {
                        $isSelected = '';
                    }
                    if (strlen($value) > 0) {
                        $veryNewLabel = '';
                        if ($panel_values[$value] !== $label) {
                            $veryNewLabel = $panel_values[$value] . ' - ' . $label;
                        } else {
                            $veryNewLabel = $label;
                        }
                        $iconographsArray[$code]['values'][$value] = array(
                            'label' => $label,
                            'status' => 'simple',
                            'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeModel->getId()),
                            'other' => $selectedRozmiarsMixed[$code][$value],
                            'panel_val' => $panel_values[$value]
                        );
                    }
                    if ($panel_values[$value]) {
                        $singleTH .= '<option value="' . $value . '" ' . $isSelected . '>' . $panel_values[$value] . ' - ' . $label . '</option>';
                    } else {
                        $singleTH .= '<option value="' . $value . '" ' . $isSelected . '>' . $label . '</option>';
                    }
                endforeach;
                $singleTH .= '</select></th>';
                $klasaHeaders .= $singleTH;
                if ($currentHeader <= $maxOverallHeader) {
                    $currentHeader++;
                    $mainHEADERS .= $singleTH;
                    $mainHEADERSTD[$code] = $code;
                } else {
                    $additionalHEADERS[$code] = $code;
                }
            } elseif (strpos($code, 'pimcore') !== false) {
                $currentHeader++;
                $klasaAttr[$code] = $attributeInfo->getFrontendLabel();
                $labelHeader = $attributeInfo->getFrontendLabel();
                $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                $labelHeader = $attributeModel->getStoreLabel(1);
                $selectDisabled = '';

                $singleTH = '<th data-s="16"  class="' . $code . '">' . str_replace(" ", "<br>", $labelHeader) . '<div></div><select name="filter[' . $code . ']" class="filterSelect sorttable_nosort pimcore_notfalse singleth" id="' . $code . '" ' . $selectDisabled . '>';
                $singleTH .= '<option value="">Wybierz ...</option>';
                $iconographsArray[$code] = array(
                    'code' => $code,
                    'label' => $labelHeader,
                    'values' => array()
                );
                foreach ($values as $value => $label):
                    $newLabel = trim($label);
                    if (isset($_GET[$code]) && $value == $_GET[$code]) {
                        $isSelected = ' selected="selected"';
                    } else {
                        $isSelected = '';
                    }
                    if (strlen($value) > 0) {
                        $iconographsArray[$code]['values'][$value] = array('label' => $label, 'status' => 'simple', 'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeModel->getId()), 'other' => $selectedRozmiarsMixed[$code][$value]);
                    }
                    $singleTH .= '<option value="' . $value . '" ' . $isSelected . '>' . $label . '</option>';
                endforeach;
                $singleTH .= '</select></th>';
                $klasaHeaders .= $singleTH;
                if ($currentHeader <= $maxOverallHeader) {
                    $currentHeader++;
                    $mainHEADERS .= $singleTH;
                    $mainHEADERSTD[$code] = $code;
                } else {
                    $additionalHEADERS[$code] = $code;
                }
            } elseif (strpos($code, 'jednostka') !== false) {
                $dodatkowaJednostka[$code] = $attributeInfo->getFrontendLabel();
                $labelHeader = $attributeInfo->getFrontendLabel();
                $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                $labelHeader = $attributeModel->getStoreLabel(1);
                $selectDisabled = '';

                $singleTH = "<th data-s='17' class='$code'>" . str_replace(" ", "<br>", $labelHeader) . '<div></div><select name="filter[' . $code . ']" class="filterSelect sorttable_nosort pimcore_notfalse singlethj" id="' . $code . '" ' . $selectDisabled . '>';
                $singleTH .= '<option value="">Wybierz ...</option>';
                foreach ($values as $value => $label):
                    $newLabel = trim($label);
                    if (isset($_GET[$code]) && $value == $_GET[$code]) {
                        $isSelected = ' selected="selected"';
                    } else {
                        $isSelected = '';
                    }
                    $singleTH .= '<option value="' . $value . '" ' . $isSelected . '>' . $label . '</option>';
                endforeach;
                $singleTH .= '</select></th>';
                $jednostkaHeaders .= $singleTH;
                if ($currentHeader <= $maxOverallHeader) {
                    #$currentHeader++;
                    #$mainHEADERS .= $singleTH;
                    #$mainHEADERSTD[$code] = $code;
                } else {
                    $additionalHEADERS[$code] = $code;
                }
            } else {
                if (strpos($code, 'gazetka') === false) {
                    $attributesNotHeaders[$code] = $code;
                    $dodatkowaJednostka[$code] = $attributeInfo->getFrontendLabel();
                    $labelHeader = $attributeInfo->getFrontendLabel();
                    $attributeModel = Mage::getModel('eav/entity_attribute')->loadByCode('catalog_product', $code);
                    $labelHeader = $attributeModel->getStoreLabel(1);
                    $selectDisabled = '';

                    $singleTH = "<th data-s='18' class='$code'>" . str_replace(" ", "<br>", $labelHeader) . '<div></div><select name="filter[' . $code . ']" class="filterSelect sorttable_nosort pimcore_notfalse singlethj" id="' . $code . '" ' . $selectDisabled . '>';
                    $singleTH .= '<option value="">Wybierz ...</option>';
                    foreach ($values as $value => $label):
                        $newLabel = trim($label);
                        if (isset($_GET[$code]) && $value == $_GET[$code]) {
                            $isSelected = ' selected="selected"';
                        } else {
                            $isSelected = '';
                        }
                        $singleTH .= '<option value="' . $value . '" ' . $isSelected . '>' . $label . '</option>';
                    endforeach;
                    $singleTH .= '</select></th>';
                    #$jednostkaHeaders .= $singleTH;
                    if ($currentHeader <= $maxOverallHeader) {
                        $currentHeader++;
                        $mainHEADERS .= $singleTH;
                        $mainHEADERSTD[$code] = $code;
                    } else {
                        $additionalHEADERS[$code] = $code;
                    }
                }
            }
        endif;
    endif;
endforeach;
$groupedProductAttrs = array();
foreach ($defined as $code => $label) {
    if (in_array($code, $pimcoreDisables)) {
        continue;
    }
    $value = $_product->getData($code);
    if ($value) {
        if (strlen($value) >= 1) {
            $attributeInfo = Mage::getSingleton('eav/config')->getAttribute(Mage_Catalog_Model_Product::ENTITY, $code);
            if (!isset($groupedProductAttrs[$code])) {

                $groupedProductAttrs[$code] = array(
                    'code' => $code,
                    'label' => $attributeInfo->getFrontendLabel(),
                    'values' => array()
                );
            }
            if (strpos($value, ',') !== false) {
                $values = explode(',', $value);
                foreach ($values as $val) {
                    $optionLabel = $attributeInfo->getFrontend()->getOption($val);
                    #$groupedProductAttrs[$code]['values'][$val] = array('label' => $optionLabel, 'status' => 'grouped', 'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($val, $attributeInfo->getAttributeId()));
                }
            } else {
                $optionLabel = $attributeInfo->getFrontend()->getOption($value);
                #$groupedProductAttrs[$code]['values'][$value] = array('label' => $optionLabel, 'status' => 'grouped', 'image' => $this->helper('bubble_aop')->getAttributeOptionImageById($value, $attributeInfo->getAttributeId()));
            }

        }
    }
}
foreach ($iconographsArray as $code => $data):
    foreach ($data['values'] as $value => $valData) {
        if ((strlen($value) < 1) || ($value === null)) {
            unset($iconographsArray[$code]['values'][$value]);
        }

    }
    if (count($data['values']) === 0) {
        unset($iconographsArray[$code]);
    }
endforeach;
foreach ($iconographsArray as $code => $data):
    foreach ($data['values'] as $value => $valData) {
        if ((strlen($value) < 1) || ($value === null)) {
            unset($iconographsArray[$code]['values'][$value]);
        } else {
            foreach ($valData['other'] as $other_code => $other) {
                foreach ($other as $o_code => $o_val) {
                    if (($o_code !== null) && ($o_code !== '')) {
                        if (($value !== null) && ($value !== '') && (($code !== null) && ($code !== ''))) {
                            if (!isset($iconographsArray[$other_code]['values'][$o_code]['other'][$code])) $iconographsArray[$other_code]['values'][$o_code]['other'][$code] = array();

                            $iconographsArray[$other_code]['values'][$o_code]['other'][$code][$value] = $value;
                        }
                    }
                }
            }
        }
    }
endforeach;
foreach ($groupedProductAttrs as $g_code => $g_data) {

    if (!isset($iconographsArray[$g_code])) {
        $iconographsArray[$g_code] = array(
            'code' => $g_code,
            'label' => $g_data['label'],
            'values' => array()
        );
        foreach ($g_data['values'] as $value) {
            if (!isset($iconographsArray[$g_code]['values'][$value])) {
                #$iconographsArray[$g_code]['values'][$value] = array('label' => $value['label'], 'status' => 'grouped', 'image' => $value['image'], 'other' => array());
            }
        }

    } else {
        foreach ($g_data['values'] as $g_key => $value) {

            if (!isset($iconographsArray[$g_code]['values'][$g_key])) {

                #$iconographsArray[$g_code]['values'][$g_key] = array('label' => $value['label'], 'status' => 'grouped', 'image' => $value['image'], 'other' => array());
            }
        }
    }
}

foreach ($iconographsArray as $code => $data) {
    foreach ($data['values'] as $v_code => $v_data) {
        foreach ($v_data['other'] as $o_code => $o_data) {
            foreach ($o_data as $index => $val) {
                if (($val === null) || ($index === null) || ($val === '') || ($index === '')) {
                    unset($iconographsArray[$code]['values'][$v_code]['other'][$o_code][$index]);
                }
                if (count($iconographsArray[$code]['values'][$v_code]['other'][$o_code]) === 0) {
                    unset($iconographsArray[$code]['values'][$v_code]['other'][$o_code]);
                }
            }
        }
    }
    if (count($data['values']) === 0) {
        unset($iconographsArray[$code]);
    }
}
$iconographsJSON = json_encode($iconographsArray);
if (($_GET['hubitest'] !== 'tak') && ($_GET['hubi_change'] !== 'tak')) {
    $headers .= $mainHEADERS;
} else {
    if (strlen($rozmiaryHeaders) > 1) {
        $headers .= $rozmiaryHeaders;
    }
    if (strlen($rodzajPoryciaHeaders) > 1) {
        $headers .= $rodzajPoryciaHeaders;
    }
    if (strlen($klasaHeaders) > 1) {
        $headers .= $klasaHeaders;
    }
}
if (isset($_GET['network1'])) {
    var_dump($iconographsArray);
}
?>

<?php
$subheaders = '
        <th class="magazyn sorttable_nosort skip-filter">Stan <br/>Magazynowy' . $soa_checkbox . '</th>
        <th class="sorttable_numeric"><span>Wielkość <br/>Opakownia</span></th>
        ';
if ($hasKG) {
    $subheaders .= '<th class="sorttable_numeric">~Ilosc Sztuk w opak.</th>';
}
$subheaders .= str_replace("jednostka_miary", "jednostka_miary", $jednostkaHeaders);
// $subheaders.= $jednostkaHeaders;
$definedPreJson = array();
foreach ($defined as $code => $label) {
    if (in_array($code, $pimcoreDisables)) continue;
    $definedPreJson[] = $code;
}
?>
<script type="text/javascript">
    jQuery(function ($) {
        let iconsData = <?= $iconographsJSON ?>;
        // let testingJM = JSON.parse('<?= json_encode($itemJM) ?>');
        console.log('iconsData',iconsData);
        let groupedArr = <?= json_encode($groupedProductAttrs) ?>;
        ////console.log('groupedArr',groupedArr);
        let defined = <?= json_encode($definedPreJson); ?>;
        ////console.log('defined ',defined);
        let iconsOutput = '<div id="product_filter_icons">';

        let searchForRozmiar = 'rozmiar';
        let iconsIteration = 0;
        let counter = 0;
        let thisURL = window.location.href;
        let thisUArr = thisURL.split('?');
        let searchParams = new URLSearchParams(thisUArr[1]);
        let gazetkaExist = false;
        // #862j6qgg0 start
        let del_ext_znaki = false;
        for (const [key, data] of Object.entries(iconsData)) {
            let size = Object.keys(data.values).length;
            if(key === 'ext_znaki' && size === 1) {
                for (const [ext_index, ext_data] of Object.entries(data.values)) {
                    if(ext_data.label === "Produkt niebudowlany") {
                        del_ext_znaki = true;
                    }
                }
                if(del_ext_znaki === true) {
                    delete iconsData['ext_znaki']
                }
            }
        }
        // #862j6qgg0 end  
        for (const [key, data] of Object.entries(iconsData)) {
            counter++;
            let size = Object.keys(data.values).length;

            let rozmiarClass = '';
            let disableClass = ''
            let rozmiarStyle = 'style="order:1;z-index:1;"';
            if (data.code.indexOf('rozmiar') > -1) {
                rozmiarClass = 'rozmiar_item';
                rozmiarStyle = 'style="order:0;"';
            } else {
                rozmiarStyle = 'style="order:' + (defined.indexOf(data.code)) + ';z-index:' + defined.indexOf(data.code) + ';"'; //original position based on pimcore data
                if (data.code.indexOf('rodzaj') > -1) {
                    rozmiarStyle = 'style="order:2;z-index:2;"';
                }
                if (data.code.indexOf('klasa') > -1) {
                    rozmiarStyle = 'style="order:3;z-index:3;"';
                }
            }

            if (size === 1) {
                // disableClass = 'is_disabled';
                disableClass = '';
                rozmiarStyle = 'style="order:' + (defined.length + 1) + ';z-index:' + (defined.length + 1) + ';"';
            } else {
                disableClass = '';
            }
            if (size > 0) {
                iconsOutput += '<div id="icons_' + data.code + '" data-switch-code="' + data.code + '" class="icons_item ' + rozmiarClass + ' ' + disableClass + '" data-l="' + size + '" ' + rozmiarStyle + '><div class="icons_label">' + data.label + '</div>';
                iconsOutput += '<div class="icons_opts">';
                for (const [value, info] of Object.entries(data.values)) {
                    let isActive = '';
                    let isChecked = '';
                    let groupedIconsOut = '';
                    if (searchParams.has(data.code) && (searchParams.get(data.code) === value)) {
                        isActive = 'is_active';
                        isChecked = 'checked';
                    }

                    if (data.code.indexOf('rozmiar') > -1) {
                        let outCodes = '';
                        let outCodesVal = '';
                        let otherCodesOut = '';
                        if (info.other !== null) {
                            // outCodes = ' data-other-rozm="';
                            outCodesVal = '';
                            let outOtherCodes = new Array();
                            for (const [atr_code, atr_val] of Object.entries(info.other)) {
                                if (atr_code !== null && atr_code !== data.code) {
                                    if(atr_code === 'ext_znaki') {
                                        if(del_ext_znaki !== true) {
                                            outOtherCodes.push(atr_code);
                                            let objVals = Object.values(atr_val);
                                            if (objVals.join(';').length > 0) {
                                                outCodesVal += ' data-' + atr_code + '="';
                                                outCodesVal += objVals.join(';');
                                                outCodesVal += '"';
                                                otherCodesOut = outOtherCodes.join(';');
                                            }
                                        }
                                    } else {
                                        outOtherCodes.push(atr_code);
                                        let objVals = Object.values(atr_val);
                                        if (objVals.join(';').length > 0) {
                                            outCodesVal += ' data-' + atr_code + '="';
                                            outCodesVal += objVals.join(';');
                                            outCodesVal += '"';
                                            otherCodesOut = outOtherCodes.join(';');
                                        }
                                    }
                                }
                            }
                        }

                        let otherCodesOutput = '';
                        if (otherCodesOut.length > 1) {
                            otherCodesOutput = 'data-other_codes="' + otherCodesOut + '"';
                        } else {
                            otherCodesOutput = 'data-other_codes=""';
                        }
                        let disableAtr;
                        // if ((size === 1) || info.status !== 'simple') {
                        if (info.status !== 'simple') {
                            disableAtr = 'disabled="disabled"';
                            disableClass = 'is_disabled';
                        } else {
                            disableAtr = '';
                            disableClass = '';
                        }
                        if ((typeof info.label !== 'undefined') && (info.status === 'simple')) {
                            iconsOutput += `<label class="miro-radiobutton filter_img ` + isActive + ` ` + disableClass + `" ` + disableAtr + ` role="button"`;
                            if (info.image.includes('"')) {
                                iconsOutput += ` data-img='` + info.image + `' data-sortit='` + info.image + `'>`;
                            } else if (info.image.includes("'")) {
                                iconsOutput += ` data-img="` + info.image + `" data-sortit="` + info.image + `">`;
                            } else {
                                iconsOutput += ` data-img="` + info.image + `" data-sortit="` + info.image + `">`;
                            }
                            iconsOutput += '<input ' + outCodes + ' ' + otherCodesOutput + ' ' + outCodesVal + ' class="item_input_rozmiar ' + disableClass + '" ' + disableAtr + ' style="display: none;" type="checkbox" name="iconfilter_' + data.code + '" data-code="' + data.code + '" ';
                            if (value.includes('"')) {
                                iconsOutput += `value='` + value + `'`;
                            } else {
                                iconsOutput += `value="` + value + `"`;
                            }

                            iconsOutput += isChecked + `>`;
                            iconsOutput += '<span><span class="item_rozmiar">' + info.label + '</span><span class="filter-tooltip" style="display:none">' + info.label + '</span></span>';
                            iconsOutput += '</label>';
                        }
                    } else {
                        let outCodes = '';
                        let outCodesVal = '';
                        let otherCodesOut = '';
                        if (info.other !== null) {
                            // outCodes = ' data-other-rozm="';
                            outCodesVal = '';
                            let outOtherCodes = new Array();
                            for (const [atr_code, atr_val] of Object.entries(info.other)) {
                                if (atr_code !== data.code) {
                                    if(atr_code === 'ext_znaki') {
                                        if(del_ext_znaki !== true) {
                                            outOtherCodes.push(atr_code);
                                            let objVals = Object.values(atr_val);
                                            outCodesVal += ' data-' + atr_code + '="';
                                            outCodesVal += objVals.join(';');
                                            outCodesVal += '"';
                                            otherCodesOut = outOtherCodes.join(';');
                                        }
                                    } else {
                                        outOtherCodes.push(atr_code);
                                        let objVals = Object.values(atr_val);
                                        outCodesVal += ' data-' + atr_code + '="';
                                        outCodesVal += objVals.join(';');
                                        outCodesVal += '"';
                                        otherCodesOut = outOtherCodes.join(';');
                                    }
                                }
                            }
                        }

                        let otherCodesOutput = '';
                        if (otherCodesOut.length > 1) {
                            otherCodesOutput = 'data-other_codes="' + otherCodesOut + '"';
                        } else {
                            otherCodesOutput = 'data-other_codes=""';
                        }
                        let disableAtr;
                        // if ((size === 1) || info.status !== 'simple') {
                        if (info.status !== 'simple') {
                            disableAtr = 'disabled="disabled"';
                            disableClass = 'is_disabled';
                        } else {
                            disableAtr = '';
                            disableClass = '';
                        }
                        if (data.code === 'gazetka') {
                            disableAtr = '';
                            disableClass = '';
                        }
                        if (typeof info.label !== 'undefined') {
                            let imageHTML = '';
                            let isImg = false;
                            let imgAlt = '';
                            let ralClass = '';
                            if (data.code.indexOf('pimcore_ral') > -1) {
                                ralClass = 'ral_swatch_' + info.panel_val;
                            } else if (typeof info.panel_val !== 'undefined') {
                                if (info.panel_val.indexOf('RUTWELD 10') > -1) {
                                    ralClass = 'ral_swatch_pink';
                                } else if (info.panel_val.indexOf('RUTWELD 12') > -1) {
                                    ralClass = 'ral_swatch_green';
                                } else {
                                    ralClass = '';
                                }
                            } else {
                                ralClass = '';
                            }
                            if (info.image.length > 1) {
                                isImg = true;
                                imgAlt = info.label;
                                imageHTML = '<img src="' + info.image + '" alt="' + info.label + '" /><span class="filter-tooltip ' + ralClass + '" style="display:none">' + info.label + '</span>';
                            } else {
                                if (data.code === 'gazetka') {
                                    imageHTML = '<span class="gazetka-switch"><span>Tak</span><span>Nie</span></span>';
                                } else {
                                    if (info.label.length > 0) {
                                        imgAlt = info.label;
                                        if (data.code.indexOf('pimcore_typ2') > -1) {
                                            imageHTML = '<span class="item_no_img ' + ralClass + '">' + info.panel_val + '</span><span class="filter-tooltip ' + ralClass + '" style="display:none">' + info.label + '</span>';
                                        } else {
                                            imageHTML = '<span class="item_no_img ' + ralClass + '">' + info.label + '</span><span class="filter-tooltip ' + ralClass + '" style="display:none">' + info.label + '</span>';
                                        }
                                    } else {
                                        imgAlt = value;
                                        if (data.code.indexOf('pimcore_typ2') > -1) {
                                            imageHTML = '<span class="item_no_img ' + ralClass + '">' + info.panel_val + '</span><span class="filter-tooltip ' + ralClass + '" style="display:none">' + value + '</span>';
                                        } else {
                                            imageHTML = '<span class="item_no_img ' + ralClass + '">' + value + '</span><span class="filter-tooltip ' + ralClass + '" style="display:none">' + value + '</span>';
                                        }
                                    }
                                }

                            }
                            let dataSort = ` data-sortit=`;
                            if (imgAlt.includes('"')) {
                                dataSort += `'` + imgAlt + `'`;
                            } else {
                                dataSort += `"` + imgAlt + `""`;
                            }
                            if (info.status === 'simple') {

                                iconsOutput += '<label class="miro-radiobutton filter_img ' + isActive + '' + disableClass + '" ' + disableAtr + ' role="button" data-img="' + info.image + '" ' + dataSort + '>';
                                iconsOutput += '<input ' + outCodes + ' ' + otherCodesOutput + ' ' + outCodesVal + ' class="item_input_not_rozmiar ' + disableClass + '" ' + disableAtr + ' style="display: none;" type="checkbox" name="iconfilter_' + data.code + '" data-code="' + data.code + '" ';
                                if (value.includes('"')) {
                                    iconsOutput += `value='` + value + `'`;
                                } else {
                                    iconsOutput += `value="` + value + `"`;
                                }

                                iconsOutput += isChecked + `>`;
                                iconsOutput += '<span>' + imageHTML + '</span>';
                                iconsOutput += '</label>';
                            }
                            // if (info.status !== 'simple') {
                            //     groupedIconsOut += '<label class="miro-radiobutton filter_img ' + isActive + '' + disableClass + '" ' + disableAtr + ' role="button" data-img="' + info.image + '" ' + dataSort + '>';
                            //     groupedIconsOut += '<input ' + outCodes + ' ' + otherCodesOutput + ' ' + outCodesVal + ' class="item_input_not_rozmiar ' + disableClass + '" ' + disableAtr + ' style="display: none;" type="checkbox" name="iconfilter_' + data.code + '" data-code="' + data.code + '" ' + isChecked + '>';
                            //     if (value.includes('"')) {
                            //         iconsOutput += `value='` + value + `'`;
                            //     } else {
                            //         iconsOutput += `value="` + value + `"`;
                            //     }
                            //
                            //     iconsOutput += isChecked + `>`;
                            //     groupedIconsOut += '<span>' + imageHTML + '<span>';
                            //     groupedIconsOut += '</label>';
                            // }
                        }
                    }
                    iconsOutput += groupedIconsOut;
                } //end !!!

                iconsOutput += '</div></div>';
                iconsIteration++;
            }
        }
        let prodID = '<?= $_product->getSku() ?>';
        let soa_cookie = getSpecialCookie('SOA_products');
        let soa_active = '';
        if(soa_cookie) {
            let parsed_cookie = JSON.parse(soa_cookie);
            if(prodID in parsed_cookie) {
                if(parsed_cookie[prodID] === 1) {
                    soa_active = 'is_active';
                }
            }
        }
        <?php if($logged === true): ?>
        let show_only_availables_html = '<div id="show_only_availables" class="icons_item" data-l="1" style="order:'+(defined.length+2)+';z-index:'+(defined.length+2)+';">';
        show_only_availables_html+='<div class="icons_label">Stan magazynowy</div>';
        show_only_availables_html+='<div class="icons_opts"><label class="'+soa_active+'" onclick="silentShowOAItems(this)"><span class="soa_btn">Tylko dostępne</span></label>';
        show_only_availables_html+='</div>';
        show_only_availables_html+='</div>';
        iconsOutput+=show_only_availables_html;
        <?php endif; ?>
        iconsOutput += '</div>';
        if (iconsIteration >= 1) {
            iconsOutput += '<div id="product_filter_button">Filtruj</div>';
        }
        $('.icons-product-view').html(iconsOutput);
        let iconsRows = $('#product_filter_icons .icons_item:not([data-l="1"])');
        iconsRows.each(function (rowindex, row) {
            let rowItemCode = $(row).attr('data-switch-code');
            //if(rowItemCode.indexOf('rozmiar') > -1) {
            let rowIconsParent = $(row).find('.icons_opts');
            let rowIcons = $(row).find('.icons_opts .miro-radiobutton');

            let newIcons = rowIcons;
            newIcons.sort(sortRozmiarsIcons);

            rowIconsParent.html('');
            newIcons.each((i_index, i_icon) => {
                rowIconsParent.append($(i_icon));
            });
            //}
        });

        function sortRozmiarsIcons(a, b) {
            let reA = /[^a-zA-Z]/g;
            let reN = /[^0-9_.]/g;
            let itemA = $(a).attr('data-sortit');
            let itemB = $(b).attr('data-sortit');
            let aA = itemA.replace(reA, "");
            let bA = itemB.replace(reA, "");
            if (aA === bA) {
                let aN = parseFloat(itemA.replace(reN, ""));
                let bN = parseFloat(itemB.replace(reN, ""));
                return aN === bN ? 0 : aN > bN ? 1 : -1;
            } else {
                return aA > bA ? 1 : -1;
            }
        }
    });
</script>
<table class="grouped-items-table fidexheadertable">

    <thead>
    <tr>
        <th class="skip-filter">

        </th>
        <?php
        if (strpos($headers, 'show_availables') !== false) {
            $fixedHeaders = str_replace('show_availables', 'show_availables_2', $headers);
        } else {
            $fixedHeaders = $headers;
        }
        ?>
        <?php echo $fixedHeaders; ?>
        <?php //if ($this->getCanShowProductPrice($_product)): ?>
        <?php if ($itemTys === true): ?>
            <th class="skip-filter a-center">Cena za TYS <br/> Po rabatach</th>
        <?php else: ?>
            <th class="skip-filter a-center">Cena za <?= implode(" / ", $jms) ?> <br/> Po rabatach</th>
        <?php endif; ?>
        <th class="a-center skip-filter"><?php echo $this->__('Cena opakowania <br>Po rabatach') ?></th>
        <?php //endif; ?>
        <!-- <th class="etykieta hidden skip-filter"></th> -->
        <?php if ($logged): //changed from ($_product->isSaleable()): ?>
            <th class="a-center skip-filter sorttable_nosort"><?php echo $this->__('Liczba<br/>opakowań') ?></th>
            <th class="a-center skip-filter sorttable_nosort"><?php echo $this->__('Liczba<br/>sztuk') ?></th>
        <?php endif; ?>
    </tr>
    </thead>
</table>

<?php
#if($_GET['hubi_search'] === '1') {
echo '<div class="search_this_table_wrap"><input name="search_this_table" type="text" placeholder="Znajdź produkt" id="search_this_table" /></div>';
if($_GET['tablesearch']):
    ?>
    <script type="text/javascript">
        jQuery(function($){
            let sVal = '<?= $_GET['tablesearch']?>'.toUpperCase(),
            firstChar = sVal.charAt(0),
            containNumbers = /\d/.test(sVal),
            url = new URL(window.location),
            search_url_params = new URLSearchParams(window.location.search);

            let isQ = (firstChar === 'Q' && sVal.length >= 4);
            if(containNumbers === true) {
                if(isQ || sVal.length >= 8) {
                    let thisRows = jQuery('tbody#super-product-table_items tr');
                    thisRows.each((indexRow, itemRow) => {
                        if (sVal.length > 0) {
                            let rowData = jQuery(itemRow).attr('data-searchthis').toUpperCase();
                            if (rowData.indexOf(sVal) > -1) {
                                jQuery(itemRow).show();
                            } else {
                                jQuery(itemRow).hide();
                            }
                        } else {
                            jQuery(itemRow).show();
                        }
                    });
                    let visibleRows = jQuery('tbody#super-product-table_items tr:visible');
                    if(visibleRows.length < 1) {
                        $('#search_this_table').val('');
                        thisRows.each((indexRow, itemRow) => {
                            jQuery(itemRow).show();
                        });
                    search_url_params.delete('tablesearch');
                    let new_params = search_url_params.toString(),
                    new_url = `${url.origin}${url.pathname}?${new_params}`;
                    history.pushState(null, null, new_url);                        
                    } else {
                        $('#search_this_table').val(sVal);
                        let scrollTarget = $('#product_tabs_groupedtable_tabbed_contents');
                        scrollTarget = scrollTarget.length ? scrollTarget : $('[name=' + scrollTarget.slice(1) +']');
                        if (scrollTarget.length) {
                            $('html, body').animate({
                                scrollTop: scrollTarget.offset().top-250
                            }, 750);
                        }                
                    }    
                }  else {
                    search_url_params.delete('tablesearch');
                    let new_params = search_url_params.toString(),
                    new_url = `${url.origin}${url.pathname}?${new_params}`;
                    history.pushState(null, null, new_url);
                }
            } else {
                    search_url_params.delete('tablesearch');
                    let new_params = search_url_params.toString(),
                    new_url = `${url.origin}${url.pathname}?${new_params}`;
                    history.pushState(null, null, new_url);
            }
        });
    </script>
    <?php
    endif;
#}
?>
<table class="grouped-items-table sortable" id="super-product-table">


    <thead>
    <tr>
        <?php
        if (isset($iconographsArray['gazetka'])):
            ?>
            <input type="checkbox" id="find_promotion" name="find_promotion" value="find_promotion">
            <label style="margin-left: 5px;" for="find_promotion">Produkty z gazetki</label><br>
        <?php
        endif;
        ?>
        <?php
        $headersCount = substr_count($headers, '<th'); ?>
        <th class="skip-filter"></th>
        <?php $headersCount++; ?>
        <?php echo $headers;
        echo $subheaders;
        $headersCount = $headersCount + substr_count($subheaders, '<th');
        ?>
        <?php //if ($this->getCanShowProductPrice($_product)): ?>
        <!-- <th class="skip-filter a-center">JM</th> -->
        <th class="skip-filter a-center">Cena za JM</th>
        <?php $headersCount++; ?>
        <th class="a-center skip-filter"><?php echo $this->__('Cena opakowania') ?></th>
        <?php $headersCount++; ?>
        <?php //endif; ?>
        <!-- <th class="etykieta hidden skip-filter"></th> -->
        <?php if ($logged): //changed from ($_product->isSaleable()): ?>
            <th class="a-center skip-filter sorttable_nosort"><?php echo $this->__('Liczba<br/>opakowań') ?></th>
            <th class="a-center skip-filter sorttable_nosort"><?php echo $this->__('Liczba<br/>sztuk') ?></th>
            <?php $headersCount++;
            $headersCount++; ?>
        <?php endif; ?>

    </tr>
    </thead>
    <tbody id="super-product-table_items">

    <?php
    //$timehelper->time(3);
    ?>
    <?php if ($_GET['hubitestnetwork'] == 'tak') {
        echo "<pre>";
        print_r($mainHEADERSTD);
        echo "<br>";
        print_r($defined);
        echo "</pre>";
    } ?>
    <?php $position = array();
    $pos = 0;
    $hiddenAttributes = array();
    ?>
    <?php if ($_hasAssociatedProducts):

        $saphelper = Mage::helper('sap/products');
        ?>
        <?php $position = array();
        $stan = '<p><a href="/customer/account/login">Zaloguj się, aby poznać stan.</a> </p>';
        $grupa = array();
        $searchablesArray = array();
        foreach ($_associatedProducts as $_item):

            $_item->setCenaDodatkowa(false);
            if ($_item->getStatus() == 2) {
                continue;
            }
            $zamienniki_itemdata = array();

            $hiddenAttributes[$_item->getId()] = '';
            $notHiddemAttributes[$_item->getSku()] = '';
            $rodzajPokryciaTD[$_item->getSku()] = '';
            $klasaAttrTD[$_item->getSku()] = '';
            $namePartial = array();
            $mainTDs[$_item->getSku()] = '';

            $searchablesArray[explode("_", $_item->getSku())[0]] = array();
            if (($_GET['hubitest'] !== 'tak') && ($_GET['hubi_change'] !== 'tak')):
                $additionalHEADERS['extra'] = 'extra';
                if (count($additionalHEADERS) > 0):
                    foreach ($additionalHEADERS as $code => $label):
                        if ($code === 'ilosc_szt_w_kg') {
                            #$continue;
                        }
                        $zamienniki_itemdata[$_item->getId()][$code] = $_item->getAttributeTextOrValue($code);
                        if (substr($_item->getSku(), 0, 4) == "3401" && strpos($_item->getSku(), "EXT") !== false && $code == 'extra') {
                            $val = '';
                            $val = '';

                            $hiddenAttributes[$_item->getId()] .= '<div class="item-attr_' . $code . '" data-s0="' . $val1 . '" data-s1="' . $val2 . '">';
                            $hiddenAttributes[$_item->getId()] .= '<b>' . "Typ:" . ' </b>';
                            $hiddenAttributes[$_item->getId()] .= '<span>' . "EXTRA" . '</span></div>';

                            continue;
                        }

                        $itemVal = $_item->getAttributeTextOrValue($code);

                        if (strlen($itemVal) > 0) {
                            $val1 = $_item->getStoreAtrTextOrValue($code, 0);
                            $val2 = $_item->getStoreAtrTextOrValue($code, 1);
                            $hiddenAttributes[$_item->getId()] .= '<div class="item-attr_' . $code . '" data-s0="' . $val1 . '" data-s1="' . $val2 . '">';
                            // $hiddenAttributes[$_item->getId()] .= '<div class="item-attr_'.$code.'">';
                            $hiddenAttributes[$_item->getId()] .= '<b>' . $_item->getResource()->getAttribute($code)->getStoreLabel() . ': </b>';

                            if (strpos($code, 'pimcore_ral') !== false) {
                                $hiddenAttributes[$_item->getId()] .= '<span>' . $val1 . ' - ' . $val2 . '</span>';
                            } elseif (strpos($code, 'pimcore_typ2') !== false) {
                                if ($val1 !== $val2) {
                                    $hiddenAttributes[$_item->getId()] .= '<span>' . $val1 . ' - ' . $val2 . '</span>';
                                } else {
                                    $hiddenAttributes[$_item->getId()] .= '<span>' . $itemVal . '</span>';
                                }
                            } else {
                                $hiddenAttributes[$_item->getId()] .= '<span>' . $itemVal . '</span>';
                            }

                            $hiddenAttributes[$_item->getId()] .= '</div>';
                        }
                    endforeach;
                endif;
                if (count($mainHEADERSTD) > 0):
                    foreach ($mainHEADERSTD as $code => $label):
                        $zamienniki_itemdata[$_item->getId()][$code] = $_item->getAttributeTextOrValue($code);
                        if (strpos($code, 'rozmiar') !== false) {
                            $itemVal = (float)filter_var($_item->getAttributeTextOrValue($code), FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
                            if ($itemVal == 0) {
                                $namePartial[] = 0;
                            } else {
                                $namePartial[] = $itemVal;
                            }
                        }
                        if (strpos($code, 'pimcore_ral') !== false) {
                            $mainTDs[$_item->getSku()] .= '<td  data-c="' . $code . '" style="position:relative;">';
                            $mainTDs[$_item->getSku()] .= '<span class="hidden-small">' . $_item->getResource()->getAttribute($code)->getStoreLabel() . ': </span>';
                            $val1 = $_item->getStoreAtrTextOrValue($code, 0);
                            $val2 = $_item->getStoreAtrTextOrValue($code, 1);
                            if ((strlen($val1) > 0) && (strlen($val2) > 0)) {
                                $mainTDs[$_item->getSku()] .= $val1 . " <span class='ral_tooltip'><span class='ral_tool'>?</span><span class='ral_content ral_swatch_" . $val1 . "'>" . $val2 . "</span></span>";
                            } else {
                                $mainTDs[$_item->getSku()] .= '';
                            }
                            $searchablesArray[explode("_", $_item->getSku())[0]][$code] = $val1 . ' - ' . $val2;
                            #$mainTDs[$_item->getSku()] .= $_item->getStoreAtrTextOrValue($code,0)." - ".$_item->getStoreAtrTextOrValue($code,1);

                            $mainTDs[$_item->getSku()] .= '</td>';
                        } elseif (strpos($code, 'pimcore_typ2') !== false) {
                            $mainTDs[$_item->getSku()] .= '<td  data-c="' . $code . '" style="position:relative;">';
                            $mainTDs[$_item->getSku()] .= '<span class="hidden-small">' . $_item->getResource()->getAttribute($code)->getStoreLabel() . ': </span>';
                            $val1 = $_item->getStoreAtrTextOrValue($code, 0);
                            $val2 = $_item->getStoreAtrTextOrValue($code, 1);
                            if ($val1 !== $val2) {
                                $rutweld_color = '';
                                if ($val1 === 'RUTWELD 10') {
                                    $rutweld_color .= ' ral_swatch_pink';
                                }
                                if ($val1 === 'RUTWELD 12') {
                                    $rutweld_color .= ' ral_swatch_green';
                                }
                                $mainTDs[$_item->getSku()] .= $val1 . " <span class='ral_tooltip'><span class='ral_tool'>?</span><span class='ral_content ral_swatch_" . $rutweld_color . "'>" . $val2 . "</span></span>";
                                $searchablesArray[explode("_", $_item->getSku())[0]][$code] = $val1 . ' - ' . $val2;
                            } else {
                                $mainTDs[$_item->getSku()] .= $_item->getAttributeTextOrValue($code);
                                $searchablesArray[explode("_", $_item->getSku())[0]][$code] = $_item->getAttributeTextOrValue($code);
                            }

                            $mainTDs[$_item->getSku()] .= '</td>';
                        } else {
                            $mainTDs[$_item->getSku()] .= '<td data-c="' . $code . '">';
                            $mainTDs[$_item->getSku()] .= '<span class="hidden-small">' . $_item->getResource()->getAttribute($code)->getStoreLabel() . ': </span>';
                            $mainTDs[$_item->getSku()] .= $_item->getAttributeTextOrValue($code);
                            $searchablesArray[explode("_", $_item->getSku())[0]][$code] = $_item->getAttributeTextOrValue($code);
                            $mainTDs[$_item->getSku()] .= '</td>';

                            // var_dump($code);
                            // var_dump($_item->getAttributeTextOrValue($code));
                        }
                    endforeach;
                endif;
            else:
                if (count($attributesNotHeaders) > 0):
                    foreach ($attributesNotHeaders as $code => $label):
                        if ($code === 'ilosc_szt_w_kg') {
                            continue;
                        }

                        $itemVal = $_item->getAttributeTextOrValue($code);
                        // if($code == "pimcore_ral"){
                        //     $itemVal=explode(" - ",$itemVal)[0];
                        //     $colorText =explode(" - ",$itemVal)[1];

                        // }
                        if (strlen($itemVal) > 0) {
                            $hiddenAttributes[$_item->getId()] .= '<div class="item-attr_' . $code . '">';
                            $hiddenAttributes[$_item->getId()] .= '<b>' . $_item->getResource()->getAttribute($code)->getStoreLabel() . ': </b>';
                            if (isset($_GET['network'])) {
                                var_dump($itemVal);
                                var_dump($_item->getCustomSkuQ());
                                var_dump($_item->getId());
                            }

                            $hiddenAttributes[$_item->getId()] .= '<span>' . $itemVal . '</span>';
                            $hiddenAttributes[$_item->getId()] .= '</div>';
                        }
                    endforeach;
                endif;


                if (count($attributesHeaders) > 0):
                    foreach ($attributesHeaders as $code => $label):
                        $itemVal = (float)filter_var($_item->getAttributeTextOrValue($code), FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
                        // var_dump($_item->getAttributeTextOrValue($code));

                        $notHiddemAttributes[$_item->getSku()] .= '<td>';
                        $notHiddemAttributes[$_item->getSku()] .= '<span class="hidden-small">' . strip_tags($label) . ': </span>';
                        $notHiddemAttributes[$_item->getSku()] .= $_item->getAttributeTextOrValue($code);
                        $notHiddemAttributes[$_item->getSku()] .= '</td>';
                        if ($itemVal == 0) {
                            $namePartial[] = 0;
                        } else {
                            $namePartial[] = $itemVal;
                        }

                    endforeach;
                endif;


                if (count($rodzajPorycia) > 0):
                    foreach ($rodzajPorycia as $code => $label) {
                        $rodzajPokryciaTD[$_item->getSku()] .= '<td data-c="' . $code . '">';
                        $rodzajPokryciaTD[$_item->getSku()] .= '<span class="hidden-small">' . $_item->getResource()->getAttribute($code)->getStoreLabel() . ': </span>';
                        $rodzajPokryciaTD[$_item->getSku()] .= $_item->getAttributeTextOrValue($code);
                        $rodzajPokryciaTD[$_item->getSku()] .= '</td>';
                    }
                endif;
                if (count($klasaAttr) > 0):
                    foreach ($klasaAttr as $code => $label) {
                        $klasaAttrTD[$_item->getSku()] .= '<td data-c="' . $code . '">';
                        $klasaAttrTD[$_item->getSku()] .= '<span class="hidden-small">' . $_item->getResource()->getAttribute($code)->getStoreLabel() . ': </span>';
                        $klasaAttrTD[$_item->getSku()] .= $_item->getAttributeTextOrValue($code);
                        $klasaAttrTD[$_item->getSku()] .= '</td>';
                    }
                endif;
            endif;
            if (count($namePartial) > 2)
                $namePartialString[$_item->getCustomSku()] = implode(' x ', $namePartial);
            if (array_key_exists($_item->getSku(), $grupa) == true && $_item->getStatus() === 2) continue;
            // file_put_contents('assspc', $_item->getSku().PHP_EOL, FILE_APPEND);
            if (strpos($_item->getCustomSku(), "_") === false) {
//                    if($_item->getStockItem()->getQty() > 0) {
                $grupa[$_item->getSku()][] = array(
                    'size' => str_replace(".0", "", number_format($_item->getWielkoscOpakowania(), 1, ".", "")),
                    'item' => $_item,
                    'id' => $_item->getId(),
                    'qty' => round($_item->getStockItem()->getQty(), 2));
//                    }
            }
            if (strpos($_item->getCustomSku(), "_")) {
                $_item->setSku(explode("_", $_item->getSku())[0]);
//                    if($_item->getStockItem()->getQty() > 0) {
                $grupa[$_item->getSku()][] = array(
                    'size' => str_replace(".0", "", number_format($_item->getWielkoscOpakowania(), 1, ".", "")),
                    'item' => $_item,
                    'id' => $_item->getId(),
                    'qty' => round($_item->getStockItem()->getQty(), 2));
//                    }
            }
//                    if($_item->getPosition())
//                        $position[$_item->getSku()] = $_item->getPosition();
            if (array_key_exists($_item->getSku(), $grupa) === false):
                $grupa[$_item->getSku()][] = array(
                    'size' => str_replace(".0", "", number_format($_item->getWielkoscOpakowania(), 1, ".", "")),
                    'item' => $_item,
                    'id' => $_item->getId(),
                    'qty' => round($_item->getStockItem()->getQty(), 2)

                );
            endif;
        endforeach;

// var_dump($position);
// echo '<pre>'.print_r($grupa,1).'<pre>';
// die();

        foreach ($grupa as $_items):?>
            <?php $_item = $_items[0]['item'];


//$timehelper->time(4);

            //echo $position[$_item->getSku()];
            if (strpos($_item->getCustomSku(), "_")) $_item->setSku(explode("_", $_item->getSku())[0]);
            if (count($grRozmCode[$_item->getSku()]) > 1) {
                $grRozmStr = implode(';', $grRozmCode[$_item->getSku()]);
            } else {
                $grRozmStr = '999;999';
            }
            $dataRozmTest = array();
            $dataNamePartialsRozmiars = array();
            $currentRozm = 0;
            foreach ($mainHEADERSTD as $index_code => $index_label) {
                if (strpos($index_code, 'rozmiar') !== false) {
                    $currentRozm++;
                    $itemVal = (float)filter_var($_item->getAttributeTextOrValue($index_code), FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
                    $dataRozmTest[] = $itemVal;
                    if ($currentRozm <= 2) {
                        $dataNamePartialsRozmiars[] = $index_code;
                    }
                }
            }
            if (count($dataRozmTest) > 0) {
                $dataRozmTestStr = implode(';', $dataRozmTest);
                $dataRozmSearch = implode(' x ', $dataRozmTest);
            } else {
                $dataRozmTestStr = $grupaRozmiary[$_item->getSku()];
                $dataRozmSearch = implode(' x ', $grupaRozmiary[$_item->getSku()]);
            }

            $searchNameParitals = array();
            foreach ($dataNamePartialsRozmiars as $r_index => $r_code) {
                $searchNameParitals[] = $_item->getAttributeTextOrValue($r_code);
            }
            $searchablesArray[$_item->getSku()]['name_part'] = implode(' x ', $searchNameParitals);
            $searchablesArray[$_item->getSku()]['name_full'] = $_item->getName();
            $searchablesArray[$_item->getSku()]['sku'] = $_item->getSku();
            $searchablesArray[$_item->getSku()]['q_number'] = $_item->getPimcoreNumberq();
            if (strpos($_item->getSku(), "TSM") !== false) {
                $searchablesArray[$_item->getSku()]['tsm'] = "na taśmie";
            }

            if (strpos($_item->getSku(), "982") !== false) {
                $searchablesArray[$_item->getSku()]['tsm'] = "wysoka";
            }

            if (strpos($_item->getSku(), "EXT") !== false) {
                $searchablesArray[$_item->getSku()]['tsm'] = "EXTRA";
            }


            if (strpos($_item->getSku(), "WO") !== false) {
                if (substr($_item->getSku(), 0, 2) == "14" || substr($_item->getSku(), 0, 2) == "51" || substr($_item->getSku(), 0, 2) == "61")
                    $searchablesArray[$_item->getSku()]['tsm'] = "wiaderko";
            }
            if (substr($_item->getSku(), 0, 4) == "1515" || substr($_item->getSku(), 0, 4) == "1516") {
                if (strpos($_item->getSku(), "BZT") !== false)
                    $searchablesArray[$_item->getSku()]['tsm'] = "zaslepiona";
            }
            if (substr($_item->getSku(), 0, 4) == "2316") {
                $tesMag = substr($_item->getSku(), -4);
                $tesMag = str_replace("T", "", $tesMag);

                if (is_numeric($tesMag))
                    $searchablesArray[$_item->getSku()]['tsm'] = "RAL";
            }

            $searchablesString = implode(';', $searchablesArray[$_item->getSku()]);
            $searchablesString = str_replace('"','',$searchablesString);
            $searchablesString = str_replace("'","",$searchablesString);
            $is_inox = false;
            $inox_class = '';
            if (strpos($_item->getSku(), 'I') === 0) {
                $is_inox = true;
                $inox_class = 'is_inox';
            }
            $gazetka = $_item->getGazetka();
            if ($_item->getSpecialFromDate() > date("Y-m-d") && $gazetka == 1)
                $gazetka = 0;

            if (empty($_item->getCenaDodatkowa()) == false && $c2Array[$testArray['cena_dodatkowa']]=='1' )                $gazetka = 0;
            ?>
            <?php
             // $_finalPriceInclTax = $this->helper('tax')->getPrice($_item, $_item->getFinalPrice(), true)
                $new_class = '';
                if(in_array($_item->getSku(), $wyroznienia_items)) {
                    $new_class = 'im_super_cool';
                }
              ?>
            <tr class="item_<?php echo $_item->getId() ?> tab-row <?= $new_class ?>" data-gazetka="<?= $gazetka ?>"
                data-rozmiary="<?= $dataRozmTestStr ?>" data-rozkey="<?= $grupaRozmiary[$_item->getSku()] ?>"
                data-searchthis="<?= $searchablesString ?>" data-sku="<?= $_item->getSku() ?>">
                <?php $addOfertaHTML = ''; ?>
                <?php if ($logged): ?>
                    <?php $ProductExistence = Mage::getModel('twojaoferta/import')->checkExistence($_item->getId(), $_product->getId()); ?>
                    <?php if ($ProductExistence == false):
                        $addOfertaHTML .= '<a title="Dodaj do Twojej oferty" 
                                data-parent="' . $_product->getId() . '" 
                                data-product="' . $_item->getId() . '" 
                                data-customer="' . $customerID . '" 
                                class="oferta-action add-to-ofera" 
                                id="' . $_item->getSku() . '">
                                <img src="' . Mage::getBaseUrl() . 'media/olegnax/athlete/default/deal.svg" alt="Dodaj do Twojej oferty" />
                            </a>';
                    else:
                        $addOfertaHTML .= '<a title="Usuń ten produkt z Twojej oferty"  
                                                            class="oferta-action is-in-ofera" 
                                                            data-parent="' . $_product->getId() . '" 
                                                            data-product="' . $_item->getId() . '" 
                                                            data-customer="' . $customerID . '" 
                                                            id="' . $_item->getSku() . '"></a>';
                    endif; ?>

                    <style type="text/css">
                        .fa-percent:before {
                            content: "\f295" !important;
                        }
                    </style>
                <?php endif;

                $headers = '';
                $headers2 = '';
                $headers .= '<td>';
                $headers .= '<div class="item_firstattributes"><div class="attributes_hidden addofertahtml">';
                $headers .= $addOfertaHTML;
                $headers .= '</div>';
                $headers .= '<div class="attributes_hidden"><span class="attrhidden_tool">i</span><div class="attrhidden_content"><div><b>Nr produktu: </b><span>' . ltrim($_item->getSku(),"W") . '</span></div>';
                $zamienniki_itemdata[$_item->getId()]['sku'] = $_item->getSku();
                if (empty($_item->getPimcoreNumberq()) == false) {
                    $headers .= '<div><b>Nr Q: </b><span>' . $_item->getPimcoreNumberq() . '</span></div>';
                    $zamienniki_itemdata[$_item->getId()]['pimcore_numer_q'] = $_item->getPimcoreNumberq();
                }
                if (substr($_item->getSku(), -1) == "K") {
                    $iloscWOpakowaniu = floor($_item->getData("orientacyjnie_sztuk_w_opak") * $_item->getWielkoscOpakowania());
                } else if ($jm === 'SZT' || $jm === 'TYS') {
                    $iloscWOpakowaniu = $_item->getWielkoscOpakowania();
                }

                if (substr($_item->getSku(), -1) == "K") {
                    if ($iloscWOpakowaniu > 0) {
                        $headers .= '<div class="ilosc_w_opak_hidden"><b>~Ilość szt. w opakowaniu: </b><span>' . $iloscWOpakowaniu . '</span></div>';
                    }
                } else {
                    if (empty($_item->getData('waga')) == false) {
                        $wagaTxt = round($_item->getData('waga'), 2);
                        $headers .= '<div class="waga_opak_hidden"><b>Waga opakowania: </b><span>' . $wagaTxt . ' KG</span></div>';
                    }
                }

                if (count($hiddenAttributes[$_item->getId()]) > 0) {
                    $headers .= $hiddenAttributes[$_item->getId()];
                }
                $headers .= '</div></div></div>';
                if (empty($gazetka) == false && $c2Array[$testArray['cena_dodatkowa']]=='1' && empty($_item->getCenaDodatkowa()))
                    $headers .= '<div class="item_firstattributes"  style="text-align: center;margin-left: auto;margin-right: auto;display: block;"><span style="width: 100%;  font-weight: 700; font-family: Montserrat; font-size: 12px; background: none; color:  #141414;" class="attrhidden_tool" title="Produkt z gazetki">Gazetka</span><div class="attrhidden_content"></div>';
                elseif (empty($gazetka) == false && $c2Array[$testArray['cena_dodatkowa']]=='0')
                    $headers .= '<div class="item_firstattributes"  style="text-align: center;margin-left: auto;margin-right: auto;display: block;"><span style="width: 100%;  font-weight: 700; font-family: Montserrat; font-size: 12px; background: none; color:  #141414;" class="attrhidden_tool" title="Produkt z gazetki">Gazetka</span><div class="attrhidden_content"></div>';   
                
                if (empty($_item->getCenaDodatkowa())==false && $orderCount>0)    
                    $headers .= '<div class="item_firstattributes icon_c2_list"  style="text-align: center;margin-left: auto;margin-right: auto;display: block;"><span style="width: 20px;  font-weight: 700; font-family: Montserrat; font-size: 12px; color:  #fff; background: none;" class="attrhidden_tool" title="Rabat za osiągnięcie progu '.Mage::getStoreConfig('simple24/simple24/obnizenie_cen').' zł"><img width=20px height=20px src="/media/wysiwyg/procent_2.png"/></span><div class="attrhidden_content"></div>';                           
                $headers .= '</td>';

                if ($logged) {
                    $stanMag = round($_item->getStockItem()->getQty(), 2);
                } else {
                    $stanMag = 'Zaloguj się, aby poznać stan.';
                }

                #$headers .= '<td class="product_name_td">';

                $tsm = "";
                $is_inox_span = '';
                if (strpos($_item->getSku(), "TSM") !== false) {
                    $tsm = "<b> - na taśmie</b>";
                }

                if (strpos($_item->getSku(), "982") !== false) {
                    $tsm = "<b> - wysoka</b>";
                }

                if (strpos($_item->getSku(), "EXT") !== false) {
                    $tsm = "<b> - EXTRA</b>";
                }


                if (strpos($_item->getSku(), "WO") !== false) {
                    if (substr($_item->getSku(), 0, 2) == "14" || substr($_item->getSku(), 0, 2) == "51" || substr($_item->getSku(), 0, 2) == "61")
                        $tsm = "<b> - wiaderko</b>";
                }
                if (substr($_item->getSku(), 0, 4) == "1515" || substr($_item->getSku(), 0, 4) == "1516") {
                    if (strpos($_item->getSku(), "BZT") !== false)
                        $tsm = "<b> - zaslepiona</b>";
                }
                if (substr($_item->getSku(), 0, 4) == "2316") {
                    $tesMag = substr($_item->getSku(), -4);
                    $tesMag = str_replace("T", "", $tesMag);

                    if (is_numeric($tesMag))
                        $tsm = "<b> - RAL</b>";
                }
                if ($is_inox === true) {
                    #$is_inox_span = '<b class="is_inox">INOX</b><br/>';
                }

                $nameParitals = array();
                foreach ($dataNamePartialsRozmiars as $r_index => $r_code) {
                    $nameParitals[] = $_item->getAttributeTextOrValue($r_code);
                }

                $headers2 .= '<td sorttable_customkey="' . $stanMag . '" class="dostepnosc_td"><span class="hidden-small">Stan magazynowy:</span> ';
                $current = 1;
                if (count($_items) > 1) {
                    // SELECT START
                    $selectcounter = 0;
                    $selected = "selected='selected'";
                    $sizes = array();
                    $selectedId = 0;
                    $qty = 0;
                    $disabledsArray = array();
                    foreach ($_items as $pack) {
                        if (round($pack['item']->getStockItem()->getQty(), 2) >= $qty) {
                            $qty = round($pack['item']->getStockItem()->getQty(), 2);
                            $selectedId = $pack['item']->getId();
                        }
                    }
                    $selectcurrent = 1;
                    $disabledCounter = 0;
                    $overAllItemsCounter = 0;
                    $optionsOutput = '';
                    $tempCounter = 0;
                    $optsArr = array();
                    foreach ($_items as $pack) {
                        if (in_array($pack['size'], $sizes) == false) {
                            $sizes[] = $pack['size'];
                        } else {
                            continue;
                        }
                        if ($selectcounter == 0) {
                            $optionsOutput .= "<option " . $selected;
                            $selected = '';
                            $selectcounter = 1;
                        } else {
                            $optionsOutput .= "<option ";
                        }
                        $packItemQty = round($pack['item']->getStockItem()->getQty(), 2);
                        $overAllItemsCounter++;
                        $isDisabled = false;
                        $isSelected = false;
                        if ($packItemQty > 0) {
                            $itemPackDisable = '';
                            if ($tempCounter == 0) {
                                $isSelected = true;
                                $tempCounter = 1;
                            } else {
                                $optionsOutput .= "<option ";
                            }
                        } else {
                            $disabledsArray[] = $_item->getSku() . "_" . $pack['id'];
                            $itemPackDisable = 'disabled';
                            $isDisabled = true;
                            $isSelected = false;
                            $disabledCounter++;
                        }
                        $optionsOutput .= " data-magqty='" . $packItemQty . "' " . $itemPackDisable . " value='" . $pack['id'] . "' data-isku='" . $pack['item']->getSku() . "' data-id='" . $pack['item']->getId() . "'>" . $pack['size'] . " " . $_item->getAttributeText('jednostka_miary') . "</option>";
                        $selectcurrent++;
                        switch (substr($pack['item']->getSku(), -1)) {
                            case 'T':
                                $jm = 'TYS';

                                break;
                            case 'S':
                                $jm = 'SZT';
                                break;
                            case 'O':
                                $jm = 'OPK';

                                break;
                            case 'K':
                                $jm = 'KG';

                                break;
                            case 'P':
                                $jm = 'KPL';
                                break;
                            case 'M':
                                $jm = 'MB';
                                break;

                            default:
                                $jm = 'SZT';
                        }
                        $wagaTxt = 0;
                        if (substr($pack['item']->getSku(), -1) == "K") {
                            $sztopak = floor($pack['item']->getData("orientacyjnie_sztuk_w_opak") * $pack['item']->getWielkoscOpakowania());
                            $wagaTxt = $pack['item']->getWielkoscOpakowania();
                        } else {
                            $sztopak = $pack['size'];
                            if (empty($pack['item']->getData('waga')) == false) {
                                $wagaTxt = round($pack['item']->getData('waga'), 2);
                            }
                        }
                        $testZbrToolTip = $pack['item']->getOpakowanieTooltip();
                        if (strlen($testZbrToolTip) > 0) {
                            $wielkosc_opakowanie = intval($pack['item']->getWielkoscOpakowania()) * intval($pack['item']->getData('orientacyjnie_sztuk_w_opak'));
                        } else {
                            $wielkosc_opakowanie = $pack['item']->getWielkoscOpakowania();
                        }
                        $optsArr[] = array(
                            'data-magqty' => $packItemQty,
                            'disabled' => $isDisabled,
                            'selected' => $isSelected,
                            'value' => $pack['id'],
                            'item_sku' => $pack['item']->getSku(),
                            'item_id' => $pack['item']->getId(),
                            'size' => $pack['size'],
                            'weight' => $wagaTxt,
                            'jm' => $_item->getAttributeText('jednostka_miary'),
                            'opak_jm' => $jm,
                            'sztopak' => str_replace(' ', '', $sztopak),
                            'opakowanie_szt' => str_replace(' ', '', $wielkosc_opakowanie)
                        );
                    }
                    $selectDisabled = '';
                    $selectDisabledFlag = false;
                    $newSelectData = array(
                        'options' => $optsArr,
                        'is_disabled' => false,
                        'opts_count' => count($optsArr),
                        'disabled_opts' => $disabledCounter
                    );
                    if ($disabledCounter === $overAllItemsCounter) {
                        $selectDisabled = 'disabled="disabled"';
                        $selectDisabledFlag = true;
                        $newSelectData['is_disabled'] = true;
                    }
                    $selectOtput = "<select id='" . $_item->getSku() . "' class='" . $opkZbrClass . " opak_select' data-d='" . $disabledCounter . "' data-o='" . $overAllItemsCounter . "' " . $selectDisabled . ">";
                    if ($selectDisabledFlag === true) {
                        $selectOtput .= $optionsOutput;
                    } else {
                        $newOpts = '';
                        $newSelectData['options'] = array();
                        $disabled_opts = 0;
                        foreach ($optsArr as $opt_index => $opt_data) {
                            $newOpts .= '<option';
                            $new_opt_html = '<option';
                            if ($opt_data['selected'] === true) {
                                $newOpts .= ' selected="selected"';
                                $new_opt_html .= ' selected="selected"';
                                $selectedItemID = $opt_data['value'];
                                $selectedSztOpak = $opt_data['sztopak'];
                                $selectedOpak = str_replace(' ', '', $opt_data['size']);
                                $selectOpakSzt = $opt_data['opakowanie_szt'];
                                $selectedMagQty = $opt_data['data-magqty'];
                            }
                            if ($opt_data['disabled'] === true) {
                                $newOpts .= ' disabled';
                                $new_opt_html .= ' disabled';
                                $disabled_opts++;
                            }
                            $newOpts .= ' data-jm="' . $opt_data['jm'] . '" data-waga="' . $opt_data['weight'] . '" data-sztopak="' . $opt_data['sztopak'] . '" data-opak="' . str_replace(' ', '', $opt_data['size']) . '" data-magqty="' . $opt_data['data-magqty'] . '" value="' . $opt_data['value'] . '" data-isku="' . $opt_data['item_sku'] . '" data-id="' . $opt_data['item_id'] . '">' . $opt_data['size'] . ' ' . $opt_data['jm'] . '</option>';
                            $new_opt_html .= ' data-jm="' . $opt_data['jm'] . '" data-waga="' . $opt_data['weight'] . '" data-sztopak="' . $opt_data['sztopak'] . '" data-opak="' . str_replace(' ', '', $opt_data['size']) . '" data-magqty="' . $opt_data['data-magqty'] . '" value="' . $opt_data['value'] . '" data-isku="' . $opt_data['item_sku'] . '" data-id="' . $opt_data['item_id'] . '">' . $opt_data['size'] . ' ' . $opt_data['jm'] . '</option>';
                            $newSelectData['options'][] = array(
                                    'data' => $opt_data,
                                    'value' => $opt_data['size'] . ' ' . $opt_data['jm'],
                                    'html' => $new_opt_html
                            );
                        }
                        $new_options = '';
                        foreach ($newSelectData['options'] as $index_opt=>$data_opt) {
                            if($data_opt['data']['disabled'] !== true) {
                                $new_options .= $data_opt['html'];
                                $newSelectData['single_output'] = $data_opt['value'];
                            }
                        }
                        //$selectOtput .= $newOpts;
                        $selectOtput .= $new_options;
                    }
                    $new_select_output = '';
                    $selectOtput .= "</select>";
                    if(($newSelectData['opts_count'] - 1) === $newSelectData['disabled_opts']) {
                        $selectOtput = $newSelectData['single_output'];
                    }
                    // SELECT END
                    $counter = 0;
                    foreach ($_items as $pack) {
                        if (in_array($_item->getSku() . "_" . $pack['id'], $disabledsArray) && $selectDisabledFlag !== true) {
                            #item hidden;
                            $itemDisplay = 'style="display:none;"';
                        } else {
                            #item shown;
                            if ($counter === 0) {
                                $itemDisplay = 'style="display:inline-block;"';
                                $counter++;
                            } else {
                                $itemDisplay = 'style="display:none;"';
                            }

                        }
                        $headers2 .= "<span " . $itemDisplay . " id='stock_" . $_item->getSku() . "_" . $pack['id'] . "' class='stock_" . $_item->getSku() . "'";
                        if ($logged) {
                            if ($pack['qty'] == 0) {
                                if (empty($_item->getDataDostawy()) == false) {
                                    // $headers2.="> <span class='blister_tooltip tooltip'><img src='/media/pro/data_dostawy.png' style='height:20px;width:auto' class='priceTooltip'><span class='tooltiptext tooltip-top' style='width:300px;'>Przewidywana data dostawy ".$_item->getDataDostawy()."</span></span>";
                                    $headers2 .= "><span>" . $pack['qty'] . "</span>";
                                    $zamienniki_itemdata[$pack['id']]['stan_na_mag'] = $pack['qty'];
                                } else {
                                    $headers2 .= "><span>" . $pack['qty'] . "</span>";
                                    $zamienniki_itemdata[$pack['id']]['stan_na_mag'] = $pack['qty'];
                                }
                            } else {
                                $headers2 .= "><span>" . $pack['qty'] . "</span>";
                                $zamienniki_itemdata[$pack['id']]['stan_na_mag'] = $pack['qty'];
                            }

                        } else {
                            $headers2 .= ">Zaloguj się, aby poznać stan.";
                        }
                        $headers2 .= "</span>";
                    }
                } else {

                    if ($stanMag == 0) {
                        if (empty($_item->getDataDostawy()) == false) {
                            // $headers2.="<span class='blister_tooltip tooltip'><img src='/media/pro/data_dostawy.png' style='height:20px;width:auto' class='priceTooltip'><span class='tooltiptext tooltip-top' style='width:300px;'>Przewidywana data dostawy ".$_item->getDataDostawy()."</span></span>";
                            $headers2 .= "<span>" . $stanMag . "</span>";
                            $zamienniki_itemdata[$_item->getId()]['stan_na_mag'] = $stanMag;
                        } else {
                            $headers2 .= "<span>" . $stanMag . "</span>";
                            $zamienniki_itemdata[$_item->getId()]['stan_na_mag'] = $stanMag;
                        }
                    } else {
                        $headers2 .= "<span>" . $stanMag . "</span>";
                        $zamienniki_itemdata[$_item->getId()]['stan_na_mag'] = $stanMag;
                    }

                }
                $headers2 .= '</td>';

                $opakowanieZbiorczeTooltip = $_item->getOpakowanieTooltip();
                $opkZbrClass = '';
                if (strlen($opakowanieZbiorczeTooltip) > 0) {
                    $opkZbrClass = 'blister_opak';
                }
                $headers2 .= '<td><div  class="item_' . $opkZbrClass . '_wrap"><span class="hidden-small">Wielkość opakownia:</span> ';
                if (count($_items) > 1) {
                    $headers2 .= $selectOtput;
                } else {
                    $headers2 .= str_replace(".0", "", number_format($_item->getWielkoscOpakowania(), 1, ".", " ")) . " " . $_item->getAttributeText('jednostka_miary');
                }
                $headers2 .= $opakowanieZbiorczeTooltip;
                $headers2 .= '</div></td>';

                // $headers2 .= '<td style="display:none;"><span class="hidden-small">Jednostka miary:</span> '.$_item->getAttributeText('jednostka_miary').'</td>';
                // $headers2 .= '<td><span class="hidden-small">'.$mobilesztukilabel.':</span> '.$_item->getData('orientacyjnie_sztuk_w_opak').'</td>';


                echo $headers;
                // var_dump($notHiddemAttributes);
                if (($_GET['hubitest'] !== 'tak') && ($_GET['hubi_change'] !== 'tak')):
                    echo $mainTDs[$_item->getSku()];
                else:
                    if (strlen($notHiddemAttributes[$_item->getSku()]) > 0) {
                        echo $notHiddemAttributes[$_item->getSku()];
                    }
                    if (strlen($rodzajPokryciaTD[$_item->getSku()]) > 0) {
                        echo $rodzajPokryciaTD[$_item->getSku()];
                    }
                    if (strlen($klasaAttrTD[$_item->getSku()]) > 0) {
                        echo $klasaAttrTD[$_item->getSku()];
                    }
                endif;

                echo $headers2;

                ?>

                <?php
                //$timehelper->time(5);
                ?>


                <?php
                $customer_id = 0;
                if ($logged) {
                    $jmPrzedRabatem = $_item->getCenaJednostkowa();


                    if ($logged) {


                    }


                    // $jmPoRabacie = $saphelper->getCenaJednostkowaPoRabacie($_item);

                    $jmPoRabacie = $saphelper->getCenaJednostkowaPoRabacieByCustomerId($_item, $customer_id);
                    if (empty($gazetka) == false)
                        $jmPoRabacie = $jmPrzedRabatem;
                    //  var_dump($_item->getId());
                    // var_dump($jmPoRabacie);
                    switch (substr($_item->getSku(), -1)) {
                        case 'T':
                            $jm = 'TYS';

                            break;
                        case 'S':
                            $jm = 'SZT';
                            break;
                        case 'O':
                            $jm = 'OPK';

                            break;
                        case 'K':
                            $jm = 'KG';

                            break;
                        case 'P':
                            $jm = 'KPL';
                            break;
                        case 'M':
                            $jm = 'MB';
                            break;

                        default:
                            $jm = 'SZT';
                    }
                    $opakZbiorcze = '';
                    if ($hasKG) {
                        if ((substr($_item->getSku(), -1) == "K") || ($jm === 'SZT' || $jm === 'TYS')) {
                            if (count($_items) > 1) {
                                $counter = 0;
                                echo '<td data-a="">';
                                foreach ($_items as $pack) {
                                    if (substr($_item->getSku(), -1) == "K") {
                                        $iloscWOpakowaniu = floor($pack['item']->getData("orientacyjnie_sztuk_w_opak") * $pack['item']->getWielkoscOpakowania());
                                    } else if ($jm === 'SZT' || $jm === 'TYS') {
                                        $iloscWOpakowaniu = $pack['item']->getWielkoscOpakowania();
                                    }

                                    if (in_array($_item->getSku() . "_" . $pack['id'], $disabledsArray) && $selectDisabledFlag !== true) {
                                        $itemStyle = 'display: none;';
                                    } else {
                                        $itemStyle = 'display: none;';
                                        if ($selectDisabledFlag !== true) {
                                            if ($selectedItemID === $pack['id']) {
                                                if ($counter == 0) {
                                                    $itemStyle = 'display: inline-block;';
                                                    $counter++;
                                                    $datastyle = '22';
                                                }
                                            }
                                        } else {
                                            if ($counter == 0) {
                                                $itemStyle = 'display: inline-block;';
                                                $counter++;
                                            }
                                        }
                                    }
                                    if ($iloscWOpakowaniu > 0) {
                                        $ilosc_w_opak_txt = $iloscWOpakowaniu;
                                    } else {
                                        $ilosc_w_opak_txt = 'n/d';
                                    }
                                    echo '<span id="jm_opak_' . $_item->getSku() . '_' . $pack['id'] . '" class="jm_opak_' . $_item->getSku() . '" style="' . $itemStyle . '"><span class="hidden-small">Ilość sztuk w opakowaniu</span>' . $ilosc_w_opak_txt . '</span>';
                                }
                                echo '</td>';
                            } else {
                                if (substr($_item->getSku(), -1) == "K") {
                                    $iloscWOpakowaniu = floor($_item->getData("orientacyjnie_sztuk_w_opak") * $_item->getWielkoscOpakowania());
                                } else if ($jm === 'SZT' || $jm === 'TYS') {
                                    $iloscWOpakowaniu = $_item->getWielkoscOpakowania();
                                }
                                if ($iloscWOpakowaniu > 0) {
                                    $ilosc_w_opak_txt = $iloscWOpakowaniu;
                                } else {
                                    $ilosc_w_opak_txt = 'n/d';
                                }
                                echo '<td data-b=""><span id="jm_opak_' . $_item->getId() . '"><span class="hidden-small">Ilość sztuk w opakowaniu</span>' . $ilosc_w_opak_txt . '</span></td>';
                            }
                        } else {
                            $iloscWOpakowaniu = $_item->getWielkoscOpakowania();
                            $testOpakowanieTooltip = $_item->getOpakowanieTooltip();
                            if (strlen($testOpakowanieTooltip) > 0) {
                                $iloscWOpakowaniu = intval($_item->getWielkoscOpakowania()) * intval($_item->getData('orientacyjnie_sztuk_w_opak'));
                                echo "<td  data-c=''>" . $iloscWOpakowaniu . "</td>";
                            } else {
                                $iloscWOpakowaniu = $_item->getWielkoscOpakowania();
                                echo "<td  data-c=''>n/d</td>";
                            }

                        }
                    }

                    echo '<td class="hiddenprice  a-center jednostka_miary_enabled"><span class="hidden-small">Jednostka miary:</span>' . $jm . '</td>';


                    if (count($_items) > 1) {
                        $counter = 0;
                        echo '<td class="hiddenprice a-center jm-cena" sorttable_customkey="' . $jmPoRabacie . '">';
                        foreach ($_items as $pack) {
                            $jmC2 = 0;
                            $jmPrzedRabatem = $pack['item']->getCenaJednostkowa();
                            $jmPoRabacie = $saphelper->getCenaJednostkowaPoRabacieByCustomerId($pack['item'], $customer_id);
                            if (empty($pack['item']->getCenaDodatkowa()) == false) {
                                $jmC2 = $saphelper->getCenaC2JednostkowaPoRabacieByCustomerId($pack['item'], $customer_id);
                            }
                            if (in_array($_item->getSku() . "_" . $pack['id'], $disabledsArray) && $selectDisabledFlag !== true) {
                                $itemStyle = 'display: none;';
                            } else {
                                $itemStyle = 'display: none;';
                                if ($selectDisabledFlag !== true) {
                                    if ($selectedItemID === $pack['id']) {
                                        if ($counter == 0) {
                                            $itemStyle = 'display: inline-block;';
                                            $counter++;
                                            $datastyle = '22';
                                        }
                                    }
                                } else {
                                    if ($counter == 0) {
                                        $itemStyle = 'display: inline-block;';
                                        $counter++;
                                    }
                                }
                            }

                            if(empty($_item->getCenaDodatkowa())==false  && $c2Array[$testArray['cena_dodatkowa']]=='0'  && $orderCount>0){
                                $jmPoRabacie = $saphelper->getCenaJednostkowaPoRabacieByCustomerId($_item, $customer_id);

                                $discountP = Mage::getStoreConfig('simple24/simple24/obnizenie_cen');
                                $txt_old = 'Rabat za przekroczenie progu ' . $discountP . ' zł produktów oznaczonych <img width=20px height=20px src="/media/wysiwyg/procent_2.png"/>';
                                echo '<span id="jm_price_' . $_item->getSku() . '_' . $pack['id'] . '"  class="jm_price_' . $_item->getSku() . ' cenac2-old" style="line-height: 1.4;' . $itemStyle . '" ><span class="twoja-cena-jm"">' . number_format($jmPoRabacie, 2, ',', '') . ' zł</span>
                                <span class="twoja-cena-jm cenax-tool" style="color:green; width:100%;display: block;">' . number_format($jmC2, 2, ',', '') . ' zł<span class="tool" style="display:none">'.$txt_old.'</span></span>
                                </span>';

                            }
                            elseif(empty($_item->getCenaDodatkowa())==false  && $c2Array[$testArray['cena_dodatkowa']]=='1'){
                                $discountP = Mage::getStoreConfig('simple24/simple24/obnizenie_cen');
                                $txt_old = 'Rabat za przekroczenie progu ' . $discountP . ' zł produktów oznaczonych <img width=20px height=20px src="/media/wysiwyg/procent_2.png"/>';
                                echo '<span id="jm_price_' . $_item->getSku() . '_' . $pack['id'] . '"  class="jm_price_' . $_item->getSku() . ' cenac2-old" style="color:gray;line-height: 1.4;' . $itemStyle . '"><span class="twoja-cena-jm" style="color:gray; width:100%; display: block; text-decoration: line-through;">' . number_format($jmPoRabacie, 2, ',', '') . ' zł</span>
                                <span class="hidden-small">Cena ' . $jm . ' po rabatach:</span> <span class="twoja-cena-jm cenax-tool" style="text-decoration: none;">' . number_format($jmC2, 2, ',', '') . ' zł<span class="tool" style="display:none">'.$txt_old.'</span></span>
                                </span>';
                            }
                            else{
                                $discountP = Mage::getStoreConfig('simple24/simple24/obnizenie_cen');
                                $txt_old = 'Rabat za przekroczenie progu ' . $discountP . ' zł produktów oznaczonych';
                                echo '<span id="jm_price_' . $_item->getSku() . '_' . $pack['id'] . '"  class="jm_price_' . $_item->getSku() . ' cenac2-old" style="line-height: 1.4;' . $itemStyle . '"><span class="twoja-cena-jm"">' . number_format($jmPoRabacie, 2, ',', '') . ' zł</span>
                 
                                </span>';

                            }
                        }
                        echo '</td>';
                    } else {
                        if (empty($_item->getCenaDodatkowa())) {
                                                            $jmPoRabacie = $saphelper->getCenaJednostkowaPoRabacieByCustomerId($_item, $customer_id);
                                                            // var_dump($jmPoRabacie);
                            echo '<td class="hiddenprice a-center jm-cena" sorttable_customkey="' . $jmPoRabacie . '"><span id="jm_price_' . $_item->getId() . '"><span class="hidden-small">Cena ' . $jm . ' po rabatach:</span> <span class="twoja-cena-jm">' . number_format($jmPoRabacie, 2, ',', '') . ' zł</span></span></td>';
                        } else {
                            echo '<td class="hiddenprice a-center jm-cena" sorttable_customkey="' . $jmPoRabacie . '">';

                            $jmC2 = $saphelper->getCenaC2JednostkowaPoRabacieByCustomerId($_item, $customer_id);

                            if(empty($_item->getCenaDodatkowa())==false  && $c2Array[$testArray['cena_dodatkowa']]=='1'){
                                $discountP = Mage::getStoreConfig('simple24/simple24/obnizenie_cen');
                                $txt_old = 'Rabat za przekroczenie progu ' . $discountP . ' zł produktów oznaczonych <img width=20px height=20px src="/media/wysiwyg/procent_2.png"/>';
                                echo '<span id="jm_price_' . $_item->getId() . '"><span class="hidden-small">Cena ' . $jm . ' po rabatach:</span> <span class="twoja-cena-jm cenac2-old" style="width: 100%;text-decoration: line-through;display: block;font-size: 14px;color: gray;line-height:1.4;">' . number_format($jmPoRabacie, 2, ',', '') . ' zł</span></span>';
                                echo '<span id="jm_price_' . $_item->getId() . '"><span class="hidden-small">Cena ' . $jm . ' po rabatach:</span> <span class="twoja-cena-jm">' . number_format($jmC2, 2, ',', '') . ' zł</span></span>';
                            }

                            elseif(empty($_item->getCenaDodatkowa())==false  && $c2Array[$testArray['cena_dodatkowa']]=='0' && $orderCount>0){
                                $discountP = Mage::getStoreConfig('simple24/simple24/obnizenie_cen');
                                $txt_old = 'Rabat za przekroczenie progu ' . $discountP . ' zł produktów oznaczonych <img width=20px height=20px src="/media/wysiwyg/procent_2.png"/>';
                                echo '<span id="jm_price_' . $_item->getId() . '"><span class="hidden-small">Cena ' . $jm . ' po rabatach:</span> <span class="twoja-cena-jm cenac2-old" style="width: 100%;display: block;font-size: 14px;line-height:1.4;">' . number_format($jmPoRabacie, 2, ',', '') . ' zł</span></span>';
                                echo '<span id="jm_price_' . $_item->getId() . '" style="color: green"><span class="hidden-small">Cena ' . $jm . ' po rabatach:</span> <span class="twoja-cena-jm cenax-tool" style="color: green">' . number_format($jmC2, 2, ',', '') . ' zł<span class="tool" style="display:none">'.$txt_old.'</span></span></span>';
                            }                            
                            else{
                                echo '<span id="jm_price_' . $_item->getId() . '"><span class="hidden-small">Cena ' . $jm . ' po rabatach:</span> <span class="twoja-cena-jm">' . number_format($jmPoRabacie, 2, ',', '') . ' zł</span></span>';                                
                            }

                            echo '</td>';


                        }


                        // echo '<td class="hiddenprice a-center"><span class="hidden-small">Cena jednostkowa po rabatach:</span> '.$jmPoRabacie.' zł</td>';
                    }
                } else {
                    echo '<td class="hiddenprice a-center"><p><a href="/customer/account/login">Zaloguj się, aby poznać cenę.</a> </p></td>';
                } ?>

                <?php if ($this->getCanShowProductPrice($_product)): ?>
                    <td class="a-center" sorttable_customkey="<?= $_item->getFinalPrice() ?>"><span
                                class="hidden-small">Cena opakowania po rabatach:</span>
                        <?php if ($this->getCanShowProductPrice($_item)): ?>
                            <?php if (count($_items) > 1) {
                                $counter = 0;
                                foreach ($_items as $pack) {
                                    if (in_array($_item->getSku() . "_" . $pack['id'], $disabledsArray) && $selectDisabledFlag !== true) {
                                        $itemStyle = 'display: none;';
                                    } else {
                                        $itemStyle = 'display: none;';
                                        if ($selectDisabledFlag !== true) {
                                            if ($selectedItemID === $pack['id']) {
                                                if ($counter == 0) {
                                                    $itemStyle = 'display: inline-block;';
                                                    $counter++;
                                                    $datastyle = '22';
                                                }
                                            }
                                        } else {
                                            if ($counter == 0) {
                                                $itemStyle = 'display: inline-block;';
                                                $counter++;
                                            }
                                        }
                                    }
                                    echo "<span id='price_" . $_item->getSku() . "_" . $pack['id'] . "' class='price_" . $_item->getSku() . "' style='" . $itemStyle . "'>";
                                    echo $this->getPriceHtml($pack['item'], true);
                                    echo "</span>";
                                }

                            } else {
                                echo $this->getPriceHtml($_item, true);
                            }
                            //echo $this->getTierPriceHtml($_item);
                        endif; ?>
                    </td>
                <?php endif; ?>
                <?php
                $athleteHelper = $this->helper('athlete');
                $liClass = '';
                $tdclass = '';
                $ITEMID = $_item->getId();
                // $pro = Mage::getModel('catalog/product')->load($ITEMID); //load associated product id

                if ($athleteHelper->isNew($_item)) {
                    $liClass .= '<span class="etykieta new-label">NOWY</span>';
                }

                if ($athleteHelper->isWyprzedaz($_item)) {
                    $liClass .= '<span class="etykieta sale-label wyprz-label">WYPRZEDAŻ</span>';
                    //$liClass = '<span class="etykieta"><img src="/media/wysiwyg/wyprzedaz_urodzinowa.png" style="max-width: 50px" title="Wyprzedaż"/> </span>';
                }

                // if (($athleteHelper->isPromocja($_item)) || ($pro['tier_price'] != NULL)) {
                //     //$liClass = '<span class="etykieta sale-label promocja-gazetkowa"></span>';
                //     $liClass .= '<img style="width: 90px;display: block;margin: 10px auto;vertical-align: top;" src = "/media/wysiwyg/ikonografikacech/PROMOCJA-ikona-400X30px.png"/>';
                // }
                if ($athleteHelper->isPrezent($_item)) {
                    $liClass .= '<img width="25px" src = "/media/wysiwyg/ikonografikacech/ikonka-slonce-400x400px.png"/>';
                }

                ?>
                <?php #echo '<td style="vertical-align: top;" class="etykieta clearfix hidden">'.$liClass .'</td>';
                ?>

                <?php
                $customsalable = 0;
                foreach ($_items as $pack) {
                    $customsalable += $pack['qty'];
                }


                ?>
                <?php if ($logged): //changed from ($_product->isSaleable()): ?>
                    <?php
                    $opakowanieZbiorcze = $_item->getOpakowaniaZbiorcze();
                    $zamienniki = $_item->getZamienniki();
                    $testFlag = 0;
                    // if (!$opakowanieZbiorcze) {
                    //     $itemsku = $pro->getSku();
                    //     $correctItemId = Mage::getModel('catalog/product')->getResource()->getIdBySku($itemsku);
                    //     $correctItem = Mage::getModel('catalog/product')->load($correctItemId);
                    //     $opakowanieZbiorcze = $correctItem->getOpakowaniaZbiorcze();
                    //     $zamienniki = $correctItem->getZamienniki();
                    //     $testFlag = 1;
                    // }
                    $isZam = false;

                    if ($zamienniki && $zamienniki !== '') {
                        if (empty($zamienniki) == false) {
                            $isZam = true;

                        }
                    }
                    $tdQTYColspan = '';
                    $tdSZTQTYstyle = '';
                    if (($stanMag > 0 && $_item->isSaleable()) || $customsalable > 0) :
                    else:
                        $tdQTYColspan .= 'colspan="2"';
                        $tdSZTQTYstyle .= 'style="display:none"';
                    endif; ?>
                    <?php
                    $productZew = (strlen(trim($_item->getData('dostawa_zew'))) > 0);
                    $productZewClassOpkTd = '';
                    if ($logged && (($stanMag > 0 && $_item->isSaleable()) || $customsalable > 0)) {
                        $productZewClassOpkTd = $productZew ? 'item-dostawa-zew' : '';
                    }
                    $productZewClass = $productZew ? 'item-dostawa-zew' : '';
                    ?>
                    <td class="a-left opk_container quantity_container <?= $productZewClassOpkTd ?>"
                        data-opakowanie_zbiorcze="<?= $opakowanieZbiorcze ?>" <?= $tdQTYColspan ?>
                        data-test_flag="<?= $testFlag ?>">
                        <div class="qty-input_content">
                            <span class="hidden-small">Ilość: </span>
                            <?php if ($logged): ?>
                                <?php if (($stanMag > 0 && $_item->isSaleable()) || $customsalable > 0) : ?>
                                    <?php
                                    $ofertaModel = Mage::getModel('twojaoferta/import');
                                    $sumaWkoszyku = $ofertaModel->productCartQty($_item->getSku());
                                    if ($sumaWkoszyku > 0) {
                                        $cartqtyText = '(' . $sumaWkoszyku . ')';
                                    } else {
                                        $cartqtyText = '';
                                    }
                                    if ((int)$opakowanieZbiorcze > 0):
                                        $inputOpakZbr = 1;
                                    else:
                                        $inputOpakZbr = 0;
                                    endif;
                                    $itemMagQty = round($_item->getStockItem()->getQty(), 2);
                                    ?>
                                    <span title="Ilośc w koszyku" class="cart-quantity <?php echo $_item->getSku() ?>"
                                          style="cursor: help;"><?= $cartqtyText ?></span>
                                    <?php if ((count($_items) > 1) && $selectDisabledFlag !== true): ?>
                                        <input
                                                data-opakzbr="<?= $inputOpakZbr ?>"
                                                id="super_<?= $_item->getCustomSku(); ?>"
                                                type="text" name="super_group[<?php echo $selectedItemID ?>]"
                                                maxlength="12"
                                                max-qty="<?php echo $customsalable ?>"
                                                title="Wpisz ilość opakowań"
                                                class="input-text package_qty item_qty_<?= $_item->getSku() ?>"
                                                placeholder="Ilość opk."/>
                                    <?php else: ?>
                                        <input
                                                data-opakzbr="<?= $inputOpakZbr ?>"
                                                id="super_<?= $_item->getCustomSku(); ?>"
                                                type="text"
                                                name="super_group[<?php echo $_item->getId() ?>]"
                                                maxlength="12"
                                                max-qty="<?php echo $customsalable ?>"
                                                title="Wpisz ilość opakowań"
                                                class="input-text package_qty item_qty_<?= $_item->getSku() ?>"
                                                placeholder="Ilość opk."/>
                                    <?php endif; ?>
                                    <div class="opakowania_zbr">
                                        <?php if (count($_items) > 1): ?>
                                            <?php $counter = 0; ?>
                                            <?php foreach ($_items as $pack): ?>
                                                <?php
                                                if (in_array($_item->getSku() . "_" . $pack['id'], $disabledsArray) && $selectDisabledFlag !== true) {
                                                    $itemStyle = 'display: none;';
                                                } else {
                                                    $itemStyle = 'display: none;';
                                                    if ($selectDisabledFlag !== true) {
                                                        if ($selectedItemID === $pack['id']) {
                                                            if ($counter == 0) {
                                                                $itemStyle = 'display: inline-block;';
                                                                $counter++;
                                                                $datastyle = '22';
                                                            }
                                                        }
                                                    } else {
                                                        if ($counter == 0) {
                                                            $itemStyle = 'display: inline-block;';
                                                            $counter++;
                                                        }
                                                    }
                                                }
                                                $itemOpakZbr = $pack['item']->getOpakowaniaZbiorcze(); ?>
                                                <?php if ((int)$itemOpakZbr > 0): ?>
                                                    <span id="opak_zbr_<?= $_item->getSku() . '_' . $pack['id']; ?>"
                                                          class="opak_zbr_<?= $_item->getSku() ?> opakowanie_zbiorcze"
                                                          style="<?= $itemStyle ?>"
                                                          data-opakzbr="<?= (int)$itemOpakZbr ?>">
                                                <span class="opak_icon"><img
                                                            src="/media/wysiwyg/new_ikonka_opakowania_zbiorcze_3.png"
                                                            alt="Opakowanie Zbiorcze"></span>
                                                <span class="opak_tooltip"><?php echo "Opakowanie Zbiorcze: " ?><?= (int)$itemOpakZbr ?></span>
                                            </span>
                                                <?php endif; ?>
                                            <?php endforeach; ?>
                                        <?php else: ?>
                                            <?php if ((int)$opakowanieZbiorcze > 0): ?>
                                                <span class="opakowanie_zbiorcze"
                                                      data-opakzbr="<?= (int)$opakowanieZbiorcze ?>">
                                    <span class="opak_icon"><img
                                                src="/media/wysiwyg/new_ikonka_opakowania_zbiorcze_3.png"
                                                alt="Opakowanie Zbiorcze"></span>
                                    <span class="opak_tooltip"><?php echo "Opakowanie Zbiorcze: " ?><?= (int)$opakowanieZbiorcze ?></span>
                                </span>
                                            <?php else: ?>

                                            <?php endif; ?>
                                        <?php endif; ?>
                                        <?php if (count($_items > 1)): ?>
                                            <?php $counter = 0; ?>
                                            <?php foreach ($_items as $pack): ?>
                                                <?php $paleta = $pack['item']->getPaleta(); ?>
                                                <?php if ($paleta >= 1): ?>
                                                    <?php
                                                    if (in_array($_item->getSku() . "_" . $pack['id'], $disabledsArray) && $selectDisabledFlag !== true) {
                                                        $itemStyle = 'display: none;';
                                                    } else {
                                                        $itemStyle = 'display: none;';
                                                        if ($selectDisabledFlag !== true) {
                                                            if ($selectedItemID === $pack['id']) {
                                                                if ($counter == 0) {
                                                                    $itemStyle = 'display: inline-block;';
                                                                    $counter++;
                                                                    $datastyle = '22';
                                                                }
                                                            }
                                                        } else {
                                                            if ($counter == 0) {
                                                                $itemStyle = 'display: inline-block;';
                                                                $counter++;
                                                            }
                                                        }
                                                    }
                                                    ?>
                                                    <span <?= 'id="jm_paleta_' . $_item->getSku() . '_' . $pack['id'] . '"' ?> class="opakowanie_zbiorcze <?= 'jm_paleta_' . $_item->getSku() ?>"
                                                                                                                               style="<?= $itemStyle ?>">
                                            <span class="opak_icon">
                                                <img src="/media/wysiwyg/ikonografikacech/paleta_new.png" alt="Paleta">
                                            </span>
                                            <span class="opak_tooltip"><?php echo "Paleta: " ?><?= (int)$paleta ?> opakowań</span>
                                        </span>
                                                <?php endif; ?>
                                            <?php endforeach; ?>
                                        <?php else: ?>
                                            <?php $paleta = $_item->getPaleta(); ?>
                                            <?php if ($paleta >= 1): ?>
                                                <span class=" <?= 'jm_paleta_' . $_item->getSku() ?>"
                                                      style="display: block;">
                                        <span class="opak_icon">
                                            <img src="/media/wysiwyg/ikonografikacech/paleta_new.png" alt="Paleta">
                                        </span>
                                        <span class="opak_tooltip"><?php echo "Paleta: " ?><?= (int)$paleta ?></span>
                                    </span>
                                            <?php endif; ?>
                                        <?php endif; ?>
                                    </div>
                                <?php else: ?>
                                    <?php if (empty($_item->getDataDostawy()) == false): ?>
                                        <span class='blister_tooltip tooltip'><img src='/media/pro/data_dostawy.png'
                                                                                   style='height:20px;width:auto'
                                                                                   class='priceTooltip'><span
                                                    class='tooltiptext tooltip-top' style='width:300px;'>Przewidywana data dostawy <?= $_item->getDataDostawy() ?></span></span>
                                    <?php else: ?>
                                        <p class="availability out-of-stock">
                                        <span><?php echo $this->__('Brak') ?></span>

                                    <?php endif; ?>
                                    </p>
                                    <?php if ($zamienniki && $zamienniki !== '' && $isZam): ?>
                                        <a class="link-zamienniki" data-bind="<?= base64_encode($zamienniki); ?>"
                                           data-item="<?= $_item->getId() ?>"><?php echo $this->__('Sprawdź zamiennik!'); ?></a>
                                    <?php endif;
                                    $stockAlert = Mage::getModel('stockalert/stockalert');
                                    $isAwaiting = $stockAlert->checkInList($_item->getSku());
                                    if ($isAwaiting == false): ?>
                                        <span class="stock-alert"
                                              id='<?= $_item->getSku() . "_" . $_item->getId(); ?>'><?php echo $this->__('Powiadom o dostawie'); ?></span>
                                    <?php endif;
                                    if ($isAwaiting == true): ?>
                                        <span class="stock-alert-added"
                                              id='<?= $_item->getSku() ?>'><?php echo $this->__('Oczekujesz <br>na powiadomienie'); ?></span>
                                    <?php endif; ?>
                                <?php endif; ?>
                            <?php else: ?>
                                <input type="text" disabled="disabled" class="input-text qty disabled" value="0"/>
                            <?php endif; ?>
                        </div>
                    </td>
                    <?php
                    if (strlen($opakowanieZbiorczeTooltip) > 0) {
                        $wielkosc_opakowanie = intval($_item->getWielkoscOpakowania()) * intval($_item->getData('orientacyjnie_sztuk_w_opak'));
                    } else {
                        $wielkosc_opakowanie = $_item->getWielkoscOpakowania();
                    }
                    ?>
                    <td class="a-left szt_container quantity_container <?= $productZewClassOpkTd ?>"
                        data-opakowanie_zbiorcze="<?= $opakowanieZbiorcze ?>" <?= $tdSZTQTYstyle ?>
                        data-test_flag="<?= $testFlag ?>">
                        <div class="qty-input_content szt_content">
                            <?php if ($logged): ?>
                            <?php if (($stanMag > 0 && $_item->isSaleable()) || $customsalable > 0) : ?>
                            <?php if ((count($_items) > 1) && $selectDisabledFlag !== true): ?>
                                <input
                                        data-magqty="<?= $selectedMagQty ?>"
                                        data-jm="<?= $jm ?>"
                                        data-szt="<?= $selectedSztOpak ?>"
                                        data-opakowanie="<?= $selectOpakSzt ?>"
                                        id="szt_super_<?= $_item->getCustomSku(); ?>"
                                        type="text"
                                        name="szt_super_group[<?php echo $selectedItemID ?>]"
                                        maxlength="12"
                                        max-qty="<?php echo $customsalable * $_item->getWielkoscOpakowania() ?>"
                                        title="Wpisz ilość sztuk"
                                        class="input-text szt_qty item_szt_qty_<?= $_item->getSku() ?>"
                                        placeholder="Ilość sztuk"/>
                            <?php else: ?>
                                <input
                                        data-magqty="<?= $itemMagQty ?>"
                                        data-jm="<?= $jm ?>"
                                        data-szt="<?= $iloscWOpakowaniu ?>"
                                        data-opakowanie="<?= $wielkosc_opakowanie ?>"
                                        id="szt_super_<?= $_item->getCustomSku(); ?>"
                                        type="text"
                                        name="szt_super_group[<?php echo $_item->getId() ?>]"
                                        maxlength="12"
                                        max-qty="<?php echo $customsalable * $_item->getWielkoscOpakowania() ?>"
                                        title="Wpisz ilość sztuk"
                                        class="input-text szt_qty item_szt_qty_<?= $_item->getSku() ?>"
                                        placeholder="Ilość sztuk"/>
                            <?php endif; ?>
                            <?php if ($productZew): ?>
                                <div class="dostawa-zew-tooltip">
                                    <span class="opak_icon">
                                        <img src="/media/wysiwyg/ikonografikacech/pickup-car.png"
                                             alt="Dostawa Zewnętrzna">
                                    </span>
                                    <span class="opak_tooltip">Dostawa zwykle do 5 dni roboczych od daty złożenia zamówienia.</span>
                                </div>
                            <?php endif; ?>
                        </div>
                        <?php endif; ?>
                        <?php endif; ?>
                    </td>
                <?php else: ?>
                    <!-- notlogged? -->
                    <td colspan="2" class="a-center"><p style="text-align: center;"><a href="/customer/account/login">Zaloguj
                                się, aby poznać cenę.</a></p></td>
                <?php endif; ?>

            </tr>
        <?php endforeach; ?>

    <?php else: ?>
        <tr>
            <!-- <td colspan="<?php #echo $headersCount ?>"><?php #echo $this->__('No options of this product are available.') ?></td> -->
            <td colspan="<?php echo $headersCount ?>">
                <?php require_once 'grouped_no_prods.phtml'; ?>
            </td>
        </tr>
    <?php endif; ?>

    </tbody>
</table>
<div id="sorthFirst" class="hidden"
     onclick="sorttable.innerSortFunction.apply(document.getElementById('sortfirst_rozmiar'), [])"></div>

<script type="text/javascript">decorateTable('super-product-table')</script>


<style>
    .stock-alert {
        cursor: pointer;
        padding-left: 5px;
        display: inline-block;
        width: 100%;
    }

    .stock-alert:hover {
        color: #1d9fc4;
    }

    .stock-alert-added {
        width: 100%;
        color: green;
        padding-left: 5px;
        /*        font-weight: 700;*/
    }

    .link-zamienniki {
        width: 100%;
    }

    .availability.sample-delivery-date {
        margin-top: 2px;
    }
</style>

<script type="text/javascript">
    jQuery('.stock-alert').on('click', function () {
        // console.log('.stock-alert click');
        let newSKU;
        if (this.id.indexOf('+') >= 0) {
            // console.log('contains +');
            newSKU = this.id.replace('+', '{{plus}}'); /* ;) */
        } else {
            newSKU = this.id;
        }
        let thisElement = this;
        var customurl = "/stockalert/index/add?sku=" + newSKU;
        var sku2 = newSKU;
        jQuery.ajax({
            url: customurl,
            type: 'POST',
            dataType: 'json',
            indexValue: {sku: this.id},
            data: {
                sku: this.id,
            },
            success: function (response) {
                console.log('response', response);
                jQuery(thisElement).text("Oczekujesz na powiadomienie");
                jQuery(thisElement).css("color", 'green');
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log('error', jqXHR, textStatus, errorThrown);
            }
        });

    });
</script>


<!-- <script src="/js/jquery.filtertable.js"></script> -->
<script type="text/javascript">

    // jQuery('#super-product-table').ddTableFilter({
    //     emptyText: '<?php echo $this->__('Wybierz') ?>'
    // });


</script>

<script>   
    jQuery('.product-tabs-content .grouped-items-table.sortable select').on('change', function () {
        //alert( this.id );
        jQuery("#" + this.id).attr('data-product', this.value);
        jQuery("#super_" + this.id).attr('name', 'super_group[' + this.value + ']');

        jQuery(".stock_" + this.id).hide();
        jQuery("#stock_" + this.id + "_" + this.value).show();
        var sorttableStock = parseInt(jQuery("#stock_" + this.id + "_" + this.value).text());
        jQuery("#stock_" + this.id + "_" + this.value).parent().attr('sorttable_customkey', sorttableStock);

        jQuery(".price_" + this.id).hide();
        jQuery("#price_" + this.id + "_" + this.value).show();

        jQuery(".jm_price_" + this.id).hide();
        jQuery("#jm_price_" + this.id + "_" + this.value).show();


        jQuery(".jm_opak_" + this.id).hide();
        jQuery("#jm_opak_" + this.id + "_" + this.value).show();      
        jQuery(".jm_paleta_" + this.id).hide();
        jQuery("#jm_paleta_" + this.id + "_" + this.value).show();
        jQuery(".opak_zbr_" + this.id).hide();
        jQuery("#opak_zbr_" + this.id + "_" + this.value).show();
        let selectedIndex = this.selectedIndex;
        let option = this.options[selectedIndex];
        let sztopak = jQuery(option).attr('data-sztopak');
        let opak = jQuery(option).attr('data-opak');
        let magqty = jQuery(option).attr('data-magqty');
        jQuery('#szt_super_' + this.id).attr('data-szt', sztopak);
        jQuery('#szt_super_' + this.id).attr('data-opakowanie', opak);
        jQuery('#szt_super_' + this.id).attr('data-magqty', magqty);
        let ev = document.createEvent('Event');
        ev.initEvent('change', true, false);
        document.getElementById('super_' + this.id).dispatchEvent(ev);
        let visibleTooltipsCount = jQuery("#" + this.id).closest('tr').find('.opakowanie_zbiorcze:visible').length;
        if (visibleTooltipsCount === 0) {
            jQuery("#" + this.id).closest('tr').find('td.opk_container').removeClass('quantity_container');
            jQuery("#" + this.id).closest('tr').find('td.szt_container').removeClass('quantity_container');
        } else {
            if (jQuery("#" + this.id).closest('tr').find('td.opk_container').hasClass('quantity_container') === false) {
                jQuery("#" + this.id).closest('tr').find('td.opk_container').addClass('quantity_container');
                jQuery("#" + this.id).closest('tr').find('td.szt_container').addClass('quantity_container');
            }
        }
        if (jQuery("#opak_zbr_" + this.id + "_" + this.value).is(":visible")) {
            jQuery("#super_" + this.id).attr('data-opakzbr', '1');
            let opakowaniaZbr = jQuery('.opakowanie_zbiorcze');
            jQuery("#super_" + this.id).on('input', function () {
                opakowaniaZbr.each((op_Index, op_Item) => {
                    jQuery(op_Item).removeClass('show_tool');
                });
                let thisInputVal = jQuery("#" + this.id).val();
                let thisOpaks = jQuery("#" + this.id).closest('tr').find('.opakowanie_zbiorcze:visible');
                let testVal = thisInputVal % thisOpaks.attr('data-opakzbr');

                if (isNaN(testVal)) {
                    testVal = 0;
                }
                if (testVal === 0) {
                    //console.log('ukryj dymek', testVal);
                    jQuery("#" + this.id).closest('tr').find('.opakowanie_zbiorcze:visible').removeClass('show_tool');
                } else {
                    //console.log('pokaz dymek', testVal);
                    jQuery("#" + this.id).closest('tr').find('.opakowanie_zbiorcze:visible').addClass('show_tool');
                    setTimeout(() => {
                        jQuery("#" + this.id).closest('tr').find('.opakowanie_zbiorcze:visible').removeClass('show_tool');
                    }, 5000);
                }
                //console.log();
            });
        } else {
            jQuery("#super_" + this.id).attr('data-opakzbr', '0');
            ////console.log('this is not visible!! do nothing');
        }
        //console.log("#stock_"+this.id+"_"+this.value);
    });
    let opakowaniaZbr = jQuery('.opakowanie_zbiorcze');
    jQuery('.product-tabs-content .grouped-items-table.sortable input[data-opakzbr="1"]').on('change input', function () {
        //$('.opakowanie_zbiorcze').removeClass('show_tool');
        opakowaniaZbr.each((op_Index, op_Item) => {
            jQuery(op_Item).removeClass('show_tool');
        });
        let thisInputVal = jQuery(this).val();
        let thisOpaks = jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible');
        let testVal = thisInputVal % thisOpaks.attr('data-opakzbr');
        if (isNaN(testVal)) {
            testVal = 0;
        }
        if (testVal === 0) {
            //console.log('ukryj dymek', testVal, thisOpaks.attr('data-opakzbr'));
            jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible').removeClass('show_tool');
        } else {
            //console.log('pokaz dymek', testVal, thisOpaks.attr('data-opakzbr'));
            jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible').addClass('show_tool');
            setTimeout(() => {
                jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible').removeClass('show_tool');
            }, 5000);
        }
        //console.log();
    });
    jQuery('input.input-text.qty').click(function () {
        if (jQuery(this).val() == '0') {
            jQuery(this).val('');
        }
    });
    jQuery(window).scroll(fixedThead);
    var checkExist = setInterval(function () {
        if (jQuery(".product-tabs-content + .add-to-cart").length) {
            //console.log("Exists!");
            clearInterval(checkExist);
            jQuery(window).scroll(initScrool(false));
        }
    }, 100); // check every 100ms

    var OptionsAll = [];

    jQuery('table.product-tabs-content .grouped-items-table.sortable > thead > tr > th.filterable select').each(function (index) {
        var optionArr = [];
        var thisItem = jQuery(this).attr('data-item');
        var thisValues = [];
        jQuery(this).children('option').each(function (index) {
            thisValues.push(jQuery(this).val());
        });
        optionArr.Item = thisItem;
        optionArr.Values = thisValues;
        OptionsAll.splice(index, 0, optionArr);
    });
    //console.log(OptionsAll);
    var tdCounter = 0;
    jQuery('.product-tabs-content .grouped-items-table.sortable tbody tr td').each(function (index) {
        if (jQuery(this).is(':first-of-type')) {
            tdCounter = 0;
        }
        jQuery(this).attr('data-for-header', 'item-' + tdCounter);
        tdCounter++;
    });
    jQuery('.product-tabs-content .grouped-items-table.sortable').on('change', function () {
        var numOfVisibleRows = jQuery('.product-tabs-content .grouped-items-table.sortable tbody tr:visible').length;

        jQuery('.product-tabs-content .grouped-items-table.sortable thead th select option:not(:first-of-type)').css('display', 'none');
        jQuery('.product-tabs-content .grouped-items-table.sortable tbody tr:visible td').each(function (index) {
            var forSelect = jQuery(this).attr('data-for-header');
            var selectVal = jQuery(this).attr('ddtf-value');

            jQuery('.product-tabs-content .grouped-items-table.sortable thead th.' + forSelect + ' select').find('option[value="' + selectVal + '"]').css('display', 'block');
        });
    });
    jQuery('.product-tabs-content > .content > .top-buttonn').append('<div class="results"><div class="titele" style="display:none;"><b>Filtry: </b><span class="clear-all"></span></div></div>');
    jQuery('.product-tabs-content .grouped-items-table.sortable th select').on('change', function () {
        var value = jQuery(this).val();
        var thisTxt = jQuery(this).siblings('span').text();
        var valsCount = jQuery('.product-tabs-content > .content > .top-buttonn .results .val').length;
        var resultWrap = jQuery('.product-tabs-content > .content > .top-buttonn .results');
        var selectItemNr = jQuery(this).parent('th').attr('data-header');

        if (valsCount > 0) {
            jQuery('.product-tabs-content > .content > .top-button .results .titele').show();
        } else {
            jQuery('.product-tabs-content > .content > .top-buttonn .results .titele').hide();
        }
        if (value == '--all--') {
            if (valsCount == 1) {
                jQuery('.product-tabs-content > .content > .top-buttonn .results .titele').hide();
            }
            resultWrap.find('span[data-attr="' + thisTxt + '"]').remove();
            //console.log(valsCount);
        } else {
            jQuery('.product-tabs-content > .content > .top-buttonn .results .titele').show();
            resultWrap.append('<span id="filter_' + selectItemNr + '" data-attr="' + thisTxt + '" style="display:block;" class="val">' + thisTxt + ': ' + value + '<span class="clear-it" data-to-clear="' + selectItemNr + '"></span></span>');
        }

    });
    jQuery("body").click(function (event) {
        var target = jQuery(event.target);
        if (target.is('.clear-it')) {
            var selectedToClear = target.attr('data-to-clear');
            //console.log('should be cleared'+selectedToClear);

            jQuery('.product-tabs-content .grouped-items-table.sortable thead th.' + selectedToClear + ' select').prop('selectedIndex', 0);
            jQuery('.product-tabs-content .grouped-items-table.sortable thead th.' + selectedToClear + ' select').trigger('change');
            jQuery('#filter_' + selectedToClear).remove();
        }
    });
    jQuery('.product-tabs-content > .content > .top-buttonn .results .val .clear-it').click(function () {

    });
    $(window).scroll(function () {
        var top_of_element = jQuery(".product-tabs-content .grouped-items-table.sortable tbody tr:first-of-type").offset().top;
        var bottom_of_element = jQuery(".product-tabs-content .grouped-items-table.sortable tbody tr:first-of-type").offset().top + jQuery(".product-tabs-content .grouped-items-table.sortable tbody tr:first-of-type").outerHeight();
        var bottom_of_screen = jQuery(window).scrollTop() + jQuery(window).innerHeight();
        var top_of_screen = jQuery(window).scrollTop();
        //console.log('...scrolling');
        if ((bottom_of_screen > top_of_element) && (top_of_screen < bottom_of_element)) {
            // the element is visible, do something
            //console.log('visible');
        } else {
            // the element is not visible, do something else
            //console.log('not visible');
        }
    });

    function initScrool(forceThChange) {
        var element = jQuery(".product-tabs-content .grouped-items-table.sortable thead");
        var tbody = jQuery(".product-tabs-content .grouped-items-table.sortable tbody");
        var bottomButton = jQuery(".product-tabs-content + .add-to-cart");
        let initScrollHelper = {
            thWidthsChanged: false
        }
        var thWidths = [];
        // setTimeout(function(){
        if (forceThChange === true) {
            initScrollHelper.thWidthsChanged = false;
            //console.log("------------------FORCED------------------");
        }
        if (initScrollHelper.thWidthsChanged === false) {
            jQuery(".product-tabs-content .grouped-items-table.sortable thead tr th").each(function (index) {
                jQuery(this).css('width', jQuery(this).width());
                thWidths[index] = jQuery(this).width();
                jQuery('table.product-tabs-content .grouped-items-table.sortable > tbody > tr > td:nth-of-type(' + (index + 1) + ')').css('width', jQuery(this).width() - 20);
            });
            initScrollHelper.thWidthsChanged = true;
        }

        jQuery(".product-tabs-content .grouped-items-table.sortable tbody tr").each(function (indexTr, elementTr) {
            // //console.log(jQuery(this));
            jQuery(this).find("td").each(function (indexTd, elementTd) {
                jQuery(this).css('width', thWidths[indexTd]);
            });
        });
        // }, 500);
        if (jQuery(window).width() > 767) {
            var buttonOffsetTop = bottomButton.offset().top;
            //if ((jQuery(window).scrollTop() > tbody.offset().top) && ( jQuery( "#super-product-table tbody" ).height() >= (jQuery(window).height() / 2) ))  {
            if (jQuery(window).scrollTop() > tbody.offset().top) {

                if (jQuery(window).scrollTop() > buttonOffsetTop) {
                    element.removeClass('fixed');
                    element.removeAttr('style');
                    jQuery(".top-button .button").removeClass('fixed');
                    jQuery('.search_this_table_wrap').css('padding-bottom', '10px');
                } else {
                    jQuery('.search_this_table_wrap').css('padding-bottom', (element.height() + 10) + 'px');
                    element.addClass('fixed');
                    element.css('width', tbody.width());
                    element.css('top', jQuery('.header-fixed').height());
                    jQuery(".top-button .button").addClass('fixed').css('top', jQuery('.header-fixed').height());
                }

            } else {
                jQuery('.search_this_table_wrap').css('padding-bottom', '10px');
                element.removeClass('fixed');
                element.removeAttr('style');
                jQuery(".top-button .button").removeClass('fixed');
            }
        } else {
            jQuery('.search_this_table_wrap').css('padding-bottom', '10px');
            element.removeAttr('style');
            jQuery(".top-button .button").removeClass('fixed');
        }
    }


    function fixedThead() {
        var element = jQuery(".product-tabs-content .grouped-items-table.sortable thead");
        var tbody = jQuery(".product-tabs-content .grouped-items-table.sortable tbody");
        var bottomButton = jQuery(".product-tabs-content + .add-to-cart");
        if (jQuery(window).width() > 767) {
            var buttonOffsetTop = bottomButton.offset().top;
            //if ((jQuery(window).scrollTop() > tbody.offset().top) && ( jQuery( "#super-product-table tbody" ).height() >= (jQuery(window).height() / 2) ))  {
            if (jQuery(window).scrollTop() > tbody.offset().top) {

                if (jQuery(window).scrollTop() > buttonOffsetTop) {
                    //console.log('> buttonOffs');
                    element.removeClass('fixed');
                    element.removeAttr('style');
                    tbody.removeAttr('style');
                    jQuery(".top-button .button").removeClass('fixed');
                    if (jQuery(window).width() < 1441) {
                        jQuery(".top-button .button").removeClass('fixed_bottom');
                        bottomButton.show();
                    }
                    jQuery('.search_this_table_wrap').css('padding-bottom', '10px');

                } else {
                    //console.log('<= buttonOffs');
                    jQuery('.search_this_table_wrap').css('padding-bottom', (element.height() + 10) + 'px');
                    element.addClass('fixed');
                    element.css('width', tbody.width());
                    tbody.css('width', tbody.width());
                    element.css('top', jQuery('.header-fixed').height());
                    jQuery(".top-button .button").addClass('fixed').css('top', jQuery('.header-fixed').height());
                    if (jQuery(window).width() < 1441) {
                        jQuery(".top-button .button").addClass('fixed_bottom');
                        bottomButton.hide();
                    }
                }

            } else {
                //console.log('<= tbody offs');
                element.removeClass('fixed');
                element.removeAttr('style');
                tbody.removeAttr('style');
                jQuery('.search_this_table_wrap').css('padding-bottom', '10px');
                jQuery(".top-button .button").removeClass('fixed');
                if (jQuery(window).width() < 1441) {
                    jQuery(".top-button .button").removeClass('fixed_bottom');
                    bottomButton.show();
                }
            }
        } else {
            //console.log('<= 767');
            element.removeAttr('style');
            tbody.removeAttr('style');
            jQuery('.search_this_table_wrap').css('padding-bottom', '10px');
            jQuery(".top-button .button").removeClass('fixed');
            if (jQuery(window).width() < 1441) {
                jQuery(".top-button .button").removeClass('fixed_bottom');
                bottomButton.show();
            }
        }
    }

    <?php
    if($allowwishlist): #proszę się naumieć pętli w JS
    foreach ($ids as $wishlistItemId){?>
    jQuery('tr.item_' +<?php echo $wishlistItemId?>).addClass('dodane');
    jQuery('tr.item_'+<?php echo $wishlistItemId?>+' a.link-wishlist').attr('href', 'javascript:void(0)').html('<i class="fa fa-check-square-o" aria-hidden="true"></i><span class="hidden-small">W schowku</span>');

    <?php }
    endif;
    ?>


</script>
<script>
    jQuery(document).ready(checkEtykieta);
    var showetykieta = false;

    function checkEtykieta() {
        jQuery("td.etykieta").each(function (index) {
            if (!jQuery(this).is(':empty')) {
                showetykieta = true;
            }

        });
        if (showetykieta) {
            jQuery('td.etykieta,th.etykieta').removeClass('hidden');
        }
    }

</script>

<script type="text/javascript">
    jQuery(document).ready(function ($) {
        $('a.add-to-ofera').on('click', function (event) {
            event.preventDefault();
            const thisEL = $(this);
            const classFlag = thisEL.hasClass('is-in-ofera');
            const parent_id = thisEL.attr('data-parent');
            const product_id = thisEL.attr('data-product');
            const customer = thisEL.attr('data-customer');
            const thisId = thisEL.attr('id');
            const thisImageSrc = "<?= Mage::getBaseUrl() . 'media/olegnax/athlete/default/deal.svg' ?>";
            const thisImageAlt = "Dodaj do Twojej oferty";
            thisEL.find('img').hide();
            // create gears
            if (classFlag === false) {
                thisEL.removeClass('add-to-ofera').addClass('offer-gears');
                removeSpinnerOferta("gear-" + thisId + "-two");
                createSpinnerOferta(thisEL[0], thisId, 'one');
                if (document.getElementById('offertooltip-two') !== null) {
                    document.getElementById('offertooltip-two').remove();
                }
                const baseUrl = "<?= Mage::getBaseUrl() . 'twojaoferta/index/addtooferta' ?>";
                const addAttrs = '?id=' + product_id + '&parent_id=' + parent_id + '&customer_id=' + customer;
                jQuery.ajax({
                    url: baseUrl + addAttrs,
                    success: function (response) {
                        //console.log('success');
                        //console.log(response);
                        const tooltipSpan = '<div id="offertooltip-one">' + response.message + "</div>";
                        thisEL.append(tooltipSpan);
                        setTimeout(function () {
                            thisEL.addClass('offer-tooltip-added');
                            thisEL.removeClass('offer-gears').addClass('is-in-ofera');
                            removeSpinnerOferta("gear-" + thisId + "-one");
                        }, 300);
                        setTimeout(function () {
                            thisEL.removeClass('offer-tooltip-added');
                        }, 4000);
                        setTimeout(function () {
                            if (document.getElementById('offertooltip-one') !== null) {
                                document.getElementById('offertooltip-one').remove();
                            }
                        }, 4400);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        //console.log('An error occurred');
                    }
                });
            } else if (classFlag === true) {
                removeSpinnerOferta("gear-" + thisId + "-one");
                if (document.getElementById('offertooltip-one') !== null) {
                    document.getElementById('offertooltip-one').remove();
                }
                createSpinnerOferta(thisEL[0], thisId, "two");
                thisEL.removeClass('is-in-ofera').addClass('offer-gears');
                const baseUrl = "<?= Mage::getBaseUrl() . 'twojaoferta/index/disablesingleentity' ?>";
                const addAttrs = '?product_id=' + product_id + '&parent_id=' + parent_id;
                jQuery.ajax({
                    url: baseUrl + addAttrs,
                    success: function (response) {
                        //console.log('success');
                        //console.log(response);
                        const tooltipSpan = '<div id="offertooltip-two">' + response.message + "</div>";
                        thisEL.append(tooltipSpan);
                        setTimeout(function () {
                            thisEL.find('img').show();
                            thisEL.addClass('offer-tooltip-added');
                            thisEL.removeClass('offer-gears').addClass('add-to-ofera');
                            removeSpinnerOferta("gear-" + thisId + "-two");
                        }, 300);
                        setTimeout(function () {
                            thisEL.removeClass('offer-tooltip-added');
                        }, 4000);
                        setTimeout(function () {
                            if (document.getElementById('offertooltip-two') !== null) {
                                document.getElementById('offertooltip-two').remove();
                            }
                        }, 4400);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        //console.log('An error occurred');
                    }
                });
            }
        });
        $('a.oferta-action.is-in-ofera').on('click', function (event) {
            event.preventDefault();
            const thisEL = $(this);
            const classFlag = thisEL.hasClass('add-to-ofera');
            const parent_id = thisEL.attr('data-parent');
            const product_id = thisEL.attr('data-product');
            const customer = thisEL.attr('data-customer');
            const thisId = thisEL.attr('id');
            const thisImageSrc = "<?= Mage::getBaseUrl() . 'media/olegnax/athlete/default/deal.svg' ?>";
            const thisImageAlt = "Dodaj do Twojej oferty";
            if (classFlag === false) {
                createSpinnerOferta(thisEL[0], thisId, "two");
                thisEL.removeClass('is-in-ofera').addClass('offer-gears');
                const baseUrl = "<?= Mage::getBaseUrl() . 'twojaoferta/index/disablesingleentity' ?>";
                const addAttrs = '?product_id=' + product_id + '&parent_id=' + parent_id;
                jQuery.ajax({
                    url: baseUrl + addAttrs,
                    success: function (response) {
                        //console.log('success');
                        //console.log(response);
                        const tooltipSpan = '<div id="offertooltip-two">' + response.message + "</div>";
                        thisEL.append(tooltipSpan);
                        setTimeout(function () {
                            const newImage = $("<img class='new-img'>");
                            newImage.attr('src', thisImageSrc);
                            newImage.attr('alt', thisImageAlt);
                            newImage.appendTo(thisEL);

                            thisEL.addClass('offer-tooltip-added');
                            thisEL.removeClass('offer-gears').addClass('add-to-ofera');
                            removeSpinnerOferta("gear-" + thisId + "-two");
                        }, 300);
                        setTimeout(function () {
                            thisEL.removeClass('offer-tooltip-added');
                        }, 4000);
                        setTimeout(function () {
                            document.getElementById('offertooltip-two').remove();
                        }, 4400);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        //console.log('An error occurred');
                    }
                });
            } else if (classFlag === true) {
                thisEL.removeClass('add-to-ofera').addClass('offer-gears');
                removeSpinnerOferta("gear-" + thisId + "-two");
                createSpinnerOferta(thisEL[0], thisId, 'one');
                thisEL.find('img').remove();
                if (document.getElementById('offertooltip-two') !== null) {
                    document.getElementById('offertooltip-two').remove();
                }
                const baseUrl = "<?= Mage::getBaseUrl() . 'twojaoferta/index/addtooferta' ?>";
                const addAttrs = '?id=' + product_id + '&parent_id=' + parent_id + '&customer_id=' + customer;
                jQuery.ajax({
                    url: baseUrl + addAttrs,
                    success: function (response) {
                        //console.log('success');
                        //console.log(response);
                        const tooltipSpan = '<div id="offertooltip-one">' + response.message + "</div>";
                        thisEL.append(tooltipSpan);
                        setTimeout(function () {
                            thisEL.addClass('offer-tooltip-added');
                            thisEL.removeClass('offer-gears').addClass('is-in-ofera');
                            removeSpinnerOferta("gear-" + thisId + "-one");
                        }, 300);
                        setTimeout(function () {
                            thisEL.removeClass('offer-tooltip-added');
                        }, 4000);
                        setTimeout(function () {
                            if (document.getElementById('offertooltip-one') !== null) {
                                document.getElementById('offertooltip-one').remove();
                            }
                        }, 4400);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        //console.log('An error occurred');
                    }
                });
            }
        });
    });

    function createSpinnerOferta(element, targetId, newIndex) {

        var gearId = "gear-" + targetId + "-" + newIndex;
        if (document.getElementById(gearId) !== null) {
            // //console.log("istnieje - do usuniecia");
            // document.getElementById(gearId).remove();
        } else {
            var gearSpinContainer = document.createElement("span");
            gearSpinContainer.setAttribute("id", gearId);
            gearSpinContainer.setAttribute("class", "gears");
            gearSpinContainer.innerHTML = '<i id="gear1" class="fa fa-5x fa-gear spin"></i><i id="gear2" class="fa fa-5x fa-gear spin-back"></i>';
            //console.log(element);
            //console.log(element.firstChild)
            element.insertBefore(gearSpinContainer, element.firstChild);
        }
    }

    function removeSpinnerOferta(gearId) {
        if (document.getElementById(gearId) !== null) {
            document.getElementById(gearId).remove();
        }
    }
</script>

<div id="zamienniki-block">
    <div class="zamienniki-dialog" role="document">
        <div class="zamienniki-content">
            <div class="zamienniki-header">
                <span class="zm_differs"> - warości zamiennika inne niż wartości brakującego produktu</span>
                <h1 id="zamienniki-header-title">Proponowane zamienniki</h1>
                <div id="success-order-box" class="order-alert-box" style="display: none;"><span>Dodano produkt do koszyka</span>
                </div>
                <div id="fail-order-box" class="order-alert-box" style="display: none;"><span>Wymagana ilość nie jest dostępna dla produktu</span>
                </div>
                <div id="unable-order-box" class="order-alert-box" style="display: none;"><span>Ten produkt jest obecnie niedostępny.</span>
                </div>
                <button type="button" class="button close"><span><span></span></span></button>
            </div>
            <div class="zamienniki-body">
                <form></form>
            </div>
            <div class="zamienniki-footer">
                <button type="button" class="button close"><span><span>Zamknij</span></span></button>
            </div>
        </div>
    </div>
</div>

<script>
    jQuery(document).ready(function ($) {
        var zamBlock = $('#zamienniki-block');
        var ordered = false;
        $(document).on('click', ".link-zamienniki", function () {
            var zamienniki = $(this).attr("data-bind");
            let item_data = $(this).attr("data-item");
            var zamBody = $('#zamienniki-block .zamienniki-content .zamienniki-body');
            var fullUrl = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');
            var reloadurl = fullUrl + '/productsubstitutes/index/getsubstitutes';
            let productUrl = window.location.href;
            $.ajax({
                type: 'post',
                data: {zam: zamienniki, prod_url: productUrl, product_data: item_data},
                url: reloadurl,
                success: function (response) {
                    console.log(response);
                    if (response.html) {
                        if (response.differ === true) {
                            zamBlock.addClass('is_different');
                        } else {
                            zamBlock.removeClass('is_different');
                        }
                        zamBlock.css("display", "block");
                        $('.top-button').css("z-index", "0");
                        zamBody.html(response.html);

                    }
                }
            });
            $('html, body').animate({
                scrollTop: $("#search_results_conf_container").offset().top
            }, 500);
        });

        $(document).on('click', "#zamienniki-block .zamienniki-dialog .close", function () {
            if (ordered) {
                location.reload();
                zamBlock.css("display", "none");

                // return false;
            } else {
                zamBlock.css("display", "none");
            }
        });

        $(document).on('change', "#zamienniki-block .zamienniki-body > #zamienniki-table select", function () {
            $("#" + this.id).attr('data-product', this.value);
            $("#super_" + this.id).attr('name', 'super_group[' + this.value + ']');

            $("#zamienniki-table .stock_" + this.id).hide();
            $("#zamienniki-table #stock_" + this.id + "_" + this.value).show();

            $("#zamienniki-table .price_" + this.id).hide();
            $("#zamienniki-table #price_" + this.id + "_" + this.value).show();

            $("#zamienniki-table .order_" + this.id).hide();
            $("#zamienniki-table #order_" + this.id + "_" + this.value).show();

            //console.log("#stock_"+this.id+"_"+this.value);
        });

        $(document).on('click', '#zamienniki-block .zamienniki-body > #zamienniki-table td input.input-text.qty', function () {
            if (jQuery(this).val() == '0') {
                jQuery(this).val('');
            }
        });


        $('#zamienniki-block .zamienniki-body > #zamienniki-table td button.btn-cart-zam').unbind('click');
        $(document).on('click', '#zamienniki-block .zamienniki-body > #zamienniki-table td button.btn-cart-zam', function () {
            var inputQty = $('#zamienniki-block .zamienniki-body > #zamienniki-table td input');
            var clickedOrder = $(this).parent();
            var orderedProductSku = clickedOrder.attr('id').split('_')[1];
            var orderedProductId = clickedOrder.attr('id').split('_')[2];
            var stockQty = $('#zamienniki-block .zamienniki-body > #zamienniki-table td #stock_' + orderedProductSku + '_' + orderedProductId).html();
            var orderSuccess = $('#zamienniki-block .zamienniki-header #success-order-box');
            var orderFail = $('#zamienniki-block .zamienniki-header #fail-order-box');
            var unableOrderFail = $('#zamienniki-block .zamienniki-header #unable-order-box');
            //console.log(stockQty);
            var qty = 1;
            inputQty.each(function () {
                if ($(this).attr('id').split('_')[1] == clickedOrder.attr('id').split('_')[1]) {
                    if ($(this).val() != 0) {
                        qty = $(this).val();
                    }
                }
            })
            if (qty > stockQty) {
                //console.log(qty + ' -- ' + stockQty);
                orderFail.fadeIn().delay(3000).fadeOut();
            } else {
                var url = $(this).attr('data-add-link') + 'qty/' + qty + '/';
                //console.log(url);
                $.ajax({
                    type: 'post',
                    url: url,
                    success: function (response) {
                        if (!ordered) {
                            ordered = true;
                        }
                        orderSuccess.fadeIn().delay(3000).fadeOut();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        unableOrderFail.fadeIn().delay(3000).fadeOut();
                    }
                });
            }

        });
    });
</script>


<style>
tr.im_super_cool {
    box-shadow: inset 0 0 0 3px #009ab1;
}
    .miro-radiobutton .gazetka-switch {
        display: flex;
        position: relative;
        box-sizing: border-box;
        flex-direction: row;
        flex-wrap: nowrap;
        align-content: center;
        justify-content: center;
        align-items: center;
        gap: 0;
        background: #fff;
        border: 2px solid #222;
        border-radius: 5px;
        overflow: hidden;
    }

    .miro-radiobutton .gazetka-switch > span {
        display: inline-block;
        box-sizing: border-box;
        padding: 5px 10px;
        font-weight: 600;
        text-transform: uppercase;
        position: relative;
        width: 50px;
        z-index: 1;
        color: #000;
    }

    .miro-radiobutton .gazetka-switch > span:first-child:after {
        position: absolute;
        top: 0;
        height: 100%;
        width: 1px;
        left: 100%;
        content: '';
    }

    .miro-radiobutton .gazetka-switch > span:last-child:after {
        position: absolute;
        top: 0;
        height: 100%;
        width: 1px;
        left: 0;
        content: '';
    }

    .miro-radiobutton .gazetka-switch:after {
        position: absolute;
        right: 0;
        width: 50px;
        height: 100%;
        background: #003543;
        opacity: 1;
        content: '';
        transition: all .3s ease-in-out;
    }

    .miro-radiobutton:not(.is_active) .gazetka-switch > span:last-child,
    .miro-radiobutton.is_active .gazetka-switch > span:first-child {
        color: #fff;
    }

    div#icons_gazetka label {
        box-shadow: none !important;
        transform: translate(0) !important;
    }

    .miro-radiobutton.is_active .gazetka-switch:after {
        right: calc(100% - 50px);
    }

    label:not(.is_active) .gazetka-switch > span:hover:first-child,
    label.is_active .gazetka-switch > span:hover:last-child {
        background: #009ab1;
        box-shadow: inset 0 0 10px 10px rgb(0 52 66 / 49%);
        color: #fff;
    }

    b.is_inox {
        background: #003543;
        color: #fff;
        display: inline-block;
        padding: 1px 5px 0;
        border-radius: 5px;
    }

    span.etykieta.promocja-gazetkowa {
        background-image: url(https://www.marcopol24.pl/skin/frontend/athlete/dark_us/images/PROMOCJA_GAZETKOWA.png);
        height: 24px;
        background-position: center;
        background-repeat: no-repeat;
        background-size: contain;
        width: 60px;
        position: relative;
        top: -5px;
    }

    a.oferta-action {
        display: block;
        width: 25px;
        height: 25px;
        margin: 0px auto;
        padding: 0px;
        background: transparent;
        cursor: pointer;
        position: relative;
    }

    a.oferta-action > img {
        display: block;
        max-width: 100%;
        width: 100%;
        height: auto;
    }

    /*    a.add-to-ofera:before {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 70%;
        height: 2px;
        content: '';
        background: #222;
        transform: translate(-50%,-50%);
    }*/
    a.oferta-action.is-in-ofera:before {
        position: absolute;
        width: 5px;
        height: 13px;
        border: 2px solid #0c813f;
        content: '';
        transform: translate(-50%, -50%) rotate(45deg);
        left: 50%;
        top: 50%;
        border-left-color: transparent;
        border-top-color: transparent;
    }

    /*    a.add-to-ofera:after {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 2px;
        height: 70%;
        content: '';
        background: #222;
        transform: translate(-50%,-50%);
    }*/
    a.remove-from-ofera:before {
        position: absolute;
        top: 50%;
        left: 50%;
        content: '';
        width: 70%;
        height: 2px;
        background: #222;
        transform: translate(-50%, -50%);
    }

    .twoja-cena-jm {
        font-size: 14px;
        color: #000;
    }

    .hiddenprice.a-center.jm-cena {
        /*width: 230px;*/
    }

    .product-tabs-content > .content > .top-buttonn .results {
        max-width: 320px;
        position: relative;
    }

    .product-tabs-content > .content > .top-buttonn .results span.val {
        padding: 2px 0;
        margin: 3px 0;
        position: relative;
    }

    .product-tabs-content > .content > .top-buttonn .results span.val:last-of-type {
        margin-bottom: 20px;
    }

    .product-tabs-content > .content > .top-buttonn .results span.val .clear-it {
        position: relative;
        width: 15px;
        height: 15px;
        display: inline-block;
        margin-left: 10px;
        vertical-align: top;
        cursor: pointer;
    }

    .product-tabs-content > .content > .top-buttonn .results span.val .clear-it:before, .product-tabs-content > .content > .top-buttonn .results span.val .clear-it:after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 70%;
        height: 1px;
        background: #000;
        transform: translate(-50%, -50%) rotate(45deg);
    }

    .product-tabs-content > .content > .top-buttonn .results span.val .clear-it:after {
        transform: translate(-50%, -50%) rotate(-45deg);
    }

    #product_tabs_groupedtable_tabbed_contents select {
        width: 75px;
    }

    .hidden-small {
        display: none;
    }

    a.link-zamienniki {
        color: green;
        font-weight: 600;
    }

    @media (max-width: 767px) {
        .product-view table.grouped-items-table tr, #zamienniki-table tbody tr {
            width: 50%;
        }

        .product-view table.grouped-items-table tr:nth-child(4n-2),
        .product-view table.grouped-items-table tr:nth-child(4n-1) {
            background-color: #f5f5f5;
        }
    }

    @media (max-width: 999px) {
        .product-view table.grouped-items-table th, .product-view table.grouped-items-table td.etykieta /*, #zamienniki-table thead th*/
        {
            display: none;
        }

        .product-view table.grouped-items-table td /*, #zamienniki-table tbody td*/
        {
            display: block;
        }

        .hidden-small {
            display: inline-block;
        }

        .product-view table.grouped-items-table tr /*, #zamienniki-table tbody tr*/
        {
            display: block;
            float: left;
        }
    }

    @media (min-width: 768px) and (max-width: 999px) {
        .product-view table.grouped-items-table tr /*, #zamienniki-table tbody tr*/
        {
            width: 33%;
        }

        .product-view table.grouped-items-table tr:nth-child(2n+1) /*, #zamienniki-table tbody tr:nth-child(2n+1)*/
        {
            background-color: #f5f5f5;
        }

        .product-view table.grouped-items-table tr:nth-child(3n+1) /*, #zamienniki-table tbody tr:nth-child(3n+1)*/
        {
            clear: both;
        }
    }

    .hidden-small {
        display: none;
    }


    @media (max-width: 500px) {
        .hidden-small {
            display: inline-block !important;
        }

        .hiddenprice.a-center.jm-cena {
            width: 76px;

        }

    }

    table.grouped-items-table.fidexheadertable:not(.fixed) {
        display: none;
    }

    .product-view table.grouped-items-table.fidexheadertable th {
        font-size: 12px;
        background: #eaeaea;
    }

    table.grouped-items-table.fidexheadertable.fixed {
        position: fixed;
        top: 0;
        z-index: 2;
    }

    .wishlist-add-btn {
        border: 1px solid;
        padding: 5px;
        cursor: pointer;
    }

    .product-view table.grouped-items-table tr.dodane {
        background: #ddf9de;
    }

    .tablefilters .hidden2 {
        display: none;
    }

    button.button.btn-cart.icon-black-white.fixed {
        position: fixed;
    }

    button.button.btn-cart.icon-black-white.fixed span {
        width: 16px;
    }

    table#super-product-table > thead > tr > th {
        padding: 7px;
        font-size: 12px;
        text-align: center;
        background: #fff;
        color: #000;
        vertical-align: middle;
    }

    #super-product-table thead.fixed tr {
        width: 100%;
        display: -webkit-box;
        display: -moz-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        flex-wrap: nowrap;
        flex-direction: row;
        align-items: center;
        box-shadow: 0px 0px 10px rgb(0 0 0 / 30%);
        background: #f8f8f8;
        justify-content: space-evenly;
    }

    #super-product-table thead.fixed tr th {
        background: #f8f8f8;
        display: block;
    }

    @media all and (max-width: 999px) {
        .product-view table.grouped-items-table td /*,
        #zamienniki-table tbody td*/
        {
            display: block;
            width: calc(100% - 30px) !important;
            margin: 0 auto;
        }
    }

    .opakowanie_zbiorcze .opak_icon + .opak_tooltip {
        position: absolute;
        width: 200px;
        height: 30px;
        display: block;
        bottom: -29px;
        left: -110px;
        text-align: center;
        vertical-align: middle;
        background: green;
        color: #fff;
        line-height: 30px;
        border-radius: 50px;
        z-index: -1;
        opacity: 0;
        font-weight: 600;
    }

    .opakowanie_zbiorcze .opak_icon > img {
        max-width: 30px;
        width: 100%;
        height: auto;
    }

    .opakowanie_zbiorcze:hover .opak_tooltip,
    .opakowanie_zbiorcze.show_tool .opak_tooltip {
        z-index: 1;
        opacity: 1;
        transition: opacity 0.5s ease;
    }

    span.opakowanie_zbiorcze {
        max-width: 25px;
        width: 100%;
        height: auto;
        display: inline-block;
        position: relative;
        vertical-align: middle;
    }

    a.link-zamienniki:hover {
        cursor: pointer;
        color: #00a9bb;
    }

    #super-product-table > tbody > tr:nth-child(2n) {
        background-color: #dfdfdf;
    }

    @media (max-width: 1126px) {
        #zamienniki-table thead th {
            display: none;
        }

        #zamienniki-table tbody td {
            display: block;
        }

        #zamienniki-table tbody tr {
            display: block;
            float: left;
        }
    }

    @media (min-width: 768px) and (max-width: 1126px) {
        #zamienniki-table tbody tr {
            width: 33%;
        }

        #zamienniki-table tbody tr:nth-child(2n+1) {
            background-color: #f5f5f5;
        }

        #zamienniki-table tbody tr:nth-child(3n+1) {
            clear: both;
        }
    }

    @media all and (max-width: 1126px) {
        #super-product-table > tbody > tr:nth-child(2n) > td,
        #zamienniki-table > tbody > tr:nth-child(2n) > td {
            border-color: #999;
        }

        #super-product-table > tbody > tr > td:last-child,
        #zamienniki-table > tbody > tr > td:last-child {
            border-color: #666;
        }

        /*#super-product-table > tbody > tr:nth-child(2n) > td:last-child,
    #zamienniki-table > tbody > tr:nth-child(2n) > td:last-child {
        border-color: #ddd;
    }*/
    }


    #zamienniki-block {
        display: block;
        padding-right: 17px;
        overflow-x: hidden;
        overflow-y: auto;
        z-index: 1072;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1050;
        display: none;
        overflow: hidden;
        outline: 0;
        background-color: rgba(0, 0, 0, 0.4);
    }

    #zamienniki-block .zamienniki-dialog {
        transform: translate(0, 0);
        transition: -webkit-transform .3s ease-out;
        transition: transform .3s ease-out;
        transition: transform .3s ease-out, -webkit-transform .3s ease-out;
        -webkit-transform: translate(0, -25%);
        transform: translate(0, -25%);
        width: 90%;
        /*margin: 10.75rem auto;*/
        position: relative;
        pointer-events: none;
        margin: 0 auto;
        margin-top: 290px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content {
        position: relative;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        width: 100%;
        pointer-events: auto;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid rgba(0, 0, 0, .2);
        border-radius: .3rem;
        outline: 0;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: start;
        -ms-flex-align: start;
        align-items: flex-start;
        -webkit-box-pack: justify;
        -ms-flex-pack: justify;
        padding: 1rem;
        border-bottom: 1px solid #e9ecef;
        border-top-left-radius: .3rem;
        border-top-right-radius: .3rem;
        flex-flow: column;
        align-items: center;
        position: relative;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header > h1 {
        border-bottom: 4px solid #00a9bb;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header #success-order-box {
        background-color: #0C8140;
        color: #ffffff;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header #fail-order-box,
    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header #unable-order-box {
        background-color: #d83820;
        color: #ffffff;
    }

    /*#zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header #unable-order-box {
    background-color: #dfdfdf;
    color: #ffffff;
}*/

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header .order-alert-box {
        width: 50%;
        text-align: center;
        padding: 20px 0;
        margin-top: 15px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header .order-alert-box > span {
        font-size: 18px;
        letter-spacing: 1px;
        text-transform: none;
        font-style: normal;
        font-weight: 700;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header #zamienniki-header-title {
        font-size: 22px;
        letter-spacing: 1px;
        text-transform: none;
        font-style: normal;
        font-weight: 700;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header .button.close {
        position: absolute;
        top: 15px;
        right: 45px;
    }

    @media (max-width: 767px) {
        #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header .button.close {
            right: 15px;
        }
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header .button.close span span {
        padding: 0 7px;
        background: url('/skin/frontend/athlete/dark_us/images/athlete/btn_remove_sprite.png') -3px 5px no-repeat;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-header .button.close:hover span span {
        background-position-y: 5px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body {
        position: relative;
        -webkit-box-flex: 1;
        -ms-flex: 1 1 auto;
        flex: 1 1 auto;
        padding: 1rem;
        max-height: 560px;
        overflow-y: auto;
        min-height: 130px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table th {
        font-weight: 700;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table th,
    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table td {
        text-align: center;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr {
        background-color: #ffffff;
    }

    /*#zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr td:first-child {
    max-width: 180px;
    word-break: break-word;
}*/

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr:nth-child(2n+2) {
        background-color: #dfdfdf;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-footer {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        -webkit-box-pack: end;
        -ms-flex-pack: end;
        justify-content: center;
        padding: 1rem;
        border-top: 1px solid #e9ecef;
    }


    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td button.button.btn-product a {
        height: 35px;
        line-height: 35px;
        background-color: #00a9bb;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td button.button.btn-product a:hover {
        background-color: #000000;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td button.button.btn-product a span {
        padding: 0 20px 0 0;
        background: url('/skin/frontend/athlete/dark_us/images/athlete/slideshow_link_arrow.png') 60px -2px no-repeat;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td button.button.btn-product a:hover span {
        background-position-y: -37px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td .btn-order-container button.btn-cart span {
        height: 35px;
        line-height: 35px;
        background-position-y: 2px;
        background-position-x: 5px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td .btn-order-container button.btn-cart > span {
        padding: 0;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td .btn-order-container button.btn-cart span:hover {
        background-position-y: 2px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.expandable.more-info span.pointer-expand {
        display: block;
        width: 45px;
        height: 25px;
        background: url('/skin/frontend/athlete/dark_us/images/athlete/slideshow_arrows.png') -60px -65px no-repeat;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.expandable.more-info span.pointer-expand.expand {
        background-position-x: 0;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.expandable.more-info span.pointer-expand:hover {
        cursor: pointer;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.expandable.more-info span.pointer-expand:hover {
        cursor: pointer;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table th, #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table td {
        vertical-align: middle;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table th p, #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table td p {
        margin: 0;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table td.item_differ {
        box-shadow: inset 0 0 10px 0 #00a9bb;
    }

    div#zamienniki-block span.zm_differs {
        max-width: 300px;
        position: absolute;
        left: 20px;
        top: 20px;
    }

    div#zamienniki-block span.zm_differs:before {
        display: inline-block;
        width: 25px;
        height: 15px;
        box-shadow: inset 0 0 6px 0 #00a9bb;
        content: '';
        position: relative;
        top: 3px;
    }

    div#zamienniki-block:not(.is_different) span.zm_differs {
        display: none !important;
    }

    /*@media (max-width: 570px) {
    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra {
        width: 50%;
        display: block !important;
    }
}

@media (max-width: 999px) {
    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tbody {
        display: flex;
        flex-wrap: wrap;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr {
        width: 55%;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra {
        width: 40%;
        display: block !important;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.expandable.more-info {
        display: none;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra td {
        display: inline-table;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra td > p {
        padding: 0 !important;
        text-align: left;
    }
}*/

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra {

    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra td {
        background-color: #f4f4f4;
        max-width: none;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra td > p {
        padding-left: 20px;
        float: left;
        clear: left;
        margin: 0;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra td > p > span:first-child {
        background-color: #d4d4d4;
        display: inline-block;
        width: 240px;
        text-align: left;
        font-weight: 700;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body #zamienniki-table tr.expand_extra td > p > span:last-child {
        display: inline-block;
        margin-left: 10px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body {
        /*font-size: 14px !important*/
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.hover_img {
        position: relative;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.hover_img a span {
        position: fixed;
        display: none;
        z-index: 99;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -25%);
        overflow: visible;
        max-width: 300px;
    }

    #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.hover_img a:hover span {
        display: block;
    }

    @media (max-width: 991px) {
        #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.hover_img a {
            color: inherit;
            cursor: default;
        }

        #zamienniki-block .zamienniki-dialog .zamienniki-content .zamienniki-body td.hover_img a span {
            display: none !important;
        }
    }

</style>

<script type="text/javascript">
    jQuery(document).ready(function () {
        jQuery('.input-text.qty').on('keyup', function (e) {
            jQuery(this).parent().css('position', 'relative');
            //console.log(jQuery(this).attr('id'));
            var id = jQuery(this).attr('id');
            var char = jQuery(this).val();
            var qty = parseInt(jQuery(this).val());
            var max = parseInt(jQuery(this).attr('max-qty'));
            jQuery('#qty-msg' + id).remove();
            if (qty > max) {
                jQuery('#qty-msg' + id).remove();
                let errStyle = 'position: absolute;top: 5px;width: 165px;color: #fff;background: #000;left: -185px;padding: 4px;border-radius: 3px;';
                jQuery(this).after('<span style="' + errStyle + '" id="qty-msg' + id + '" class="err_tooltip">Maksymalna dostępna ilość to ' + max + '</span>');
            }
            if (e.keyCode === 13) {
                //console.log('dodaj do koszyka');
                let btn = document.querySelector('.top-button .add-to-cart button.button');
                let url = document.getElementById('product_addtocart_form').getAttribute('action');
                // //console.log(btn, url);
                setTimeout(function () {
                    productAddToCartForm.submit(btn, url);
                }, 250);
            }
        });
    });
</script>
<style type="text/css">
    .input-text.qty + .err_tooltip:before {
        position: absolute;
        top: 50%;
        right: -10px;
        border: 5px solid #000;
        content: '';
        transform: translateY(-50%);
        border-right-color: transparent;
        border-top-color: transparent;
        border-bottom-color: transparent;
    }
</style>
<!-- offer actions style -->
<style>
    a.oferta-action > img {
        display: block;
        max-width: 100%;
        width: 100%;
        height: auto;
        opacity: 0.9;
    }

    a.oferta-action:hover > img {
        opacity: 1;
    }

    div#offertooltip-one,
    div#offertooltip-two {
        position: absolute;
        width: 150px;
        box-sizing: border-box;
        padding: 5px;
        background: #222;
        border-radius: 3px;
        color: #fff;
        top: 50%;
        right: -160px;
        transform: translateY(-15px);
        transition: all 250ms ease;
        z-index: 99999;
    }

    div#offertooltip-two {
        width: 175px;
        right: -185px;
    }

    div#offertooltip-one:after,
    div#offertooltip-two:after {
        content: '';
        border: 5px solid transparent;
        border-right-color: #222;
        display: block;
        position: absolute;
        top: 50%;
        left: -10px;
        transform: translateY(-50%);
    }

    a.oferta-action.offer-tooltip-added > div#offertooltip-one,
    a.oferta-action.offer-tooltip-added > div#offertooltip-two {
        opacity: 1;
        visibility: visible;
    }

    a.oferta-action:not(.offer-tooltip-added) > div#offertooltip-one,
    a.oferta-action:not(.offer-tooltip-added) > div#offertooltip-two {
        opacity: 0;
        visibility: hidden;
    }

    #gear1, #gear2, #gear3 {
        color: #888;
        display: block;
        float: left;
        position: absolute;
        width: 50%;
        font-size: 15px;
    }

    #gear1 {
        top: 8px;
    }

    #gear2 {
        left: 10px;
    }

    .gears {
        display: block;
        position: relative;
        max-width: 25px;
        left: 0px;
    }

    .spin {
        -webkit-animation: spin 4s linear infinite;
        -moz-animation: spin 4s linear infinite;
        animation: spin 4s linear infinite;
    }

    .spin-back {
        -webkit-animation: spin-back 4s linear infinite;
        -moz-animation: spin-back 4s linear infinite;
        animation: spin-back 4s linear infinite;
    }

    @-moz-keyframes spin {
        100% {
            -moz-transform: rotate(360deg);
        }
    }

    @-webkit-keyframes spin {
        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        100% {
            -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
        }
    }

    @-moz-keyframes spin-back {
        100% {
            -moz-transform: rotate(-360deg);
        }
    }

    @-webkit-keyframes spin-back {
        100% {
            -webkit-transform: rotate(-360deg);
        }
    }

    @keyframes spin-back {
        100% {
            -webkit-transform: rotate(-360deg);
            transform: rotate(-360deg);
        }
    }

    a.oferta-action.is-in-ofera:hover:before {
        border: 0px solid #810c0c;
        width: 2px;
        background: #810c0c;
        top: 60%;
    }

    a.oferta-action.is-in-ofera:hover:after {
        position: absolute;
        width: 13px;
        height: 2px;
        content: '';
        transform: translate(-50%, -50%) rotate(45deg);
        background: #810c0c;
        left: 50%;
        top: 60%;
    }

    .product-tabs-content .grouped-items-table.sortable thead.fixed {
        position: fixed;
        z-index: 999;
    }

    .product-tabs-content .grouped-items-table.sortable thead.fixed th {
        height: 42px;
        vertical-align: bottom;
    }

    /*show only availables checkbox start*/
    span.show_availables,
    span.show_availables_2 {
        display: block;
        margin-top: 5px;
        color: #000;
        cursor: help;
        position: relative;
    }

    span.show_availables label,
    span.show_availables_2 label {
        cursor: help;
        margin-left: 3px;
    }

    span#show_availables_tooltip,
    span#show_availables_2_tooltip {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        color: #fff;
        background-color: #000;
        padding: 5px;
        box-sizing: border-box;
        display: block;
        bottom: 16px;
        opacity: 0;
        visibility: hidden;
        width: 160px;
    }

    span.show_availables:hover #show_availables_tooltip,
    span.show_availables_2:hover #show_availables_2_tooltip {
        opacity: 1;
        visibility: visible;
    }

    span#show_availables_tooltip:after,
    span#show_availables_2_tooltip:after {
        position: absolute;
        content: '';
        bottom: -9px;
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #000;
    }

    /*end*/
    body.loaderActive #overlay {
        position: fixed;
        width: 100vw;
        height: 100vh;
        z-index: 9999;
        box-shadow: 0px 0px 3px rgb(0 0 0 / 40%);
        top: 50%;
        left: 50%;
        background: rgb(228 228 228 / 59%);
        transform: translate(-50%, -50%);
        max-width: 100%;
        max-height: 100%;
    }

    body.loaderActive #overlay .overlaycontent {
        position: fixed;
        width: 500px;
        height: 200px;
        z-index: 9999;
        box-shadow: 2px 2px 20px 0px rgb(0 0 0 / 61%);
        top: 50%;
        left: 50%;
        background: #ffffff;
        transform: translate(-50%, -50%);
        max-width: 100%;
        max-height: 100%;
    }

    body.loaderActive #overlay #overlayContent {
        font-size: 20px;
        padding-top: 20px;
        font-weight: 600;
    }

    body.loaderActive #overlay .gear_container {
        display: block;
        width: 100%;
        text-align: center;
        margin-top: 20px;
    }

    body.loaderActive #overlay .gear_container .gears {
        left: 50%;
        transform: translateX(-50%);
        max-width: 35px;
    }

    body.loaderActive #overlay .gear_container .gears #gear1,
    body.loaderActive #overlay .gear_container .gears #gear2 {
        color: #003543;
        font-size: 70px;
        width: 70px;
    }

    body.loaderActive #overlay .gear_container .gears #gear1 {
        top: 35px;
        left: -40px;
    }

    select option[disabled] {
        color: #999999;
    }

    .filterSelect option {
        display: block !important;
    }

    .catalog-product-view #fancybox-content {
        /*max-width: 520px;*/
    }

    button.button.btn-cart.icon-white-white.fixed {
        position: fixed;
        max-width: 54px;
        overflow: hidden;
        font-size: 0 !important;
    }

    button.button.btn-cart.icon-white-white.fixed_bottom {
        max-width: unset !important;
        top: unset !important;
        bottom: 45px;
        right: 90px;
        width: auto;
    }

    button.button.btn-cart.icon-white-white.fixed_bottom span {

        font-size: initial !important;
    }

    button.button.btn-cart.icon-white-white.fixed span {
        font-size: 0;
    }

    /*span.opak_icon > img {
    display: none;
}

span.opak_icon:before {
    position: relative;
    content: '';
    background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PiA8IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDIwMDEwOTA0Ly9FTiIgICJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy1TVkctMjAwMTA5MDQvRFREL3N2ZzEwLmR0ZCI+PHN2ZyB2ZXJzaW9uPSIxLjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjUxMi4wMDAwMDBwdCIgaGVpZ2h0PSI1MTIuMDAwMDAwcHQiIHZpZXdCb3g9IjAgMCA1MTIuMDAwMDAwIDUxMi4wMDAwMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIG1lZXQiPiAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsNTEyLjAwMDAwMCkgc2NhbGUoMC4xMDAwMDAsLTAuMTAwMDAwKSIgZmlsbD0iIzAwMDAwMCIgc3Ryb2tlPSJub25lIj48cGF0aCBkPSJNMjQ1MCA1MTE0IGMtMTQgLTMgLTQwIC0xMCAtNTggLTE2IC0xOSAtNSAtNTI5IC0yNzMgLTExMzUgLTU5NSAtMTE5NiAtNjM0IC0xMTY4IC02MTcgLTEyMjUgLTczMyBsLTI3IC01NSAwIC0xMTU1IDAgLTExNTUgMjcgLTU1IGM1NyAtMTE2IDI5IC05OSAxMjI3IC03MzQgNjA3IC0zMjIgMTEyNiAtNTkzIDExNTQgLTYwMSA2NCAtMTkgMTA4IC0xOSAxODAgMCA4OSAyMyAyMzUwIDExNzIgMjQwOSAxMjI0IDMwIDI2IDU5IDY3IDgwIDEwOSBsMzMgNjcgMCAxMTQ1IDAgMTE0NSAtMzMgNjcgYy0yMSA0MiAtNTAgODMgLTgwIDEwOSAtMzQgMzAgLTMyNyAxODMgLTExMDIgNTc2IC0xMzc0IDY5NyAtMTI4MSA2NTIgLTEzNjAgNjU3IC0zNiAyIC03NiAyIC05MCAweiBtNDYwIC00OTIgbDM4OSAtMTk4IC0zODUgLTE5OCBjLTIxMSAtMTA4IC0zOTIgLTE5NiAtNDAyIC0xOTQgLTMzIDYgLTc1MiAzOTIgLTc0NSAzOTkgNSA0IDE0MyA3OSAzMDggMTY3IDQxNiAyMjEgNDE4IDIyMiA0MzMgMjIyIDcgMCAxODggLTg5IDQwMiAtMTk4eiBtLTEwNzcgLTU3NyBsMzU4IC0xODggLTEzMCAtNjggYy0zNjMgLTE4OSAtODQwIC00MjkgLTg1MSAtNDI5IC0xMyAwIC02OTQgMzUxIC03MjUgMzc0IC0xNCAxMCA2MSA1MyA0NjcgMjY4IDQzMCAyMjggNDg1IDI1NSA1MDMgMjQ0IDExIC03IDE4MSAtOTcgMzc4IC0yMDF6IG0yMTA1IDU2IGMxNjMgLTgyIDM4OSAtMTk3IDUwMSAtMjU0IGwyMDUgLTEwNSAtNDEwIC0yMDUgLTQxMCAtMjA1IC00ODcgMjU2IGMtMjY4IDE0MiAtNDg3IDI2MCAtNDg3IDI2MyAwIDcgNzYyIDM5OCA3NzggMzk5IDYgMCAxNDYgLTY3IDMxMCAtMTQ5eiBtLTkzOSAtNjcyIGMyNjIgLTEzOCA0NzkgLTI1NCA0ODMgLTI1OCAzIC0zIC0yMTUgLTExNiAtNDg2IC0yNDkgbC00OTMgLTI0NCAtNDc0IDI0NyBjLTI2MSAxMzYgLTQ3NyAyNTAgLTQ4MSAyNTQgLTcgNiA5NDcgNTAxIDk2NiA1MDEgNSAwIDIyNCAtMTEzIDQ4NSAtMjUxeiBtLTIxOTQgLTIwNCBjMTY1IC04NiAzMDMgLTE1OSAzMDcgLTE2MyA3IC04IC0xNyAtMjAwMSAtMjUgLTIwMDggLTcgLTggLTc2MCAzOTQgLTc3NSA0MTMgLTkgMTMgLTEyIDIzMyAtMTIgMTAyMCBsMCAxMDAzIDEwMyAtNTQgYzU2IC0zMCAyMzcgLTEyNSA0MDIgLTIxMXogbTQwMTUgLTczOCBjMCAtNzg4IC0zIC0xMDA3IC0xMiAtMTAxOSAtNyAtOCAtMjA1IC0xMTMgLTQ0MCAtMjMyIGwtNDI4IC0yMTcgMCAxMDE4IDAgMTAxOCA0MzMgMjE3IGMyMzcgMTE5IDQzNSAyMTcgNDQwIDIxNyA0IDEgNyAtNDUwIDcgLTEwMDJ6IG0tMjkzMCAxNzQgbDQ1NSAtMjM5IDMgLTEwMjIgYzEgLTU5MSAtMiAtMTAyMCAtNyAtMTAxOCAtNSAxIC0yMjEgMTE2IC00ODEgMjUzIGwtNDcyIDI1MCA2IDMwMCBjMyAxNjUgOCA1NjggMTEgODk1IDYgNjAzIDEyIDgyMCAyMyA4MjAgNCAtMSAyMTIgLTEwOCA0NjIgLTIzOXogbTE3NDggLTc3OCBsLTMgLTEwMTggLTQ4MCAtMjQzIGMtMjY0IC0xMzQgLTQ4NiAtMjQ2IC00OTMgLTI0OSAtMTAgLTQgLTEyIDIwMSAtMTAgMTAxOCBsMyAxMDI0IDQ4NSAyNDIgYzI2NyAxMzMgNDg4IDI0MiA0OTMgMjQyIDQgMSA2IC00NTcgNSAtMTAxNnoiPjwvcGF0aD4gPC9nPiA8L3N2Zz4=);
    width: 25px;
    height: 25px;
    display: block;
    background-size: 25px;
}*/
    table#super-product-table > thead > tr > th.product_name_td, table#super-product-table > tbody > tr > td.product_name_td {
        text-align: left;
        min-width: 140px;
    }

    table#super-product-table > thead > tr > th.product_name_td span {
        width: 100%;
    }

    .attrhidden_content {
        position: absolute;
        top: 50%;
        left: 25px;
        background: #eee;
        box-sizing: border-box;
        padding: 8px;
        box-shadow: 0px 0px 3px rgb(0 0 0 / 20%);
        opacity: 0;
        visibility: hidden;
        width: max-content;
        max-width: 320px;
        border: 2px solid #000;
        transform: translateY(-50%);
        text-align: left;
        font-weight: 600;
    }

    .attrhidden_content b,
    .attrhidden_content strong {
        font-weight: 400;
    }

    .attributes_hidden {
        position: relative;
    }

    span.attrhidden_tool {
        display: inline-block;
        box-sizing: border-box;
        line-height: 18px;
        width: 20px;
        height: 20px;
        border-radius: 100%;
        color: #fff;
        background: #000;
        text-align: center;
        cursor: pointer;
        font-family: 'FontAwesome';
        font-style: italic;
        font-size: 18px;
    }


    .attributes_hidden:hover .attrhidden_content {
        opacity: 1;
        visibility: visible;
        z-index: 1;
    }

    .item_firstattributes {
        display: grid;
        grid-auto-rows: 1fr;
        grid-template-columns: repeat(2, 25px);
        gap: 0 5px;
        justify-content: center;
        align-content: center;
        justify-items: center;
        align-items: center;
        width: 100%;
        height: 100%;
        max-width: 320px;
    }

    .item_firstattributes .attributes_nothidden {
        order: 1;
    }

    .item_firstattributes .attributes_hidden {
        order: 0;
        margin-right: 0px;
    }

    .przewidywana_data {
        color: #0fa2d5;
    }

    .attrhidden_content:before {
        position: absolute;
        top: 50%;
        left: -15px;
        border: 7px solid transparent;
        border-right-color: black;
        content: '';
        transform: translateY(-50%);
    }

    div#product_filter_icons > .icons_item .icons_opts > label.is_disabled {
        filter: contrast(0.7) grayscale(1) invert(0);
        box-shadow: none;
        transform: translateY(0.125rem) !important;
        order: 1;
    }

    div#product_filter_icons span.item_no_img {
        min-width: 40px;
        height: 40px;
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        align-content: center;
        justify-content: center;
        align-items: center;
        background: #fff;
        color: #000;
        font-weight: 600;
        border: 2px solid #444;
        border-radius: 5px;
        font-size: 15px;
        box-sizing: border-box;
        padding: 0 5px;
    }

    div#product_filter_icons .is_active .item_no_img {
        filter: opacity(0.5) invert(0.85);
        transition: all .25s ease;
    }

    .unavailable_item {
        /*     border: 1px solid red; */
        /*pointer-events:none !important;*/
        cursor: not-allowed;

    }

    .unavailable_item input {
        pointer-events: none !important;
    }

    .unavailable_item label {
        filter: contrast(0.7) grayscale(1) invert(0);
        box-shadow: none;
        transform: translateY(0.125rem) !important;
        cursor: not-allowed !important;
    }

    .unavailable_item .icons_opts {
        pointer-events: none !important;
    }

    .tooltip, .popover {
        position: relative;
        display: inline-block;
        border-bottom: 1px dotted #ccc;
        cursor: help;
        color: #006080;
    }

    .tooltip .tooltiptext, .popover .popovertext {
        visibility: hidden;
        position: absolute;
        width: 240px;
        background-color: #555;
        color: #fff;
        text-align: center;
        padding: 5px;
        border-radius: 6px;
        z-index: 1;
        opacity: 0;
        transition: opacity .6s;
    }

    .tooltip-top {
        bottom: 125%;
        left: calc(0% - 120px);
    }

    .tooltip:hover .tooltiptext, .popover .popovertext.show {
        visibility: visible;
        opacity: 1;
    }

    .filterSelect[disabled] {
        color: #a3a3a3;
        background: #efefef;
    }

    span.ral_tooltip > .ral_content {
        display: block !important;
        position: absolute;
        background: repeating-linear-gradient(-45deg, rgb(0 0 0), rgb(0 0 0) 10px, #282828 10px, #282828 13px);
        padding: 5px 5px;
        top: -21px;
        border-radius: 5px;
        width: max-content;
        left: 50%;
        transform: translateX(-50%);
        color: #fff;
        z-index: -1;
    }

    span.ral_tool {
        width: 17px;
        height: 17px;
        display: inline-block;
        border-radius: 100%;
        color: #fff;
        background: #000;
        line-height: 17px;
        font-weight: 600;
        cursor: pointer;
    }

    span.ral_tool:hover + span.ral_content {
        z-index: 1;
    }

    .item_blister_opak_wrap {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        align-content: center;
        justify-content: center;
        align-items: center;
    }

    @media all and (max-width: 767px) {
        .main-container .product-view .product-shop {
            box-sizing: border-box;
            padding: 0 2px;
        }

        .product-view table.grouped-items-table tbody tr, .product-view table.grouped-items-table tbody td {
            display: block;
            width: 100%;
            text-align: left !important;
        }

        .product-view table.grouped-items-table tbody td .hidden-small {
            font-weight: 600;
            display: block;
            width: 100%;
        }

        .product-view table.grouped-items-table tbody td .item_blister_opak_wrap {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            align-content: center;
            justify-content: flex-start;
            align-items: center;
        }

        .attributes_hidden:hover .attrhidden_content {
            top: calc(100% + 10px);
            left: -50%;
            transform: translate(-45%, 0%);
        }

        .attrhidden_content:before {
            top: -15px;
            left: 50%;
            border-right-color: transparent;
            border-bottom-color: black;
            transform: translate(0);
        }

        .product-view table.grouped-items-table tbody td, .product-view table.grouped-items-table tbody td.last {
            box-sizing: border-box;
            padding: 5px 10px;
        }

        .product-view table.grouped-items-table tbody td[data-c] .hidden-small, .product-view table.grouped-items-table tbody td.dostepnosc_td .hidden-small {
            display: inline-block;
            width: auto;
            padding-right: 10px;
        }

        #super-product-table > tbody > tr > td[data-c] {
            /* border-bottom-style: dotted; */
            /* border-bottom-color: #000; */
        }

        #super-product-table > tbody > tr > td {
            border-style: none;
        }

        p.old-price, p.old-price .price-label, p.old-price .price {
            margin-bottom: 0;
            color: #b5b5b5 !important;
        }

        .old-price .price-label {
            filter: brightness(0.5);
            font-family: "Montserrat", Arial, sans-serif;
        }

        #product_tabs_groupedtable_tabbed_contents .old-price .price {
            filter: brightness(0.5);
            color: #b5b5b5 !important;
            font-family: "Montserrat", Arial, sans-serif;
        }

        .twoja-cena-jm {
            font-size: 12px;
        }

        #product_tabs_groupedtable_tabbed_contents .price-box .special-price .price, #product_tabs_groupedtable_tabbed_contents .special-price .price-label {
            font-size: 12px;
        }

        table#super-product-table > tbody > tr > td.jm-cena .hidden-small, table#super-product-table > tbody > tr > td.jm-cena + td .hidden-small {
            font-size: 12px;
        }
    }

    /*.jednostka_miary{
    display: none;
}
[data-c="jednostka_miary"] {
display: none;
    }*/
    .ral_swatch_pink {
        background-color: pink !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_green {
        background-color: green !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_3005 {
        background-color: #4F121A !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_3009 {
        background-color: #5E2121 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_3011 {
        background-color: #781417 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_5003 {
        background-color: #001745 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_6005 {
        background-color: #0A381F !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_6020 {
        background-color: #263829 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_7016 {
        background-color: #262E38 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_7024 {
        background-color: #303845 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_7035 {
        background-color: #D4D9DB !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_8004 {
        background-color: #85382B !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8017 {
        background-color: #2E1C1C !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8019 {
        background-color: #2B2629 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_9002 {
        background-color: #F0EDE6 !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_9005 {
        background-color: #03050A !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_9006 {
        background-color: #A6ABB5 !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_9007 {
        background-color: #7D7A78 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_9010 {
        background-color: #FAFFFF !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_9011 {
        background-color: #1C1C1C !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_9016 {
        background-color: #F6F6F6 !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_1002 {
        background-color: #D2B773 !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_1004 {
        background-color: #E2B007 !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_1034 {
        background-color: #EDAB56 !important;
        color: #000 !important;
        background-image: none !important;
    }

    .ral_swatch_6002 {
        background-color: #276235 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8001 {
        background-color: #9C6B30 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8003 {
        background-color: #80542F !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8007 {
        background-color: #6F4A2F !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8011 {
        background-color: #5A3A29 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8014 {
        background-color: #49392D !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8023 {
        background-color: #A65E2F !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8024 {
        background-color: #79553C !important;
        color: #fff !important;
        background-image: none !important;
    }

    .ral_swatch_8022 {
        background-color: #211F20 !important;
        color: #fff !important;
        background-image: none !important;
    }

    .miro-radiobutton.filter_img:hover span.filter-tooltip, .ral_content {
        box-shadow: 0px 0px 3px 0px #484848;
    }

    .search_this_table_wrap {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        align-content: center;
        justify-content: flex-start;
        align-items: center;
        width: 100%;
        box-sizing: border-box;
        padding: 0 0 10px;
    }

    .search_this_table_wrap input#search_this_table {
        max-width: 310px;
        width: 100%;
        line-height: 22px;
        font-size: 14px;
        text-align: left;
        padding: 2px 5px;
    }


    #icons_pimcore_typ label[data-sortit="brązowy"] .item_no_img {
        background-color: #6d554b;
        color: #fff;
    }

    #icons_pimcore_typ label[data-sortit="piaskowy"] .item_no_img {
        background-color: #7c6d5e;
        color: #fff;
    }

    #icons_pimcore_typ label[data-sortit="złoty"] .item_no_img {
        background-color: #947847;
        color: #fff;
    }

    #icons_pimcore_typ label[data-sortit="zielony"] .item_no_img {
        background-color: #5b594e;
        color: #fff;
    }

    #icons_pimcore_typ label[data-sortit="szary"] .item_no_img {
        background-color: #6c6959;
        color: #fff;
    }

    /*pimcore_kolor*/
    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Bezbarwny"] .item_no_img {
        color: #000;
        background-image: repeating-linear-gradient(45deg, transparent 0 6px, #e1e1e1 6px 12px);
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Beżowy"] .item_no_img {
        color: #000;
        background: #D9BA8C;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Biały"] .item_no_img {
        color: #000;
        background: white;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Brązowy"] .item_no_img {
        color: #fff;
        background: #7D5C38;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Ceglasty"] .item_no_img {
        color: #fff;
        background: #a74824;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Czarny"] .item_no_img {
        color: #fff;
        background: black;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Czerwony"] .item_no_img {
        color: #fff;
        background: #AB1F1C;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Grafitowy"] .item_no_img {
        color: #fff;
        background: #36454F;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Niebieski"] .item_no_img {
        color: #fff;
        background: #17336B;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Ocynk"] .item_no_img {
        color: #000;
        background: #A6ABB5;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Pomarańczowy"] .item_no_img {
        color: #000;
        background: #E05E1F;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Szary"] .item_no_img {
        color: #fff;
        background: #808080;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Zielony"] .item_no_img {
        color: #fff;
        background: #266629;
    }

    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Źółty"] .item_no_img,
    div#icons_pimcore_kolor .icons_opts > label[data-sortit="Żółty"] .item_no_img {
        color: #000;
        background: #E3B838;
    }


    /*#super-product-table thead.fixed + tbody tr td {
    display: block;
    padding: 7px;
    font-size: 12px;
    border: 0;
    min-height: 42px;
    position: relative;
}

#super-product-table thead.fixed + tbody tr {
    width: 100%;
    display: -webkit-box;
    display: -moz-box;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row;
    align-items: center;
}

#super-product-table thead.fixed + tbody {
    display: block;
    width: 100%;
}*/
    table#super-product-table > tbody > tr > td:last-child {
        text-align: left !important;
    }

    table#super-product-table > tbody > tr > td:last-child span.cart-quantity {
        display: block;
    }

    .opakowanie_zbiorcze:hover .opak_tooltip, .opakowanie_zbiorcze.show_tool .opak_tooltip {
        bottom: -38px;
    }

    .opakowanie_zbiorcze.show_tool ~ .opakowanie_zbiorcze.show_tool .opak_tooltip {
        bottom: -70px;
        left: -138px;
    }

    @media all and (max-width: 767px) {
        .opakowanie_zbiorcze.show_tool .opak_tooltip,
        .opakowanie_zbiorcze:hover .opak_tooltip {
            bottom: 64px;
            left: -110px;
        }

        .opakowanie_zbiorcze.show_tool ~ .opakowanie_zbiorcze.show_tool .opak_tooltip {
            bottom: 30px;
            left: -85px;
        }

    }

    .qty-input_content {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-content: flex-start;
        align-items: center;
        width: 100%;
        text-align: left;
        position: relative;
        justify-content: center;
        text-align: center;
    }

    .qty-input_content .cart-quantity {
        display: block;
        width: 100%;
        text-align: left;
    }

    .qty-input_content input.input-text:not(.szt_qty) {
        margin-right: 5px;
    }

    .qty-input_content input.input-text {
        margin-bottom: 5px;
    }

    .qty-input_content input.input-text, .qty-input_content input.input-text + .opakowania_zbr {
        display: block;
        width: 50%;
        max-width: 50%;
    }

    .qty-input_content input.input-text + .opakowania_zbr {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        align-content: flex-start;
        justify-content: flex-start;
        align-items: center;
        /*    max-width: 100%;
    width: 100%;*/
    }

    .qty-input_content input.input-text + .opakowania_zbr > span {
        width: 30px !important;
    }

    .qty-input_content input.input-text {
        width: 100% !important;
        max-width: 100%;
    }

    .qty-input_content .cart-quantity {
        position: absolute;
        top: -15px;
        left: 0;
    }

    @media all and (max-width: 1440px) {
        .main.row.clearfix {
            max-width: 100%;
            margin: 0 30px;
        }

        .qty-input_content input.input-text, .qty-input_content input.input-text + .opakowania_zbr {
            display: block;
            width: 100%;
            max-width: 100%;
        }
    }

    div#product_filter_icons > .icons_item .icons_opts > label[data-sortit="Produkt niebudowlany"] {
        display: none !important;
    }

    /*to accept 2022.04.05*/
    table#super-product-table > tbody > tr > td:not(.quantity_container) {
        vertical-align: middle;
    }

    table#super-product-table > tbody > tr > td .qty-input_content {
        height: 100%;
        vertical-align: top;
    }

    span.cenac2-old {
        position: relative;
    }

    span.cenac2-old:before {
        position: absolute;
        content: attr(data-title);
        opacity: 0;
        visibility: hidden;
    }

    span.cenac2-old:hover:before {
        opacity: 0;
        visibility: hidden;
        top: -32px;
        background: #003543;
        color: #ffffff;
        left: 50%;
        transform: translateX(-50%);
        box-sizing: border-box;
        padding: 5px;
        border-radius: 5px;
        letter-spacing: 0px;
        font-size: 14px;
        min-width: 280px;
        z-index: -1;
    }
    .cenax-tool {
        position: relative;
    }
    .cenax-tool:hover > .tool {
        display: block !important;
        position: absolute;
        bottom: calc(100% + 5px);
        width: 280px;
        color: #fff;
        background: #013c4d;
        box-sizing: border-box;
        padding: 5px;
        border-radius: 5px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1;
        white-space: initial;
    }
    table#super-product-table > tbody > tr > td:not(.quantity_container) select {
        max-width: 100%;
        width: 100%;
        text-align: center;
    }
</style>
<!-- -->
<pre id="COOKIE_CHECK" style="display:none;">
<?php
if (boolval($_COOKIE['SOA_products']) === true) {
    echo "COOKIE EXIST <br/>";
    $prodSKU = $_product->getSku();
    $cookieValue = json_decode($_COOKIE['SOA_products'], true);
    if ((isset($cookieValue[$prodSKU])) && (boolval($cookieValue[$prodSKU]) === true)) {
        echo "SHOW ONLY AVAILABLES";
    } else {
        echo "SHOW ALL";
    }
} else {
    echo "COOKIE DOES NOT EXIST = SHOW ALL <br/>";
}
?>
</pre>
<script type="text/javascript">

    jQuery('#find_promotion').on('click', function () {
        let thisVal = jQuery(this).val().toUpperCase();
        let thisRows = jQuery('tbody#super-product-table_items tr');


        thisRows.each((indexRow, itemRow) => {
            if (thisVal.length > 0) {
                let rowData = jQuery(itemRow).attr('data-gazetka');
                if (jQuery('#find_promotion').is(':checked')) {
                    if (rowData == 1) {
                        jQuery(itemRow).show();
                    } else {
                        jQuery(itemRow).hide();
                    }
                } else {
                    jQuery(itemRow).show();
                }
            } else {
                jQuery(itemRow).show();
            }

        });
    });
    let cookieSpecial = getSpecialCookie('prods_show_availables');
    let newcookie = getSpecialCookie('SOA_products');
    let productID = '<?= $_product->getSku() ?>';
    // //console.log('cookieSpecial: '+cookieSpecial);
    if (newcookie) {
        let parsedNCS = JSON.parse(newcookie);
        // //console.log('newcookie: ');
        // //console.log(newcookie);
        // //console.log(parsedNCS);
        if (productID in parsedNCS) {
            // //console.log('found');
        } else {
            // //console.log('not found');
        }
    }

    /**
     * SHOW ONLY AVAILABLE ITEMS checkbox
     * */
    function showOAItems() {
        // showLoader();
        const showOnlyAvailables = document.getElementById('show_availables');
        let existingCookie = getSpecialCookie('SOA_products');
        let prodID = '<?= $_product->getSku() ?>';
        let newCookieContent = {};
        newCookieContent[prodID] = 0;

        if (showOnlyAvailables.checked) {
            document.cookie = "prods_show_availables=1;path=/;";
            newCookieContent[prodID] = 1;
        } else {
            document.cookie = "prods_show_availables=0;path=/;";
            newCookieContent[prodID] = 0;
        }

        if (existingCookie) {
            let parsedCookie = JSON.parse(existingCookie);
            if (prodID in parsedCookie) {
                // //console.log('found');
                // //console.log('setting to '+ newCookieContent[prodID]);
                parsedCookie[prodID] = newCookieContent[prodID];
            } else {
                // //console.log('not found');
                // //console.log('setting to '+ newCookieContent[prodID]);
                parsedCookie[prodID] = newCookieContent[prodID];
            }
            document.cookie = "SOA_products=" + JSON.stringify(parsedCookie) + ";path=/;";
        } else {
            document.cookie = "SOA_products=" + JSON.stringify(newCookieContent) + ";path=/;";
        }
        // //console.log(JSON.parse(getSpecialCookie('SOA_products')));
        window.location.reload();

    }

    jQuery('input#search_this_table').on('input', function () {
        let thisVal = jQuery(this).val().toUpperCase();
        let thisRows = jQuery('tbody#super-product-table_items tr');
        thisRows.each((indexRow, itemRow) => {
            if (thisVal.length > 0) {
                let rowData = jQuery(itemRow).attr('data-searchthis').toUpperCase();
                if (rowData.indexOf(thisVal) > -1) {
                    jQuery(itemRow).show();
                } else {
                    jQuery(itemRow).hide();
                }
            } else {
                jQuery(itemRow).show();
            }

        });
    });

    jQuery('#find_promotion').on('click', function () {
        let thisVal = jQuery(this).val().toUpperCase();
        let thisRows = jQuery('tbody#super-product-table_items tr');


        thisRows.each((indexRow, itemRow) => {
            if (thisVal.length > 0) {
                let rowData = jQuery(itemRow).attr('data-gazetka');
                if (jQuery('#find_promotion').is(':checked')) {
                    if (rowData == 1) {
                        jQuery(itemRow).show();
                    } else {
                        jQuery(itemRow).hide();
                    }
                } else {
                    jQuery(itemRow).show();
                }
            } else {
                jQuery(itemRow).show();
            }

        });
    });

    function getSpecialCookie(name) {
        let cookie = {};
        document.cookie.split(';').forEach(function (el) {
            let [k, v] = el.split('=');
            cookie[k.trim()] = v;
        })
        return cookie[name];
    }
    function silentShowOAItems(element) {
        let activeFilterHelper = {};
        jQuery('div#product_filter_icons > .icons_item').each(function(switchContainer,index){
            let thisCode = jQuery(this).attr('data-switch-code');
            let someInputChecked = false;
            jQuery(this).find('input').each((inp_index, input_el)=>{
                if(jQuery(input_el).is(':checked') && (jQuery(input_el).hasClass('is_disabled') !== true) ) {
                    someInputChecked = true;
                }
            });
            if(someInputChecked === true) {
                activeFilterHelper[thisCode] = 1;
            } else {
                activeFilterHelper[thisCode] = 0;
            }
        });
        let areFiltersActive = false;
        Object.keys(activeFilterHelper).forEach(function(x){
            if(activeFilterHelper[x] > 0) {
                areFiltersActive = true;
            }
        });

        const showOnlyAvailables = document.getElementById('show_availables');
        let existingCookie = getSpecialCookie('SOA_products');
        let prodID = '<?= $_product->getSku() ?>';
        let newCookieContent = {};
        let isSOAActive = false;
        newCookieContent[prodID] = 0;
        if(jQuery(element).hasClass('is_active')) {
            document.cookie = "prods_show_availables=0;path=/;";
            newCookieContent[prodID] = 0;
            jQuery(element).removeClass('is_active');
            isSOAActive = false;
        } else {
            document.cookie = "prods_show_availables=1;path=/;";
            newCookieContent[prodID] = 1;
            jQuery(element).addClass('is_active');
            isSOAActive = true;
        }

        if(isSOAActive === true || areFiltersActive === true) {
            jQuery('#product_filter_button_reset').show();
        } else {
            jQuery('#product_filter_button_reset').hide();
        }
        if(existingCookie) {
            let parsedCookie = JSON.parse(existingCookie);
            if(prodID in parsedCookie) {
                parsedCookie[prodID] = newCookieContent[prodID];
            } else {
                parsedCookie[prodID] = newCookieContent[prodID];
            }
            //console.log('setting to '+ newCookieContent[prodID]);
            document.cookie = "SOA_products="+JSON.stringify(parsedCookie)+";path=/;";
        } else {
            document.cookie = "SOA_products="+JSON.stringify(newCookieContent)+";path=/;";
        }

    }
    function showLoader() {
        jQuery('#product_tabs_groupedtable_tabbed_contents').prepend('<div id="overlay"><div id="overlayContent">Filtruję wyniki - proszę czekać...</div><div class="gear_container"><span class="gearrs"><span id="gearr1" class="hexagon spin"><span class="circle"></span></span><span id="gearr2" class="hexagon spin-back"><span class="circle"></span></span></span></div></div>').addClass('loaderActive');
    }

    function hideLoader() {
        jQuery('#overlay').remove();
        jQuery('#product_tabs_groupedtable_tabbed_contents').removeClass('loaderActive');
    }

    sortThisTable();

    /**
     * SORTING TABLE HERE
     * */
    function sortThisTable() {
        const pre_groupedSKU = '<?= $_product->getSku() ?>';
        const groupedSKU = pre_groupedSKU.replace('.', '');
        const tbodyData = document.getElementById("super-product-table_items");
        const tableRows = tbodyData.getElementsByTagName("tr");
        const toSortRows = new Array();
        const endRows = new Array();
        const firstRow = tableRows[0];
        // const SOA_checkbox = document.getElementById('show_availables').checked;
        const SOA_checkbox = false;
        for (let i = 0; i <= tableRows.length - 1; i++) {
            const row = tableRows[i];
            if (row.classList.contains('tab-row')) {
                row.id = 'tableitem_' + i;
                const rowTDs = row.children;
                let howMany = 0;
                for (let z = rowTDs.length - 1; z >= 0; z--) {
                    const tdItem = rowTDs[z];
                    if (tdItem.classList.contains('dostepnosc_td')) {
                        // //console.log(tdItem.children[1].innerHTML);
                        howMany = parseInt(tdItem.children[1].innerHTML);
                    }
                }
                const rowSizes = row.getAttribute('data-rozmiary').split(';');
                //console.log('rowSizes ',rowSizes);
                if (rowSizes.length > 1) {
                    const regexSize = /[+-]?\d+(\.\d+)?/g;
                    let foundSizes0 = rowSizes[0].match(regexSize).map(function (v) {
                        return parseFloat(v);
                    });
                    let foundSizes1 = rowSizes[1].match(regexSize).map(function (v) {
                        return parseFloat(v);
                    });
                    let size0 = foundSizes0[0];
                    let size1 = foundSizes1[0];
                    let reformedSize1 = "0." + size1;
                    if (size1 < 10) {
                        reformedSize1 = "0.00" + size1;
                    } else if (size1 < 100) {
                        reformedSize1 = "0.0" + size1;
                    } else {
                        reformedSize1 = "0." + size1;
                    }

                    const helpRowSize = parseFloat(size0) + parseFloat(reformedSize1);
                    const newRowSize = parseFloat(rowSizes[0]) + "." + helpRowSize;
                    const ToSortItem = {
                        item: row,
                        sortkey: helpRowSize,
                        size_0: size0,
                        size_1: size1,
                        available: howMany,
                        visible: true
                    };
                    if (howMany === 0) {
                        if (SOA_checkbox === true) {
                            ToSortItem.item.style.display = 'none';
                            ToSortItem.visible = false;
                        } else {
                            ToSortItem.item.style.display = '';
                            ToSortItem.visible = true;
                        }
                        // endRows.push(ToSortItem);
                    } else {
                        //toSortRows.push(ToSortItem);
                    }
                    toSortRows.push(ToSortItem);

                } else {
                    const regexSize = /[+-]?\d+(\.\d+)?/g;
                    let foundSizes0 = rowSizes[0].match(regexSize).map(function (v) {
                        return parseFloat(v);
                    });
                    const endRowItem = {
                        item: row,
                        sortkey: parseFloat(foundSizes0[0]),
                        available: howMany,
                        visible: true
                    };
                    if (howMany === 0) {
                        if (SOA_checkbox === true) {
                            endRowItem.item.style.display = 'none';
                            endRowItem.visible = false;
                        } else {
                            endRowItem.item.style.display = '';
                            endRowItem.visible = true;
                        }
                        // endRows.push(endRowItem);
                    } else {
                        //toSortRows.push(endRowItem);
                    }
                    toSortRows.push(endRowItem);

                }
            }
        }

        const rowFragments = document.createDocumentFragment();
        let isAvailableSortItems = false;
        let isAvailableEndItems = false;
        if (toSortRows.length > 0) {
            toSortRows.sort((a, b) => {
                return (a.sortkey - b.sortkey);
            });
            rowFragments.appendChild(firstRow);

            toSortRows.forEach((item, index) => {
                if (item.available > 0) {
                    isAvailableSortItems = true;
                }
                rowFragments.appendChild(item.item);
            });
        } else {
            isAvailableSortItems = true;
        }

        if (endRows.length > 0) {
            endRows.sort((a, b) => {
                return (a.sortkey - b.sortkey);
            });
            endRows.forEach((item, index) => {
                if (item.available > 0) {
                    isAvailableEndItems = true;
                }
                rowFragments.appendChild(item.item);
            });
        } else {
            isAvailableEndItems = true;
        }

        //console.log('sorting');
        // //console.log(toSortRows);
        // //console.log(endRows);
        // initScrool(true)
        if ((endRows.length > 0) || (toSortRows.length > 0)) {
            tbodyData.appendChild(rowFragments);
        }
        changeRowbackgrounds();
    }

    function changeRowbackgrounds() {
        const newTbodyData = document.getElementById("super-product-table_items");
        const newTableRows = newTbodyData.getElementsByTagName("tr");
        // //console.log(newTableRows);
        let prev_state = '';
        for (let i = 0; i <= newTableRows.length; i++) {
            let row = newTableRows[i];
            if (row) {
                if (row.classList.contains('tab-row')) {
                    let isEven = (i % 2 == 0);
                    let current_state = '';
                    let bgColor = '#fff';
                    let isVisible = (row.style.display === 'none') ? false : true;
                    if (isVisible) {
                        if ((isEven === true)) {
                            current_state = 'even';
                            bgColor = '#dfdfdf';
                            if (prev_state === 'even') {
                                current_state = 'odd';
                                bgColor = '#fff';
                            }
                        } else {
                            current_state = 'odd';
                            bgColor = '#fff';
                            if (prev_state === 'odd') {
                                current_state = 'even';
                                bgColor = '#dfdfdf';
                            }
                        }
                        row.style.backgroundColor = bgColor;
                        if (row.classList.contains(prev_state)) {
                            row.classList.remove(prev_state);
                        }
                        row.classList.add(current_state);
                        const helperItem = {
                            state: current_state,
                            previous_state: prev_state,
                            visibility: isVisible,
                            item: row
                        }
                        // //console.log(helperItem);
                        prev_state = current_state;
                    }
                }
            }
        }
        var thWidths = [];
        jQuery(".product-tabs-content .grouped-items-table.sortable thead tr th").each(function (index) {
            jQuery(this).css('width', jQuery(this).width());
            thWidths[index] = jQuery(this).width();
            jQuery('table.product-tabs-content .grouped-items-table.sortable > tbody > tr > td:nth-of-type(' + (index + 1) + ')').css('width', jQuery(this).width());
        });
        jQuery(".product-tabs-content .grouped-items-table.sortable tbody tr").each(function (indexTr, elementTr) {
            // //console.log(jQuery(this));
            jQuery(this).find("td").each(function (indexTd, elementTd) {
                jQuery(this).css('width', thWidths[indexTd]);
            });
        });

    }

    function reloadPage() {
        showLoader();
        var productUrl = window.location.href;
        var newUrl = productUrl;
        //console.log(newUrl);

        jQuery("#super-product-table thead select.filterSelect").each(function (index) {
            var filterName = jQuery(this).attr('id');
            var selectValue = jQuery(this).val();
            if (selectValue) { //
                var $value = selectValue;
            } else {
                var $value = null;
            }
            newUrl = updateURLParameter(newUrl, filterName, $value);
        });
        //console.log(newUrl);
        jQuery("#super-product-table thead .filtskus").each(function (index) {
            var filterName = 'name-sku';
            var selectValue = jQuery(this).val();
            if (selectValue) { //
                var $value = selectValue;
            } else {
                var $value = null;
            }
            newUrl = updateURLParameter(newUrl, filterName, $value);
        });
        //console.log(newUrl);
        jQuery.get(newUrl, function (data) {
            var tableBodyHtml = jQuery(data).find('#super-product-table').html();
            var stateHtml = jQuery(data).find('#states').html();
            var groupedPager = jQuery(data).find('.groupedPager').html();
            jQuery('#super-product-table').html(tableBodyHtml);
            jQuery('#states').html(stateHtml);
            jQuery('.groupedPager').html(groupedPager);
            sortThisTable();
            history.pushState(null, null, newUrl);
            const groupedPagerLinks = document.querySelectorAll('.groupedPager .pages a');
            groupedPagerLinks.forEach((item, index) => {
                const itemLink = item.getAttribute('href');
                const itemLinkArray = itemLink.split('?');
                const newLinksArray = newUrl.split('?');
                const itemParams = new URLSearchParams(itemLinkArray[1]);
                const newUrlParams = new URLSearchParams(newLinksArray[1]);
                const newParams = new Array();
                //console.log('itemParams');
                //console.log(itemParams.toString());
                //console.log('newUrlParams');
                //console.log(newUrlParams.toString());
                let indexHelp = 1;
                itemParams.forEach(function (itemValue, itemKey) {
                    if (itemKey === 'p') {
                        // newUrlParams.set('p', itemValue);
                        newParams.unshift('p=' + itemValue);
                    } else {
                        newParams.push(itemKey + '=' + itemValue);
                    }
                    indexHelp++;
                });
                //console.log('newParams before');
                //console.log(newParams);
                newUrlParams.forEach(function (itemValue, itemKey) {
                    if (itemKey !== 'p') {
                        newParams.push(itemKey + '=' + itemValue);
                        indexHelp++;
                    }
                });
                const newArr = newParams.filter((value) => value);
                const newItemParams = newArr.join('&');
                //console.log('newParams after');
                //console.log(newParams);
                item.setAttribute('href', itemLinkArray[0] + '?' + newItemParams);
            });
            hideLoader();
        });
    }

    function updateURLParameter(url, param, paramVal) {
        var newAdditionalURL = "";
        var tempArray = url.split("?");
        var baseURL = tempArray[0];
        var additionalURL = tempArray[1];
        var temp = "";
        if (additionalURL) {
            tempArray = additionalURL.split("&");
            for (var i = 0; i < tempArray.length; i++) {
                if (tempArray[i].split('=')[0] != param) {
                    newAdditionalURL += temp + tempArray[i];
                    temp = "&";
                }
            }
        }
        if (param === 'jednostka_miary_enabled') {
            param = 'jednostka_miary';
        }
        if (paramVal) {
            var rows_txt = temp + "" + param + "=" + paramVal;
        } else {
            var rows_txt = "";
        }
        let freshUrl = newAdditionalURL + rows_txt;

        let searchParams = new URLSearchParams(freshUrl);
        if (searchParams.has("name-sku")) {
            let nameSkuVal = searchParams.get("name-sku");
            let index = 1;
            let newSearchParams = new Array();
            for (let p of searchParams) {
                let newParam = p[0] + "=" + p[1];
                if (p[0] === 'name-sku') {
                    newSearchParams[0] = newParam;
                } else {
                    newSearchParams[index] = newParam;
                }
                index++;
            }
            freshUrl = newSearchParams.join('&');
        }
        return baseURL + "?" + freshUrl;
    }

    jQuery(document).on("change", "select.filterSelect", function () {
        reloadPage();
    });
</script>

<?php

if (count($disableCerts) == 1 && isset($disableCerts['Produkt niebudowlany'])): ?>
    <style type="text/css">
        #icons_ext_znaki {
            display: none !important;
        }

        .ext_znaki {
            display: none !important;
        }

        [data-c="ext_znaki"] {
            display: none !important;
        }
    </style>
<?php endif; ?>
<!-- sztuki/opakowania -->
<style type="text/css">
    .szt_qty[disabled] {
        background: #ebebeb;
        color: #a7a7a7;
        border: 1px solid #c9c9c9;
    }

    .gears[id*="super_"] {
        z-index: 1;
    }

    th.ilosc_sztuk {
        text-align: left !important;
    }

    @media all and (min-width: 1000px) {
        table#super-product-table > tbody > tr > td, table#super-product-table > thead > tr > th {
            width: calc(100% / <?= $headersCount ?>) !important;
            border: 0;
        }
    }
    #show_only_availables .soa_btn {
        min-width: 40px;
        height: 40px;
        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        align-content: center;
        justify-content: center;
        align-items: center;
        background: #fff;
        color: #000;
        font-weight: 600;
        border: 2px solid #444;
        border-radius: 5px;
        font-size: 15px;
        box-sizing: border-box;
        padding: 0 5px;
        pointer-events: none;
    }
    #show_only_availables label.is_active .soa_btn {
        filter: opacity(0.5) invert(0.85);
        transition: all .25s ease;
    }

    #show_only_availables label {
        display: inline-block !important;
        box-sizing: border-box !important;
        text-align: center !important;
        min-width: 30px !important;
        cursor: pointer !important;
        padding: 0 !important;
        border-radius: 6px !important;
        box-shadow: rgb(0 0 0 / 30%) 1px 1px 0 2px, 4px 4px 4px 2px rgb(0 0 0 / 30%);
        border-color: transparent;
        transform: translateY(0.125rem);
        appearance: button;
        background-color: transparent;
        background-image: linear-gradient(to bottom, #00a9bb, #00a9bb);
        border: 0 solid #e5e7eb;
        font-size: 100%;
        line-height: 24px;
        margin: 0;
        outline: 2px solid transparent;
        text-transform: none;
        transition: all .1s cubic-bezier(.4, 0, .2, 1);
        -webkit-user-select: none;
        touch-action: manipulation;
        color: #fff;
    }
    #show_only_availables label:hover {
        transform: translate(0);
        box-shadow: rgb(0 0 0 / 30%) 0px 0px 0 1px, 2px 2px 4px 2px rgb(0 0 0 / 30%);
    }
    #show_only_availables label.is_active {
        box-shadow: rgb(0 53 67) 0 0 0 2px, 4px 4px 4px rgb(0 53 67);
        background-color: #003543 !important;
        background-image: linear-gradient(to bottom, #00a9bb,#003543);
    }
    #show_only_availables label:not(.is_active) .filter-tooltip,
    #show_only_availables label.is_active .filter-tooltip {
        display:none !important;
    }

    #show_only_availables label.is_active:hover .filter-tooltip {
        background: repeating-linear-gradient( -45deg, rgb(255 255 255), rgb(255 255 255) 10px, #e9e9e9 10px, #e9e9e9 13px);
        color: #000;
        border-color: #000;
        border: 1px solid #000;
        top: -42px;
        display: block !important;
        position: absolute;
        padding: 5px 5px;
        border-radius: 5px;
        width: max-content;
        left: 50%;
        transform: translateX(-50%);
    }
    #show_only_availables .is_active .filter-tooltip .for_active > span {
        display: inline-block;
        padding: 0 5px;
        background: #003543;
        color: #fff;
        border-radius: 4px;
    }

    #show_only_availables label.is_active:hover .filter-tooltip:before {
        position: absolute;
        bottom: -10px;
        border: 5px solid transparent;
        content: '';
        border-top-color: #000;
        transform: translateX(-50%);
        left: 50%;
    }
    table#super-product-table > tbody > tr > td:not(.quantity_container):not(.item-dostawa-zew) {
        vertical-align: middle;
    }
    table#super-product-table > tbody > tr > td.item-dostawa-zew {
        vertical-align: top;
    }
    .dostawa-zew-tooltip {
        position: relative;
    }
    .dostawa-zew-tooltip img {
        max-width: 40px;
        width: 40px;
        height: 25px;
        object-fit: cover;
    }
    .dostawa-zew-tooltip .opak_icon {
        display: block;
    }
    .dostawa-zew-tooltip .opak_icon + .opak_tooltip {
        position: absolute;
        width: 230px;
        right: -10px;
        display: block;
        top: calc(100% + 3px);
        text-align: center;
        vertical-align: middle;
        z-index: -1;
        opacity: 0;
        font-weight: 400;
        font-size: 13px;
        white-space: break-spaces;
        height: auto;
        line-height: 18px;
        border-radius: 8px;
        padding: 5px;
        background: #efefef;
        color: #000;
        box-shadow: 0 0 0px 1px #000;
        overflow: visible;
    }
    .dostawa-zew-tooltip:hover .opak_icon + .opak_tooltip {
        opacity: 1;
        z-index: 1;
        font-weight: 400;
        font-size: 13px;
        white-space: break-spaces;
        height: auto;
        line-height: 18px;
        border-radius: 8px;
        padding: 5px;
        background: #efefef;
        color: #000;
        box-shadow: 0 0 0px 1px #000;
        overflow: visible;
    }
    .dostawa-zew-tooltip:hover .opak_icon + .opak_tooltip:before {
        position: absolute;
        content: '';
        border: 5px solid transparent;
        border-bottom-color: #000;
        top: -10px;
        right: 20px;
    }
</style>
<script type="text/javascript">
    /* change detection for pieces quantity inputs */

    let pQtyInputs = document.getElementsByClassName("szt_qty");
    let pQtyInputsLength = pQtyInputs.length;
    let timeout = null;
    while (pQtyInputsLength--) {
        let i = pQtyInputsLength;
        let inputJM = pQtyInputs[i].getAttribute('data-jm');
        let inputSzt = parseInt(pQtyInputs[i].getAttribute('data-szt'));
        if (inputSzt <= 0) {
            pQtyInputs[i].setAttribute("disabled", "disabled");
            pQtyInputs[i] = true;
        }
        pQtyInputs[i].addEventListener('keyup', monitorPiecesInputs);
        pQtyInputs[i].addEventListener('keyup', createSpinner);
        pQtyInputs[i].addEventListener('input', monitorPiecesInputs);
        pQtyInputs[i].addEventListener('input', removeSpinner);

    }

    function createSpinner() {

        let thisClosestParent = this.closest('div.qty-input_content');
        let thisTDParent = this.closest('td.pieces_qty');
        let targetId = this.getAttribute('id');
        let preGearId = targetId.replace('szt_', '');
        let gearId = "gear-" + preGearId;
        let gearSpinContainer = document.createElement("span");
        if (document.getElementById(gearId) !== null) {
            // // //console.log("istnieje - do usuniecia");
            document.getElementById(gearId).remove();
        } else {
            //console.log('createSpinner');
            gearSpinContainer.setAttribute("id", gearId);
            gearSpinContainer.setAttribute("class", "gears");
            gearSpinContainer.innerHTML = '<i id="gear1" class="fa fa-5x fa-gear spin"></i><i id="gear2" class="fa fa-5x fa-gear spin-back"></i>';
            thisClosestParent.parentNode.insertBefore(gearSpinContainer, thisClosestParent);
        }
    }

    function removeSpinner() {

        let targetId = this.getAttribute('id');
        let preGearId = targetId.replace('szt_', '');
        let gearId = "gear-" + preGearId;
        if (document.getElementById(gearId) !== null) {
            //console.log('removeSpinner');
            document.getElementById(gearId).remove();
        }
    }

    function removeExistingSpinner(id) {
        let gearId = "gear-" + id;
        if (document.getElementById(gearId) !== null) {
            //console.log('removeExistingSpinner');
            document.getElementById(gearId).remove();
        }
    }

    function monitorPiecesInputs() {
        //console.log('monitorPiecesInputs');
        clearTimeout(timeout);
        let preTargetId = this.getAttribute('id');
        let targetPckQtyInput = preTargetId.replace('szt_', '');
        let targetUM = this.getAttribute('data-jm');
        let targetPerKG = this.getAttribute('data-szt');
        let targetPckSize = this.getAttribute('data-opakowanie');
        //console.log(targetUM, targetPerKG, targetPckSize);
        let MaxPerPackage = 0;
        if (targetUM == 'KG') {
            // let MaxPerPackage = targetPerKG * targetPckSize;
            MaxPerPackage = targetPerKG;
        } else {
            MaxPerPackage = targetPckSize;
        }
        let PackageQtyElement = document.getElementById(targetPckQtyInput);
        let PackageQty = Math.ceil(this.value / MaxPerPackage);
        //console.log(PackageQtyElement, PackageQty, this.value, MaxPerPackage);
        timeout = setTimeout(function () {
            if (isNaN(PackageQty)) {
                //console.log('PackageQty is nan set to 0', PackageQty, this.value);
                PackageQtyElement.value = 0;
            } else {
                PackageQtyElement.value = PackageQty;
            }
            ev = document.createEvent('Event');
            ev.initEvent('change', true, false);
            PackageQtyElement.dispatchEvent(ev);
            keyupEv = document.createEvent('Event');
            keyupEv.initEvent('keyup', true, false);
            PackageQtyElement.dispatchEvent(keyupEv);
            removeExistingSpinner(targetPckQtyInput);
        }, 1000);
    }

    /* change detection for package quantity inputs to sync with pieces inputs */
    let packageQtyInputs = document.getElementsByClassName("package_qty");
    let packageQtyInputsLength = packageQtyInputs.length;
    while (packageQtyInputsLength--) {
        let i = packageQtyInputsLength;
        packageQtyInputs[i].addEventListener('change', monitorPackageInputs);
        packageQtyInputs[i].addEventListener('keyup', monitorPackageInputs);
        packageQtyInputs[i].addEventListener('keyup', detectAboveStock);
        packageQtyInputs[i].addEventListener('change', detectAboveStock);
        packageQtyInputs[i].addEventListener('change', removeSpinner);
        packageQtyInputs[i].addEventListener('change', detectAllErrors);
    }

    function monitorPackageInputs() {
        //console.log('monitorPackageInputs');
        let preTargetId = this.getAttribute('id');
        let PiecesId = "szt_" + preTargetId;
        let PiecesUM = document.getElementById(PiecesId).getAttribute('data-jm');
        let PiecesPerKG = document.getElementById(PiecesId).getAttribute('data-szt');
        let PackageSize = document.getElementById(PiecesId).getAttribute('data-opakowanie');
        let maximumPerPackage = 0;
        if (PiecesUM == "KG") {
            maximumPerPackage = PiecesPerKG;
        } else {
            maximumPerPackage = PackageSize;
        }
        let piecesQty = Math.floor(maximumPerPackage * this.value);
        let piecesQtyElement = document.getElementById(PiecesId);
        if (isNaN(piecesQty)) {
            //console.log('piecesQty is nan set to 0', piecesQty, this.value);
            piecesQtyElement.value = 0;
        } else {
            if (this.value.length > 0) {
                piecesQtyElement.value = piecesQty;
                // let dataOpakZbr = this.getAttribute('data-opakzbr');
                let thisOpaks = jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible');
                let checkVal = this.value % thisOpaks.attr('data-opakzbr');
                ;
                if (isNaN(checkVal)) {
                    checkVal = 0;
                }
                if (checkVal === 0) {
                    jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible').removeClass('show_tool');
                } else {
                    jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible').addClass('show_tool');
                    setTimeout(() => {
                        jQuery(this).closest('tr').find('.opakowanie_zbiorcze:visible').removeClass('show_tool');
                    }, 5000);
                }
            }
        }
    }

    function detectAboveStock() {
        //console.log('detectAboveStock');
        let prePiecesId = this.getAttribute('id');
        let PiecesId = "szt_" + prePiecesId;
        const ErTooltipMsg = 'Żądana ilość przekracza aktualny stan magazynowy.';
        let maxStockVal = parseInt(document.getElementById(PiecesId).getAttribute('data-magqty'));
        let currentVal = parseInt(this.value);
        // //console.log(currentVal > maxStockVal);
        // //console.log(currentVal+" > "+maxStockVal);
        if (currentVal > maxStockVal) {
            this.classList.add("is_some_error");
            this.parentNode.classList.add("is_some_error_tooltip");
            this.parentNode.setAttribute('data-errtooltip', ErTooltipMsg);
        } else {
            this.classList.remove("is_some_error");
            this.parentNode.classList.remove("is_some_error_tooltip");
            this.parentNode.removeAttribute('data-errtooltip');
        }

    }

    function detectAllErrors() {
        //console.log('detectAllErrors');
        let packageInputs = document.getElementsByClassName("package_qty");
        let packageInputsLength = packageInputs.length;
        let j = 0;
        let aboveStockItems = new Array;
        const aboveStockMsg = 'Na magazynie nie ma podanej liczby opakowań niektórych produktów';
        console.log(packageInputs);
        while (j < packageInputsLength) {
            if(packageInputs[j].tagName !== 'INPUT') {
                console.log('NOT INPUT',packageInputsLength[j]);
                continue;
            }
            let prePiecesId = packageInputs[j].getAttribute('id');
            let PiecesId = "szt_" + prePiecesId;
            // let InputPiecesId = packageInputs[j].getAttribute('data-piecesid');
            let inputPieces = document.getElementById(prePiecesId);
            //console.log(inputPieces, prePiecesId, PiecesId, packageInputs[j].tagName);
            if (isNaN(packageInputs[j].value) && packageInputs[j].value !== undefined) {
                packageInputs[j].classList.toggle("is_nan_error");
            } else {
                packageInputs[j].classList.remove("is_nan_error");
            }

            if (!isNaN(inputPieces.value)) {
                let PiecesUM = inputPieces.getAttribute('data-jm');
                let PiecesPerKG = inputPieces.getAttribute('data-szt');
                let PackageSize = inputPieces.getAttribute('data-opakowanie');
                let maximumPerPackage = 0;
                if (PiecesUM == "KG") {
                    maximumPerPackage = PiecesPerKG;
                } else {
                    maximumPerPackage = PackageSize;
                }
                let piecesQty = Math.floor(maximumPerPackage * packageInputs[j].value);
                if (inputPieces.disabled == false) {
                    if (parseInt(inputPieces.value) !== piecesQty) {
                        inputPieces.classList.toggle("is_some_error");
                        // // //console.log(typeof inputPieces.value + " "+ typeof piecesQty);
                        packageInputs[j].classList.toggle("is_nan_error");
                    } else {

                        inputPieces.classList.remove("is_some_error");
                    }
                }

                if (parseInt(packageInputs[j].value) > parseInt(inputPieces.getAttribute('data-magqty'))) {
                    showMsg = true;
                    // // //console.log(packageInputs[j].id);
                    if (aboveStockItems.indexOf(packageInputs[j]) > -1) {

                    } else {
                        aboveStockItems.push(packageInputs[j]);
                    }
                } else {
                    packageInputs[j].classList.remove("is_some_error");
                }
            }
            j++;
        }
    }

    jQuery(function ($) {
        $(document).keydown(function (e) {
            if ((e.keyCode === 13) && ($(document.activeElement).hasClass('szt_qty') || $(document.activeElement).hasClass('package_qty'))) {
                // //console.log(e);
                // //console.log($(document.activeElement));
                let btn = document.querySelector('.top-button .add-to-cart button.button');
                let url = document.getElementById('product_addtocart_form').getAttribute('action');
                // //console.log(btn, url);
                setTimeout(function () {
                    productAddToCartForm.submit(btn, url);
                    // $("input.input-text.qty").each(function(i_index, i_item) {
                    let dataID = $(e.target).attr('id');
                    let opakID = dataID.replace('szt_', '');
                    inputVal = $('#' + opakID).val();
                    if (inputVal > 0) {
                        inputSiblText = $(e.target).closest('tr').find('.cart-quantity').text();
                        if (inputSiblText.length == 0) {
                            inputSibl = 0;
                        } else {
                            inputSibl = inputSiblText.replace('(', '');
                            inputSibl = inputSibl.replace(')', '');
                            inputSibl = inputSibl.replace(' ', '');
                        }
                        wynik = parseInt(inputVal) + parseInt(inputSibl);
                        setTimeout(function () {
                            $(e.target).closest('tr').find('.cart-quantity').text('(' + wynik + ')');
                            $('input#' + dataID).val('');
                            document.getElementById(dataID).value = '';
                            $('input#' + opakID).val('');
                            document.getElementById(opakID).value = '';
                        }, 1000);
                    }
                    // });
                }, 250);
            }
        });

        // same tr height
        let tableTRs = $('.product-view table.grouped-items-table tbody tr');
        let trHeights = new Array();
        let maxTrH = 0;
        tableTRs.each(function (tr_index, tr_item) {
            let itemH = $(tr_item).outerHeight();
            let visibleTooltipsCount = $(tr_item).find('.opakowanie_zbiorcze:visible').length;
            if (visibleTooltipsCount === 0) {
                $(tr_item).find('td.opk_container').removeClass('quantity_container');
                $(tr_item).find('td.szt_container').removeClass('quantity_container');
            } else {
                if ($(tr_item).find('td.opk_container').hasClass('quantity_container') === false) {
                    $(tr_item).find('td.opk_container').addClass('quantity_container');
                    $(tr_item).find('td.szt_container').addClass('quantity_container');
                }
            }
            trHeights.push(itemH);
            if (itemH > maxTrH) {
                maxTrH = itemH;
            }
        });
        tableTRs.each(function (tr_index, tr_item) {
            let itemH = $(tr_item).outerHeight();
            trHeights.push(itemH);
            if (itemH > maxTrH) {
                maxTrH = itemH;
            }
        });
        maxTrH = maxTrH + 5;
        tableTRs.each(function (tr_index, tr_item) {
            $(tr_item).height(maxTrH);
        });
    });
</script>
